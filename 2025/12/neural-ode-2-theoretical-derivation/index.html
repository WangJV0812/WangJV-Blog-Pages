<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Neural ODE-2: Theoretical Derivation | WangJV Blog</title><meta name=keywords content="Neural ODE,Optimal Control"><meta name=description content="
  
      
          ç¬¦å·
          å«ä¹‰
      
  
  
      
          $z(t)$
          $t$ æ—¶åˆ»éšè—çŠ¶æ€
      
      
          $z(t_0)$
          åˆå§‹çŠ¶æ€
      
      
          $z(t_1)$
          ç»ˆæ­¢çŠ¶æ€
      
      
          $f(z(t), t, \theta)$
          Neural ODE Network
      
      
          $\mathcal L[z(t)]$
          æŸå¤±æ³›å‡½
      
      
          $a(t)$
          æ‹‰æ ¼æœ—æ—¥ä¹˜å­
      
      
          $\mathcal J$
          é€ å¢å¹¿æ€§èƒ½æŒ‡æ ‡
      
  

å¯¹äºæ·±åº¦æ®‹å·®ç½‘ç»œå’Œå½’ä¸€åŒ–æµï¼Œå¯¹äºä»»æ„ä¸€å±‚ $z_t$ï¼Œå…¶ä¸ä¸‹ä¸€å±‚ $z_{t+1}$ çš„å…³ç³»å¯ä»¥æè¿°ä¸ºï¼š
$$
z_{t+1} = z_t + f(z_t, \theta)
$$ä¸€ä¸ª insightful çš„è§‚ç‚¹æ˜¯ï¼Œè¿™ä¸ªå½¢å¼å¯ä»¥çœ‹ä½œä¸€ä¸ªè¿ç»­å˜æ¢çš„ æ¬§æ‹‰ç¦»æ•£åŒ–ã€‚é‚£ä¹ˆä¸€ä¸ªæ˜¾ç„¶çš„æ€è·¯æ˜¯ï¼Œå¦‚æœç½‘ç»œçš„æ·±åº¦æŒç»­å¢åŠ ã€æ¯ä¸€æ­¥æŒç»­å˜å°ã€‚åœ¨æçº¿ä¸Šï¼Œæ˜¯å¦å¯ä»¥å°†æ®‹å·®ç¥ç»ç½‘ç»œç†è§£ä¸ºï¼Œæˆ‘ä»¬ç”¨å‚æ•° $\theta$ æè¿°äº†ä¸€ä¸ªè¿ç»­å¸¸å¾®åˆ†æ–¹ç¨‹ï¼š
$$
\frac{d z(t)}{dt} = f(z(t), \theta, t)
$$æˆ‘ä»¬çš„ç¥ç»ç½‘ç»œå»ºæ¨¡çš„ï¼Œå®é™…ä¸Šæ˜¯å‚æ•° $z(t)$ çš„é€Ÿåº¦åœºï¼Œï¼ˆæˆ–è€…è¯´å‚æ•°çš„ Flowï¼‰ã€‚æ¨ç†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ ODE Solver æ¥è§£å¾—ä»»æ„æ—¶åˆ» $T$ çš„çŠ¶æ€ã€‚å¯¹äºä½¿ç”¨ ODE æè¿°çš„ç¥ç»ç½‘ç»œ $\frac{d z(t)}{dt} = f(z(t), \theta, t)$ï¼Œå’Œç”¨æ¥è¯„ä¼°ç»“æœçš„æ³›å‡½ $\mathcal L(z(t))$ã€‚
ç¥ç»ç½‘ç»œçš„æœ¬è´¨ç›®æ ‡æ˜¯ï¼Œé€šè¿‡ $\mathcal L$ å¯¹å‚æ•° $\theta$ çš„æ¢¯åº¦ï¼Œè¿›è¡Œæ¢¯åº¦ä¸‹é™ï¼š
$$
\frac{\partial \mathcal L}{\partial \theta} = \frac{d\mathcal L}{dz(t_1)}\frac{\partial z(t_1)}{\partial \theta}
$$è€Œå¯¹äº $z(t)$ï¼Œæœ‰çº¦æŸï¼š"><meta name=author content="WangJV"><link rel=canonical href=https://wangjv0812.cn/2025/12/neural-ode-2-theoretical-derivation/><link crossorigin=anonymous href=https://wangjv0812.cn/assets/css/stylesheet.2211ca3164be7830024f6aad2b3a2e520843a64f8f048445c3401c1249aa051d.css integrity="sha256-IhHKMWS+eDACT2qtKzouUghDpk+PBIRFw0AcEkmqBR0=" rel="preload stylesheet" as=style><link rel=icon href=https://wangjv0812.cn/icon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://wangjv0812.cn/icon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://wangjv0812.cn/icon/favicon-32x32.png><link rel=apple-touch-icon href=https://wangjv0812.cn/icon/apple-touch-icon.png><link rel=mask-icon href=https://wangjv0812.cn/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://wangjv0812.cn/2025/12/neural-ode-2-theoretical-derivation/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=icon type=image/png sizes=32x32 href=https://wangjv0812.cn/icon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://wangjv0812.cn/icon/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=https://wangjv0812.cn/icon/apple-touch-icon.png><link rel=manifest href=https://wangjv0812.cn/icon/site.webmanifest><script>MathJax={tex:{displayMath:[["\\[","\\]"],["$$","$$"]],inlineMath:[["\\(","\\)"],["$","$"]],processEscapes:!0,processEnvironments:!0,tags:"ams"},chtml:{scale:1,minScale:.5,matchFontHeight:!1,displayAlign:"center",displayIndent:"0",mtextInheritFont:!1,merrorInheritFont:!0,mathmlSpacing:!1,skipHtmlTags:["script","noscript","style","textarea","pre","code","a"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"},svg:{scale:1,minScale:.5,mtextInheritFont:!1,merrorInheritFont:!0,mathmlSpacing:!1,skipHtmlTags:["script","noscript","style","textarea","pre","code","a"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"},options:{enableMenu:!0,menuOptions:{settings:{zoom:"Click"}}},loader:{load:["ui/safe","a11y/assistive-mml"]},startup:{ready(){MathJax.startup.defaultReady();const e=new ResizeObserver(e=>{MathJax.typesetPromise()});e.observe(document.body)}}},window.innerWidth<=768&&(MathJax.chtml=MathJax.chtml||{},MathJax.chtml.scale=.9)</script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script><style>.MathJax{outline:0}@media(max-width:768px){.MathJax{font-size:90%!important}.MathJax_Display{overflow-x:auto;overflow-y:hidden;padding:0!important;margin:1em 0!important}.MathJax_CHTML{line-height:1.2!important}}mjx-container[jax=CHTML][display=true]{overflow-x:auto;overflow-y:hidden;padding:1px 0}</style><meta property="og:url" content="https://wangjv0812.cn/2025/12/neural-ode-2-theoretical-derivation/"><meta property="og:site_name" content="WangJV Blog"><meta property="og:title" content="Neural ODE-2: Theoretical Derivation"><meta property="og:description" content=" ç¬¦å· å«ä¹‰ $z(t)$ $t$ æ—¶åˆ»éšè—çŠ¶æ€ $z(t_0)$ åˆå§‹çŠ¶æ€ $z(t_1)$ ç»ˆæ­¢çŠ¶æ€ $f(z(t), t, \theta)$ Neural ODE Network $\mathcal L[z(t)]$ æŸå¤±æ³›å‡½ $a(t)$ æ‹‰æ ¼æœ—æ—¥ä¹˜å­ $\mathcal J$ é€ å¢å¹¿æ€§èƒ½æŒ‡æ ‡ å¯¹äºæ·±åº¦æ®‹å·®ç½‘ç»œå’Œå½’ä¸€åŒ–æµï¼Œå¯¹äºä»»æ„ä¸€å±‚ $z_t$ï¼Œå…¶ä¸ä¸‹ä¸€å±‚ $z_{t+1}$ çš„å…³ç³»å¯ä»¥æè¿°ä¸ºï¼š
$$ z_{t+1} = z_t + f(z_t, \theta) $$ä¸€ä¸ª insightful çš„è§‚ç‚¹æ˜¯ï¼Œè¿™ä¸ªå½¢å¼å¯ä»¥çœ‹ä½œä¸€ä¸ªè¿ç»­å˜æ¢çš„ æ¬§æ‹‰ç¦»æ•£åŒ–ã€‚é‚£ä¹ˆä¸€ä¸ªæ˜¾ç„¶çš„æ€è·¯æ˜¯ï¼Œå¦‚æœç½‘ç»œçš„æ·±åº¦æŒç»­å¢åŠ ã€æ¯ä¸€æ­¥æŒç»­å˜å°ã€‚åœ¨æçº¿ä¸Šï¼Œæ˜¯å¦å¯ä»¥å°†æ®‹å·®ç¥ç»ç½‘ç»œç†è§£ä¸ºï¼Œæˆ‘ä»¬ç”¨å‚æ•° $\theta$ æè¿°äº†ä¸€ä¸ªè¿ç»­å¸¸å¾®åˆ†æ–¹ç¨‹ï¼š
$$ \frac{d z(t)}{dt} = f(z(t), \theta, t) $$æˆ‘ä»¬çš„ç¥ç»ç½‘ç»œå»ºæ¨¡çš„ï¼Œå®é™…ä¸Šæ˜¯å‚æ•° $z(t)$ çš„é€Ÿåº¦åœºï¼Œï¼ˆæˆ–è€…è¯´å‚æ•°çš„ Flowï¼‰ã€‚æ¨ç†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ ODE Solver æ¥è§£å¾—ä»»æ„æ—¶åˆ» $T$ çš„çŠ¶æ€ã€‚å¯¹äºä½¿ç”¨ ODE æè¿°çš„ç¥ç»ç½‘ç»œ $\frac{d z(t)}{dt} = f(z(t), \theta, t)$ï¼Œå’Œç”¨æ¥è¯„ä¼°ç»“æœçš„æ³›å‡½ $\mathcal L(z(t))$ã€‚
ç¥ç»ç½‘ç»œçš„æœ¬è´¨ç›®æ ‡æ˜¯ï¼Œé€šè¿‡ $\mathcal L$ å¯¹å‚æ•° $\theta$ çš„æ¢¯åº¦ï¼Œè¿›è¡Œæ¢¯åº¦ä¸‹é™ï¼š
$$ \frac{\partial \mathcal L}{\partial \theta} = \frac{d\mathcal L}{dz(t_1)}\frac{\partial z(t_1)}{\partial \theta} $$è€Œå¯¹äº $z(t)$ï¼Œæœ‰çº¦æŸï¼š"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-12-28T22:30:25+08:00"><meta property="article:modified_time" content="2025-12-28T22:30:25+08:00"><meta property="article:tag" content="Neural ODE"><meta property="article:tag" content="Optimal Control"><meta property="og:image" content="https://wangjv0812.cn/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wangjv0812.cn/"><meta name=twitter:title content="Neural ODE-2: Theoretical Derivation"><meta name=twitter:description content="
  
      
          ç¬¦å·
          å«ä¹‰
      
  
  
      
          $z(t)$
          $t$ æ—¶åˆ»éšè—çŠ¶æ€
      
      
          $z(t_0)$
          åˆå§‹çŠ¶æ€
      
      
          $z(t_1)$
          ç»ˆæ­¢çŠ¶æ€
      
      
          $f(z(t), t, \theta)$
          Neural ODE Network
      
      
          $\mathcal L[z(t)]$
          æŸå¤±æ³›å‡½
      
      
          $a(t)$
          æ‹‰æ ¼æœ—æ—¥ä¹˜å­
      
      
          $\mathcal J$
          é€ å¢å¹¿æ€§èƒ½æŒ‡æ ‡
      
  

å¯¹äºæ·±åº¦æ®‹å·®ç½‘ç»œå’Œå½’ä¸€åŒ–æµï¼Œå¯¹äºä»»æ„ä¸€å±‚ $z_t$ï¼Œå…¶ä¸ä¸‹ä¸€å±‚ $z_{t+1}$ çš„å…³ç³»å¯ä»¥æè¿°ä¸ºï¼š
$$
z_{t+1} = z_t + f(z_t, \theta)
$$ä¸€ä¸ª insightful çš„è§‚ç‚¹æ˜¯ï¼Œè¿™ä¸ªå½¢å¼å¯ä»¥çœ‹ä½œä¸€ä¸ªè¿ç»­å˜æ¢çš„ æ¬§æ‹‰ç¦»æ•£åŒ–ã€‚é‚£ä¹ˆä¸€ä¸ªæ˜¾ç„¶çš„æ€è·¯æ˜¯ï¼Œå¦‚æœç½‘ç»œçš„æ·±åº¦æŒç»­å¢åŠ ã€æ¯ä¸€æ­¥æŒç»­å˜å°ã€‚åœ¨æçº¿ä¸Šï¼Œæ˜¯å¦å¯ä»¥å°†æ®‹å·®ç¥ç»ç½‘ç»œç†è§£ä¸ºï¼Œæˆ‘ä»¬ç”¨å‚æ•° $\theta$ æè¿°äº†ä¸€ä¸ªè¿ç»­å¸¸å¾®åˆ†æ–¹ç¨‹ï¼š
$$
\frac{d z(t)}{dt} = f(z(t), \theta, t)
$$æˆ‘ä»¬çš„ç¥ç»ç½‘ç»œå»ºæ¨¡çš„ï¼Œå®é™…ä¸Šæ˜¯å‚æ•° $z(t)$ çš„é€Ÿåº¦åœºï¼Œï¼ˆæˆ–è€…è¯´å‚æ•°çš„ Flowï¼‰ã€‚æ¨ç†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ ODE Solver æ¥è§£å¾—ä»»æ„æ—¶åˆ» $T$ çš„çŠ¶æ€ã€‚å¯¹äºä½¿ç”¨ ODE æè¿°çš„ç¥ç»ç½‘ç»œ $\frac{d z(t)}{dt} = f(z(t), \theta, t)$ï¼Œå’Œç”¨æ¥è¯„ä¼°ç»“æœçš„æ³›å‡½ $\mathcal L(z(t))$ã€‚
ç¥ç»ç½‘ç»œçš„æœ¬è´¨ç›®æ ‡æ˜¯ï¼Œé€šè¿‡ $\mathcal L$ å¯¹å‚æ•° $\theta$ çš„æ¢¯åº¦ï¼Œè¿›è¡Œæ¢¯åº¦ä¸‹é™ï¼š
$$
\frac{\partial \mathcal L}{\partial \theta} = \frac{d\mathcal L}{dz(t_1)}\frac{\partial z(t_1)}{\partial \theta}
$$è€Œå¯¹äº $z(t)$ï¼Œæœ‰çº¦æŸï¼š"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wangjv0812.cn/posts/"},{"@type":"ListItem","position":2,"name":"Neural ODE-2: Theoretical Derivation","item":"https://wangjv0812.cn/2025/12/neural-ode-2-theoretical-derivation/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Neural ODE-2: Theoretical Derivation","name":"Neural ODE-2: Theoretical Derivation","description":" ç¬¦å· å«ä¹‰ $z(t)$ $t$ æ—¶åˆ»éšè—çŠ¶æ€ $z(t_0)$ åˆå§‹çŠ¶æ€ $z(t_1)$ ç»ˆæ­¢çŠ¶æ€ $f(z(t), t, \\theta)$ Neural ODE Network $\\mathcal L[z(t)]$ æŸå¤±æ³›å‡½ $a(t)$ æ‹‰æ ¼æœ—æ—¥ä¹˜å­ $\\mathcal J$ é€ å¢å¹¿æ€§èƒ½æŒ‡æ ‡ å¯¹äºæ·±åº¦æ®‹å·®ç½‘ç»œå’Œå½’ä¸€åŒ–æµï¼Œå¯¹äºä»»æ„ä¸€å±‚ $z_t$ï¼Œå…¶ä¸ä¸‹ä¸€å±‚ $z_{t+1}$ çš„å…³ç³»å¯ä»¥æè¿°ä¸ºï¼š\n$$ z_{t+1} = z_t + f(z_t, \\theta) $$ä¸€ä¸ª insightful çš„è§‚ç‚¹æ˜¯ï¼Œè¿™ä¸ªå½¢å¼å¯ä»¥çœ‹ä½œä¸€ä¸ªè¿ç»­å˜æ¢çš„ æ¬§æ‹‰ç¦»æ•£åŒ–ã€‚é‚£ä¹ˆä¸€ä¸ªæ˜¾ç„¶çš„æ€è·¯æ˜¯ï¼Œå¦‚æœç½‘ç»œçš„æ·±åº¦æŒç»­å¢åŠ ã€æ¯ä¸€æ­¥æŒç»­å˜å°ã€‚åœ¨æçº¿ä¸Šï¼Œæ˜¯å¦å¯ä»¥å°†æ®‹å·®ç¥ç»ç½‘ç»œç†è§£ä¸ºï¼Œæˆ‘ä»¬ç”¨å‚æ•° $\\theta$ æè¿°äº†ä¸€ä¸ªè¿ç»­å¸¸å¾®åˆ†æ–¹ç¨‹ï¼š\n$$ \\frac{d z(t)}{dt} = f(z(t), \\theta, t) $$æˆ‘ä»¬çš„ç¥ç»ç½‘ç»œå»ºæ¨¡çš„ï¼Œå®é™…ä¸Šæ˜¯å‚æ•° $z(t)$ çš„é€Ÿåº¦åœºï¼Œï¼ˆæˆ–è€…è¯´å‚æ•°çš„ Flowï¼‰ã€‚æ¨ç†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ ODE Solver æ¥è§£å¾—ä»»æ„æ—¶åˆ» $T$ çš„çŠ¶æ€ã€‚å¯¹äºä½¿ç”¨ ODE æè¿°çš„ç¥ç»ç½‘ç»œ $\\frac{d z(t)}{dt} = f(z(t), \\theta, t)$ï¼Œå’Œç”¨æ¥è¯„ä¼°ç»“æœçš„æ³›å‡½ $\\mathcal L(z(t))$ã€‚\nç¥ç»ç½‘ç»œçš„æœ¬è´¨ç›®æ ‡æ˜¯ï¼Œé€šè¿‡ $\\mathcal L$ å¯¹å‚æ•° $\\theta$ çš„æ¢¯åº¦ï¼Œè¿›è¡Œæ¢¯åº¦ä¸‹é™ï¼š\n$$ \\frac{\\partial \\mathcal L}{\\partial \\theta} = \\frac{d\\mathcal L}{dz(t_1)}\\frac{\\partial z(t_1)}{\\partial \\theta} $$è€Œå¯¹äº $z(t)$ï¼Œæœ‰çº¦æŸï¼š\n","keywords":["Neural ODE","Optimal Control"],"articleBody":" ç¬¦å· å«ä¹‰ $z(t)$ $t$ æ—¶åˆ»éšè—çŠ¶æ€ $z(t_0)$ åˆå§‹çŠ¶æ€ $z(t_1)$ ç»ˆæ­¢çŠ¶æ€ $f(z(t), t, \\theta)$ Neural ODE Network $\\mathcal L[z(t)]$ æŸå¤±æ³›å‡½ $a(t)$ æ‹‰æ ¼æœ—æ—¥ä¹˜å­ $\\mathcal J$ é€ å¢å¹¿æ€§èƒ½æŒ‡æ ‡ å¯¹äºæ·±åº¦æ®‹å·®ç½‘ç»œå’Œå½’ä¸€åŒ–æµï¼Œå¯¹äºä»»æ„ä¸€å±‚ $z_t$ï¼Œå…¶ä¸ä¸‹ä¸€å±‚ $z_{t+1}$ çš„å…³ç³»å¯ä»¥æè¿°ä¸ºï¼š\n$$ z_{t+1} = z_t + f(z_t, \\theta) $$ä¸€ä¸ª insightful çš„è§‚ç‚¹æ˜¯ï¼Œè¿™ä¸ªå½¢å¼å¯ä»¥çœ‹ä½œä¸€ä¸ªè¿ç»­å˜æ¢çš„ æ¬§æ‹‰ç¦»æ•£åŒ–ã€‚é‚£ä¹ˆä¸€ä¸ªæ˜¾ç„¶çš„æ€è·¯æ˜¯ï¼Œå¦‚æœç½‘ç»œçš„æ·±åº¦æŒç»­å¢åŠ ã€æ¯ä¸€æ­¥æŒç»­å˜å°ã€‚åœ¨æçº¿ä¸Šï¼Œæ˜¯å¦å¯ä»¥å°†æ®‹å·®ç¥ç»ç½‘ç»œç†è§£ä¸ºï¼Œæˆ‘ä»¬ç”¨å‚æ•° $\\theta$ æè¿°äº†ä¸€ä¸ªè¿ç»­å¸¸å¾®åˆ†æ–¹ç¨‹ï¼š\n$$ \\frac{d z(t)}{dt} = f(z(t), \\theta, t) $$æˆ‘ä»¬çš„ç¥ç»ç½‘ç»œå»ºæ¨¡çš„ï¼Œå®é™…ä¸Šæ˜¯å‚æ•° $z(t)$ çš„é€Ÿåº¦åœºï¼Œï¼ˆæˆ–è€…è¯´å‚æ•°çš„ Flowï¼‰ã€‚æ¨ç†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ ODE Solver æ¥è§£å¾—ä»»æ„æ—¶åˆ» $T$ çš„çŠ¶æ€ã€‚å¯¹äºä½¿ç”¨ ODE æè¿°çš„ç¥ç»ç½‘ç»œ $\\frac{d z(t)}{dt} = f(z(t), \\theta, t)$ï¼Œå’Œç”¨æ¥è¯„ä¼°ç»“æœçš„æ³›å‡½ $\\mathcal L(z(t))$ã€‚\nç¥ç»ç½‘ç»œçš„æœ¬è´¨ç›®æ ‡æ˜¯ï¼Œé€šè¿‡ $\\mathcal L$ å¯¹å‚æ•° $\\theta$ çš„æ¢¯åº¦ï¼Œè¿›è¡Œæ¢¯åº¦ä¸‹é™ï¼š\n$$ \\frac{\\partial \\mathcal L}{\\partial \\theta} = \\frac{d\\mathcal L}{dz(t_1)}\\frac{\\partial z(t_1)}{\\partial \\theta} $$è€Œå¯¹äº $z(t)$ï¼Œæœ‰çº¦æŸï¼š\n$$ \\frac{dz}{dt} = f(z(t), t, \\theta) $$é‚£ä¹ˆï¼Œåº”æœ‰ï¼š\n$$ \\begin{aligned} \\frac{\\partial }{\\partial \\theta}\\frac{dz}{dt} \u0026= \\frac{\\partial f}{\\partial z}\\frac{\\partial z}{\\partial \\theta} + \\frac{\\partial f}{\\partial \\theta} \\end{aligned} $$è¿™ä¸ªå½¢å¼æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š\n$\\frac{\\partial }{\\partial \\theta}\\frac{dz}{dt}$ æ˜¯ä¸€ä¸ª $\\text{dim}(z) \\times \\text{dim}(\\theta)$ çš„ç³»ç»Ÿï¼Œå‡ ä¹æ˜¯ä¸å¯æ¥å—çš„ã€‚ è¿™ç”šè‡³è¿˜æ˜¯ä¸€ä¸ªå¾®åˆ†æ–¹ç¨‹ï¼Œæ„å‘³ç€æˆ‘ä»¬æƒ³è·å¾—ä¸€æ¬¡æ¢¯åº¦ $\\frac{\\partial \\mathcal L}{\\partial \\theta}$ è¿˜éœ€è¦è§£å¾®åˆ†æ–¹ç¨‹ï¼Œè¿™ä¹Ÿæ˜¯ä¸å¯æ¥å—çš„ã€‚ 1. NeuralODE çš„æœ€ä¼˜åŒ–æè¿° è®­ç»ƒ Neural ODE å¯ä»¥ç”¨ä¸€ä¸ªæœ‰çº¦æŸæœ€ä¼˜åŒ–é—®é¢˜æ¥æè¿°ï¼š\n$$ \\begin{aligned} \u0026\\min_\\theta \\mathcal L(z(t_1))\\\\ \\text{s.t.}\u0026 \\quad \\begin{aligned} \u0026\\frac{d z(t)}{dt} = f(z(t), t, \\theta), \\\\ \u0026z(t_0) = z_0 \\end{aligned} \\end{aligned} $$é‚£ä¹ˆä¸å¦¨æ„é€ å¢å¹¿æ€§èƒ½æŒ‡æ ‡ $\\mathcal J$ï¼Œå¼•å…¥æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³• $a(t)$ï¼š\n$$ \\begin{aligned} \\mathcal J\\ \u0026= \\mathcal L[z(t_1)] + \\int_{t_0}^{t_1} a^\\top(t)\\left( \\frac{dz}{dt} - f(z, t, \\theta) \\right)dt\\\\ \u0026= \\mathcal L[z(t_1)] + \\int_{t_0}^{t_1} \\left(a^\\top(t) \\frac{dz}{dt} - a^\\top(t)f(z, t, \\theta) \\right)dt \\end{aligned} $$æ­¤æ—¶ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ªä¼˜åŒ–é—®é¢˜è½¬åŒ–ä¸ºä¸€ä¸ªå¯¹æ³›å‡½ $\\mathcal J$ çš„å˜åˆ†æœ€ä¼˜é—®é¢˜ã€‚æ ¹æ® Calculus of Variations ä¸­çš„å™è¿°ï¼Œä¸å¦¨å¯¹ $z(t)$ åšä¸€ä¸ªæ‰°åŠ¨ï¼š\n$$ z(t) \\to z(t) + \\epsilon \\eta(t) $$è¿™æ˜¯ä¸€ä¸ªå›ºå®šåˆç«¯é—®é¢˜ï¼Œæœ‰ $\\eta(x_0) = 0$ã€‚\n1.1. å¯¹äºæŸå¤± $\\mathcal L(z(t_1))$ æ ¹æ® Calculus of Variations#1. å˜åˆ† ä¸­çš„ç»“è®ºï¼Œæœ‰ï¼š\n$$ \\begin{aligned} \\delta \\mathcal L \u0026= \\left.\\frac{d }{d \\epsilon} \\mathcal L[z(t_1) + \\epsilon \\eta(t_1)]\\right|_{\\epsilon=0}\\epsilon\\\\ \\end{aligned} $$ä¸å¦¨ä»¤ $Z(t_1) = z(t_1) + \\epsilon \\eta(t_1)$ï¼Œæœ‰ï¼š\n$$ \\begin{aligned} \\delta \\mathcal L \u0026= \\left. \\frac{\\partial \\mathcal L}{\\partial Z(t_1)}^\\top \\frac{d Z(t_1)}{d\\epsilon}\\right|_{\\epsilon=0}\\epsilon \\\\ \u0026= \\frac{\\partial \\mathcal L}{\\partial z(t_1}^\\top \\eta(t)\\epsilon\\\\ \u0026= \\frac{\\partial \\mathcal L}{\\partial z(t_1)}^\\top \\delta z(t_1) \\end{aligned} $$1.2. å¯¹äºç§¯åˆ†ç¬¬ä¸€é¡¹ $\\int_{t_0}^{t_1}a^\\top(t)\\frac{dz}{dt}dt$ ä¸å¦¨ä»¤ï¼š\n$$ \\mathcal J_1 = \\int_{t_0}^{t_1}a^\\top(t)\\frac{dz}{dt}dt $$å¯¹ $z(t)$ æ‰°åŠ¨ï¼Œ$z(t) \\to z(t) + \\epsilon \\eta(t)$ã€‚æœ‰ï¼š\n$$ \\begin{aligned} \\mathcal J_1 \u0026= \\int_{t_0}^{t_1}a^\\top(t)\\frac{d}{dt}\\left(z(t) + \\epsilon \\eta(t)\\right)dt\\\\ \u0026= \\int_{t_0}^{t_1}a^\\top(t)\\left(\\frac{dz}{dt} + \\epsilon \\frac{d\\eta}{dt}\\right)dt \\end{aligned}\\\\ $$æœ‰å˜åˆ†ï¼š\n$$ \\begin{aligned} \\delta \\mathcal J_1 \u0026= \\left. \\frac{d}{d\\epsilon}\\int_{t_0}^{t_1}a^\\top(t)\\left(\\frac{dz}{dt} + \\epsilon \\frac{d\\eta}{dt}\\right)dt \\right|_{\\epsilon=0}\\epsilon\\\\ \u0026= \\int_{t_0}^{t_1}a^\\top(t)\\left.\\frac{\\epsilon d\\eta}{dt}\\right|_{\\epsilon=0} dt\\\\ \u0026= \\int_{t_0}^{t_1}a^\\top(t)\\frac{d(\\delta z)}{dt} dt \\end{aligned} $$1.3. å¯¹äºç§¯åˆ†ç¬¬äºŒé¡¹ $\\int_{t_0}^{t_1} a^\\top(t)f(z, t, \\theta)dt$ ä¸å¦¨ä»¤ï¼š\n$$ \\mathcal J_2 = \\int_{t_0}^{t_1} a^\\top(t)f(z, t, \\theta)dt $$ç±»ä¼¼çš„ï¼Œè¿›è¡Œæ‰°åŠ¨ï¼š\n$$ \\mathcal J_2 = \\int_{t_0}^{t_1} a^\\top(t)f(z + \\epsilon \\eta, t, \\theta)dt $$æœ‰å˜åˆ†ï¼š\n$$ \\begin{aligned} \\delta \\mathcal J_2 \u0026= \\left.\\frac{d}{d\\epsilon} \\int_{t_0}^{t_1} a^\\top(t)f(z + \\epsilon \\eta, t, \\theta)dt\\right|_{\\epsilon=0} \\epsilon\\\\ \u0026= \\int_{t_0}^{t_1} a^\\top(t)\\left.\\frac{d}{d\\epsilon} f(z + \\epsilon \\eta, t, \\theta)\\right|_{\\epsilon=0}dt\\epsilon\\\\ \u0026= \\int_{t_0}^{t_1} a^\\top(t)\\frac{\\partial f}{\\partial z}\\epsilon \\eta dt\\\\ \u0026= \\int_{t_0}^{t_1} a^\\top(t)\\frac{\\partial f}{\\partial z}\\delta z dt \\end{aligned} $$1.4. å®Œæ•´å˜åˆ† é‚£ä¹ˆï¼Œæœ‰å®Œæ•´å˜åˆ†ï¼š\n$$ \\delta \\mathcal J = \\frac{\\partial \\mathcal L}{\\partial z(t_1)}^\\top \\delta z(t_1) + \\int_{t_0}^{t_1}a^\\top(t)\\frac{d(\\delta z)}{dt} dt - \\int_{t_0}^{t_1} a^\\top(t)\\frac{\\partial f}{\\partial z}\\delta z dt $$ä¸å¦¨å¯¹ $\\delta \\mathcal J_1$ ä½¿ç”¨åˆ†éƒ¨ç§¯åˆ†ï¼Œæœ‰ï¼š\n$$ \\int_{t_0}^{t_1} a^\\top \\frac{d(\\delta z)}{dt} dt = \\left[ a^\\top \\delta z \\right]_{t_0}^{t_1} - \\int_{t_0}^{t_1} \\frac{da^\\top}{dt} \\delta z \\, dt $$ç”±äºè¿™æ˜¯ä¸€ä¸ªå›ºå®šåˆç«¯é—®é¢˜ï¼Œæœ‰ $\\eta(t_0) = 0$ï¼Œæœ‰ï¼š\n$$ \\left[ a^\\top \\delta z \\right]_{t_0}^{t_1} = a^\\top(t_1) \\delta z(t_1) $$é‚£ä¹ˆæœ‰ï¼š\n$$ \\begin{aligned} \\delta \\mathcal J \u0026= \\frac{\\partial \\mathcal L}{\\partial z(t_1)}^\\top \\delta z(t_1) + a^\\top(t_1) \\delta z(t_1) - \\int_{t_0}^{t_1} \\frac{da^\\top}{dt} \\delta z \\, dt - \\int_{t_0}^{t_1} a^\\top(t)\\frac{\\partial f}{\\partial z}\\delta z dt\\\\ \u0026= \\underbrace{\\left(\\frac{\\partial \\mathcal L}{\\partial z(t_1)}^\\top + a^\\top(t_1)\\right)\\delta z(t_1)}_{\\text{è¾¹ç•Œé¡¹ (A)}} - \\int_{t_0}^{t_1} \\underbrace{\\left(\\frac{da^\\top}{dt} + a^\\top(t)\\frac{\\partial f}{\\partial z}\\right)}_{\\text{è·¯å¾„é¡¹ (B)}} \\delta z(t) dt \\end{aligned} $$å–æœ€ä¼˜ï¼Œåˆ™æœ‰:\n$$ \\begin{aligned} \\delta \\mathcal J \u0026= \\left(\\frac{\\partial \\mathcal L}{\\partial z(t_1)}^\\top + a^\\top(t_1)\\right)\\delta z(t_1) - \\int_{t_0}^{t_1} \\left(\\frac{da^\\top}{dt} + a^\\top(t)\\frac{\\partial f}{\\partial z}\\right)\\delta z dt\\\\ \u0026= 0 \\end{aligned} $$æ ¹æ® [[å˜åˆ†æ³•åŸºæœ¬å¼•ç† (du Bois-Reymond å¼•ç†)]]ï¼Œ$\\delta z(t_1) = \\epsilon \\eta(t_1)$ï¼Œ$\\eta(t_1)$ ä»»å–ï¼Œåˆ†åˆ«æ‰°åŠ¨å¯¹è¾¹ç•Œé¡¹å’Œè·¯å¾„é¡¹ï¼Œæœ‰ï¼š\n$$ \\begin{aligned} a(t_1) \u0026= -\\frac{\\partial \\mathcal L}{\\partial z(t_1)}\\\\ \\frac{da}{dt}^\\top \u0026= -a(t)^\\top \\frac{\\partial f(z, t, \\theta)}{\\partial z} \\end{aligned} $$1.5. å¯¹ $\\theta$ å˜åˆ† ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬å¯¹ $\\theta$ æ‰°åŠ¨ï¼š\n$$ \\theta \\to \\theta + \\epsilon \\eta $$æ ¹æ®å˜åˆ†æ³•ï¼Œæœ‰ï¼š\n$$ \\delta \\mathcal J = \\frac{\\partial \\mathcal J}{\\partial z(t_1)}\\delta z(t_1)+\\int_{t_0}^{t_1}a^\\top\\left( \\delta z' - \\frac{\\partial f}{\\partial z}\\delta z - \\frac{\\partial f}{\\partial \\theta}\\delta \\theta \\right)dt $$ç±»ä¼¼çš„ï¼Œä½¿ç”¨åˆ†éƒ¨ç§¯åˆ†ï¼Œæœ‰ï¼š\n$$ \\delta \\mathcal J = \\left(\\frac{\\partial \\mathcal J}{\\partial z(t_1)} + a(t_1)\\right)^\\top\\delta z(t_1)- \\int_{t_0}^{t_1} \\left( \\frac{da}{dt}^\\top + a^\\top \\frac{\\partial f}{\\partial z} \\right)\\delta zdt- \\int_{t_0}^{t_1} a^\\top \\frac{\\partial f}{\\partial \\theta} dt \\delta \\theta $$å°†æˆ‘ä»¬ä¹‹å‰çš„å¯¹ $z$ æ‰°åŠ¨çš„ç»“æœå¸¦å…¥ï¼Œåˆ™æœ‰ï¼š\n$$ \\begin{aligned} \\delta \\mathcal J \u0026= - \\int_{t_0}^{t_1} a^\\top \\frac{\\partial f}{\\partial \\theta} dt \\delta \\theta\\\\ \u0026= \\frac{\\partial \\mathcal L}{\\partial \\theta}\\delta \\theta \\end{aligned} $$é‚£ä¹ˆï¼Œæœ‰ï¼š\n$$ \\frac{\\partial \\mathcal L}{\\partial \\theta} = -\\int_{t_0}^{t_1} \\mathbf{a}(t)^\\top \\frac{\\partial f}{\\partial \\theta} (z(t), t, \\theta)dt $$2. æ•°å€¼ä¼˜åŒ– å¥½äº†ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰ï¼š\nç±»å‹ å½¢å¼ çŠ¶æ€ $(t)$ åŠ¨åŠ›å­¦ $\\frac{\\partial z(t)}{\\partial t} = f(z(t), t, \\theta)$ ä¼´éšå› å­ $a(t)$ åŠ¨åŠ›å­¦ $\\begin{aligned}a(t_1) \u0026= -\\frac{\\partial \\mathcal L}{\\partial z(t_1)}\\\\\\frac{da}{dt}^\\top \u0026= -a(t)^\\top \\frac{\\partial f(z, t, \\theta)}{\\partial z}\\end{aligned}$ æ¢¯åº¦ $\\frac{\\partial \\mathcal L}{\\partial \\theta} = -\\int_{t_0}^{t_1} \\mathbf{a}(t)^\\top \\frac{\\partial f}{\\partial \\theta} dt$ æ¢¯åº¦ä¸‹é™ä¼˜åŒ–çš„æ ¸å¿ƒæ˜¯æ±‚ $\\frac{\\partial \\mathcal L}{\\partial \\theta}$ã€‚å…¶ä¸­ï¼Œ$\\frac{\\partial f}{\\partial \\theta}$ å¯ä»¥é€šè¿‡è‡ªåŠ¨æ±‚å¯¼æœºåˆ¶è®¡ç®—ï¼Œè¿™å¾ˆå®¹æ˜“æ±‚çš„ã€‚ç›¸å¯¹æ¯”è¾ƒéº»çƒ¦çš„æ˜¯ï¼Œéœ€è¦è®¡ç®— $t\\in [t_0, t_1]$ ä¸‹æ‰€æœ‰æ—¶åˆ»çš„ $z(t)$ å’Œ $a(t)$ã€‚\nå¯¹äº $z(t)$ å’Œ $a(t)$ï¼Œæˆ‘ä»¬æœ‰å¾®åˆ†æ–¹ç¨‹æè¿°å…¶åŠ¨æ€ã€‚å› æ­¤ï¼ŒNeuralODE çš„è®­ç»ƒè¿‡ç¨‹å¯ä»¥æè¿°ä¸ºï¼š\nä½¿ç”¨ odeSolverï¼Œè®¡ç®— $z(t_1)$ è®¡ç®— $a(t_1) = -\\frac{\\partial \\mathcal L}{\\partial z(t_1)}$ ä» $a(t_1)$ å’Œ $z_(t_1)$ å¼€å§‹ï¼Œä½¿ç”¨ odeSolver è®¡ç®— $t_1 \\to t_0$ çš„ $z(t)$ å’Œ $a(t)$ã€‚ è®¡ç®—ç´¯åŠ  $a^\\top \\frac{\\partial f}{\\partial \\theta}$ ä¸ºäº†è®¡ç®—æ–¹ä¾¿ã€‚ä¸å¦¨ç›´æ¥ä»¤ï¼š\n$$ a_\\theta = \\frac{d}{dt} \\frac{\\partial \\mathcal L}{\\partial \\theta} = \\mathbf{a}(t)^\\top \\frac{\\partial f}{\\partial \\theta} $$å¯ä»¥æ„å»ºä¸€ä¸ªå¢å¹¿çŠ¶æ€ï¼š\n$$ \\begin{bmatrix} a(t)\\\\z(t)\\\\a_\\theta(t) \\end{bmatrix} $$é‚£ä¹ˆæœ‰ï¼š\n$$ \\frac{d}{dt} \\begin{bmatrix} a(t)\\\\z(t)\\\\a_\\theta(t) \\end{bmatrix} = \\begin{bmatrix} a(t)^\\top \\frac{\\partial f(z, t, \\theta)}{\\partial z}\\\\ -\\frac{\\partial z(t)}{\\partial t} = f(z(t), t, \\theta)\\\\ \\mathbf{a}(t)^\\top \\frac{\\partial f}{\\partial \\theta} \\end{bmatrix} $$è¿™ä¸ªå½¢å¼å¯ä»¥ç›´æ¥çš„é€šè¿‡ odeSolver æ±‚è§£ã€‚\n","wordCount":"801","inLanguage":"en","image":"https://wangjv0812.cn/","datePublished":"2025-12-28T22:30:25+08:00","dateModified":"2025-12-28T22:30:25+08:00","author":{"@type":"Person","name":"WangJV"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wangjv0812.cn/2025/12/neural-ode-2-theoretical-derivation/"},"publisher":{"@type":"Organization","name":"WangJV Blog","logo":{"@type":"ImageObject","url":"https://wangjv0812.cn/icon/favicon-32x32.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wangjv0812.cn/ accesskey=h title="WangJV Blog (Alt + H)"><img src=https://wangjv0812.cn/icon/translucent-icon.png alt aria-label=logo height=35>WangJV Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://wangjv0812.cn/ title=Home><span>Home</span></a></li><li><a href=https://wangjv0812.cn/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://wangjv0812.cn/resources/ title=Resources><span>Resources</span></a></li><li><a href=https://wangjv0812.cn/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://wangjv0812.cn/search/ title="ğŸ” Search (Alt + /)" accesskey=/><span>ğŸ” Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wangjv0812.cn/>Home</a>&nbsp;Â»&nbsp;<a href=https://wangjv0812.cn/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Neural ODE-2: Theoretical Derivation</h1><div class=post-meta><span title='2025-12-28 22:30:25 +0800 +0800'>December 28, 2025</span>&nbsp;Â·&nbsp;WangJV&nbsp;|&nbsp;<a href=https://github.com/WangJV0812/WangJV-Blog-Source/tree/master/content/posts/NeuralODE-2%20Theoretical%20Derivation/index.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#1-neuralode-çš„æœ€ä¼˜åŒ–æè¿°>1. NeuralODE çš„æœ€ä¼˜åŒ–æè¿°</a><ul><li><a href=#11-å¯¹äºæŸå¤±>1.1. å¯¹äºæŸå¤±</a></li><li><a href=#12-å¯¹äºç§¯åˆ†ç¬¬ä¸€é¡¹>1.2. å¯¹äºç§¯åˆ†ç¬¬ä¸€é¡¹</a></li><li><a href=#13-å¯¹äºç§¯åˆ†ç¬¬äºŒé¡¹>1.3. å¯¹äºç§¯åˆ†ç¬¬äºŒé¡¹</a></li><li><a href=#14-å®Œæ•´å˜åˆ†>1.4. å®Œæ•´å˜åˆ†</a></li><li><a href=#15-å¯¹--å˜åˆ†>1.5. å¯¹ å˜åˆ†</a></li></ul></li><li><a href=#2-æ•°å€¼ä¼˜åŒ–>2. æ•°å€¼ä¼˜åŒ–</a></li></ul></nav></div></details></div><div class=post-content><table><thead><tr><th>ç¬¦å·</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>$z(t)$</td><td>$t$ æ—¶åˆ»éšè—çŠ¶æ€</td></tr><tr><td>$z(t_0)$</td><td>åˆå§‹çŠ¶æ€</td></tr><tr><td>$z(t_1)$</td><td>ç»ˆæ­¢çŠ¶æ€</td></tr><tr><td>$f(z(t), t, \theta)$</td><td>Neural ODE Network</td></tr><tr><td>$\mathcal L[z(t)]$</td><td>æŸå¤±æ³›å‡½</td></tr><tr><td>$a(t)$</td><td>æ‹‰æ ¼æœ—æ—¥ä¹˜å­</td></tr><tr><td>$\mathcal J$</td><td>é€ å¢å¹¿æ€§èƒ½æŒ‡æ ‡</td></tr></tbody></table><p>å¯¹äºæ·±åº¦æ®‹å·®ç½‘ç»œå’Œå½’ä¸€åŒ–æµï¼Œå¯¹äºä»»æ„ä¸€å±‚ $z_t$ï¼Œå…¶ä¸ä¸‹ä¸€å±‚ $z_{t+1}$ çš„å…³ç³»å¯ä»¥æè¿°ä¸ºï¼š</p>$$
z_{t+1} = z_t + f(z_t, \theta)
$$<p>ä¸€ä¸ª insightful çš„è§‚ç‚¹æ˜¯ï¼Œè¿™ä¸ªå½¢å¼å¯ä»¥çœ‹ä½œä¸€ä¸ªè¿ç»­å˜æ¢çš„ <strong>æ¬§æ‹‰ç¦»æ•£åŒ–</strong>ã€‚é‚£ä¹ˆä¸€ä¸ªæ˜¾ç„¶çš„æ€è·¯æ˜¯ï¼Œå¦‚æœç½‘ç»œçš„æ·±åº¦æŒç»­å¢åŠ ã€æ¯ä¸€æ­¥æŒç»­å˜å°ã€‚åœ¨æçº¿ä¸Šï¼Œæ˜¯å¦å¯ä»¥å°†æ®‹å·®ç¥ç»ç½‘ç»œç†è§£ä¸ºï¼Œæˆ‘ä»¬ç”¨å‚æ•° $\theta$ æè¿°äº†ä¸€ä¸ªè¿ç»­å¸¸å¾®åˆ†æ–¹ç¨‹ï¼š</p>$$
\frac{d z(t)}{dt} = f(z(t), \theta, t)
$$<p>æˆ‘ä»¬çš„ç¥ç»ç½‘ç»œå»ºæ¨¡çš„ï¼Œå®é™…ä¸Šæ˜¯å‚æ•° $z(t)$ çš„é€Ÿåº¦åœºï¼Œï¼ˆæˆ–è€…è¯´å‚æ•°çš„ Flowï¼‰ã€‚æ¨ç†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ ODE Solver æ¥è§£å¾—ä»»æ„æ—¶åˆ» $T$ çš„çŠ¶æ€ã€‚å¯¹äºä½¿ç”¨ ODE æè¿°çš„ç¥ç»ç½‘ç»œ $\frac{d z(t)}{dt} = f(z(t), \theta, t)$ï¼Œå’Œç”¨æ¥è¯„ä¼°ç»“æœçš„æ³›å‡½ $\mathcal L(z(t))$ã€‚</p><p>ç¥ç»ç½‘ç»œçš„æœ¬è´¨ç›®æ ‡æ˜¯ï¼Œé€šè¿‡ $\mathcal L$ å¯¹å‚æ•° $\theta$ çš„æ¢¯åº¦ï¼Œè¿›è¡Œæ¢¯åº¦ä¸‹é™ï¼š</p>$$
\frac{\partial \mathcal L}{\partial \theta} = \frac{d\mathcal L}{dz(t_1)}\frac{\partial z(t_1)}{\partial \theta}
$$<p>è€Œå¯¹äº $z(t)$ï¼Œæœ‰çº¦æŸï¼š</p>$$
\frac{dz}{dt} = f(z(t), t, \theta)
$$<p>é‚£ä¹ˆï¼Œåº”æœ‰ï¼š</p>$$
\begin{aligned}
\frac{\partial }{\partial \theta}\frac{dz}{dt}
&= \frac{\partial f}{\partial z}\frac{\partial z}{\partial \theta} + \frac{\partial f}{\partial \theta}
\end{aligned}
$$<p>è¿™ä¸ªå½¢å¼æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>$\frac{\partial }{\partial \theta}\frac{dz}{dt}$ æ˜¯ä¸€ä¸ª $\text{dim}(z) \times \text{dim}(\theta)$ çš„ç³»ç»Ÿï¼Œå‡ ä¹æ˜¯ä¸å¯æ¥å—çš„ã€‚</li><li>è¿™ç”šè‡³è¿˜æ˜¯ä¸€ä¸ªå¾®åˆ†æ–¹ç¨‹ï¼Œæ„å‘³ç€æˆ‘ä»¬æƒ³è·å¾—ä¸€æ¬¡æ¢¯åº¦ $\frac{\partial \mathcal L}{\partial \theta}$ è¿˜éœ€è¦è§£å¾®åˆ†æ–¹ç¨‹ï¼Œè¿™ä¹Ÿæ˜¯ä¸å¯æ¥å—çš„ã€‚</li></ol><h2 id=1-neuralode-çš„æœ€ä¼˜åŒ–æè¿°>1. NeuralODE çš„æœ€ä¼˜åŒ–æè¿°<a hidden class=anchor aria-hidden=true href=#1-neuralode-çš„æœ€ä¼˜åŒ–æè¿°>#</a></h2><p>è®­ç»ƒ Neural ODE å¯ä»¥ç”¨ä¸€ä¸ªæœ‰çº¦æŸæœ€ä¼˜åŒ–é—®é¢˜æ¥æè¿°ï¼š</p>$$
\begin{aligned}
&\min_\theta \mathcal L(z(t_1))\\
\text{s.t.}& \quad \begin{aligned}
&\frac{d z(t)}{dt} = f(z(t), t, \theta), \\
&z(t_0) = z_0
\end{aligned}
\end{aligned}
$$<p>é‚£ä¹ˆä¸å¦¨æ„é€ å¢å¹¿æ€§èƒ½æŒ‡æ ‡ $\mathcal J$ï¼Œå¼•å…¥æ‹‰æ ¼æœ—æ—¥ä¹˜å­æ³• $a(t)$ï¼š</p>$$
\begin{aligned}
\mathcal J\
&= \mathcal L[z(t_1)] + \int_{t_0}^{t_1} a^\top(t)\left(
\frac{dz}{dt} - f(z, t, \theta)
\right)dt\\
&= \mathcal L[z(t_1)] + \int_{t_0}^{t_1} \left(a^\top(t)
\frac{dz}{dt} - a^\top(t)f(z, t, \theta)
\right)dt
\end{aligned}
$$<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ªä¼˜åŒ–é—®é¢˜è½¬åŒ–ä¸ºä¸€ä¸ªå¯¹æ³›å‡½ $\mathcal J$ çš„å˜åˆ†æœ€ä¼˜é—®é¢˜ã€‚æ ¹æ® <a href=../NeuralODE-1%20Calculus%20of%20Variations/index.md>Calculus of Variations</a> ä¸­çš„å™è¿°ï¼Œä¸å¦¨å¯¹ $z(t)$ åšä¸€ä¸ªæ‰°åŠ¨ï¼š</p>$$
z(t) \to z(t) + \epsilon \eta(t)
$$<p>è¿™æ˜¯ä¸€ä¸ªå›ºå®šåˆç«¯é—®é¢˜ï¼Œæœ‰ $\eta(x_0) = 0$ã€‚</p><h3 id=11-å¯¹äºæŸå¤±>1.1. å¯¹äºæŸå¤± $\mathcal L(z(t_1))$<a hidden class=anchor aria-hidden=true href=#11-å¯¹äºæŸå¤±>#</a></h3><p>æ ¹æ® <a href=../NeuralODE-1%20Calculus%20of%20Variations/index.md#3-%E5%8F%98%E5%88%86>Calculus of Variations#1. å˜åˆ†</a> ä¸­çš„ç»“è®ºï¼Œæœ‰ï¼š</p>$$
\begin{aligned}
\delta \mathcal L
&= \left.\frac{d }{d \epsilon} \mathcal L[z(t_1) + \epsilon \eta(t_1)]\right|_{\epsilon=0}\epsilon\\
\end{aligned}
$$<p>ä¸å¦¨ä»¤ $Z(t_1) = z(t_1) + \epsilon \eta(t_1)$ï¼Œæœ‰ï¼š</p>$$
\begin{aligned}
\delta \mathcal L
&= \left. \frac{\partial \mathcal L}{\partial Z(t_1)}^\top \frac{d Z(t_1)}{d\epsilon}\right|_{\epsilon=0}\epsilon \\
&= \frac{\partial \mathcal L}{\partial z(t_1}^\top \eta(t)\epsilon\\
&= \frac{\partial \mathcal L}{\partial z(t_1)}^\top \delta z(t_1)
\end{aligned}
$$<h3 id=12-å¯¹äºç§¯åˆ†ç¬¬ä¸€é¡¹>1.2. å¯¹äºç§¯åˆ†ç¬¬ä¸€é¡¹ $\int_{t_0}^{t_1}a^\top(t)\frac{dz}{dt}dt$<a hidden class=anchor aria-hidden=true href=#12-å¯¹äºç§¯åˆ†ç¬¬ä¸€é¡¹>#</a></h3><p>ä¸å¦¨ä»¤ï¼š</p>$$
\mathcal J_1 = \int_{t_0}^{t_1}a^\top(t)\frac{dz}{dt}dt
$$<p>å¯¹ $z(t)$ æ‰°åŠ¨ï¼Œ$z(t) \to z(t) + \epsilon \eta(t)$ã€‚æœ‰ï¼š</p>$$
\begin{aligned}
\mathcal J_1
&= \int_{t_0}^{t_1}a^\top(t)\frac{d}{dt}\left(z(t) + \epsilon \eta(t)\right)dt\\
&= \int_{t_0}^{t_1}a^\top(t)\left(\frac{dz}{dt} + \epsilon \frac{d\eta}{dt}\right)dt
\end{aligned}\\
$$<p>æœ‰å˜åˆ†ï¼š</p>$$
\begin{aligned}
\delta \mathcal J_1
&= \left. \frac{d}{d\epsilon}\int_{t_0}^{t_1}a^\top(t)\left(\frac{dz}{dt} + \epsilon \frac{d\eta}{dt}\right)dt \right|_{\epsilon=0}\epsilon\\
&= \int_{t_0}^{t_1}a^\top(t)\left.\frac{\epsilon d\eta}{dt}\right|_{\epsilon=0} dt\\
&= \int_{t_0}^{t_1}a^\top(t)\frac{d(\delta z)}{dt} dt
\end{aligned}
$$<h3 id=13-å¯¹äºç§¯åˆ†ç¬¬äºŒé¡¹>1.3. å¯¹äºç§¯åˆ†ç¬¬äºŒé¡¹ $\int_{t_0}^{t_1} a^\top(t)f(z, t, \theta)dt$<a hidden class=anchor aria-hidden=true href=#13-å¯¹äºç§¯åˆ†ç¬¬äºŒé¡¹>#</a></h3><p>ä¸å¦¨ä»¤ï¼š</p>$$
\mathcal J_2 = \int_{t_0}^{t_1} a^\top(t)f(z, t, \theta)dt
$$<p>ç±»ä¼¼çš„ï¼Œè¿›è¡Œæ‰°åŠ¨ï¼š</p>$$
\mathcal J_2 = \int_{t_0}^{t_1} a^\top(t)f(z + \epsilon \eta, t, \theta)dt
$$<p>æœ‰å˜åˆ†ï¼š</p>$$
\begin{aligned}
\delta \mathcal J_2
&= \left.\frac{d}{d\epsilon} \int_{t_0}^{t_1} a^\top(t)f(z + \epsilon \eta, t, \theta)dt\right|_{\epsilon=0} \epsilon\\
&= \int_{t_0}^{t_1} a^\top(t)\left.\frac{d}{d\epsilon} f(z + \epsilon \eta, t, \theta)\right|_{\epsilon=0}dt\epsilon\\
&= \int_{t_0}^{t_1} a^\top(t)\frac{\partial f}{\partial z}\epsilon \eta dt\\
&= \int_{t_0}^{t_1} a^\top(t)\frac{\partial f}{\partial z}\delta z dt
\end{aligned}
$$<h3 id=14-å®Œæ•´å˜åˆ†>1.4. å®Œæ•´å˜åˆ†<a hidden class=anchor aria-hidden=true href=#14-å®Œæ•´å˜åˆ†>#</a></h3><p>é‚£ä¹ˆï¼Œæœ‰å®Œæ•´å˜åˆ†ï¼š</p>$$
\delta \mathcal J = \frac{\partial \mathcal L}{\partial z(t_1)}^\top \delta z(t_1) + \int_{t_0}^{t_1}a^\top(t)\frac{d(\delta z)}{dt} dt - \int_{t_0}^{t_1} a^\top(t)\frac{\partial f}{\partial z}\delta z dt
$$<p>ä¸å¦¨å¯¹ $\delta \mathcal J_1$ ä½¿ç”¨åˆ†éƒ¨ç§¯åˆ†ï¼Œæœ‰ï¼š</p>$$
\int_{t_0}^{t_1} a^\top \frac{d(\delta z)}{dt} dt = \left[ a^\top \delta z \right]_{t_0}^{t_1} - \int_{t_0}^{t_1} \frac{da^\top}{dt} \delta z \, dt
$$<p>ç”±äºè¿™æ˜¯ä¸€ä¸ªå›ºå®šåˆç«¯é—®é¢˜ï¼Œæœ‰ $\eta(t_0) = 0$ï¼Œæœ‰ï¼š</p>$$
\left[ a^\top \delta z \right]_{t_0}^{t_1} = a^\top(t_1) \delta z(t_1)
$$<p>é‚£ä¹ˆæœ‰ï¼š</p>$$
\begin{aligned}
\delta \mathcal J
&= \frac{\partial \mathcal L}{\partial z(t_1)}^\top \delta z(t_1) + a^\top(t_1) \delta z(t_1) - \int_{t_0}^{t_1} \frac{da^\top}{dt} \delta z \, dt - \int_{t_0}^{t_1} a^\top(t)\frac{\partial f}{\partial z}\delta z dt\\
&= \underbrace{\left(\frac{\partial \mathcal L}{\partial z(t_1)}^\top + a^\top(t_1)\right)\delta z(t_1)}_{\text{è¾¹ç•Œé¡¹ (A)}} - \int_{t_0}^{t_1} \underbrace{\left(\frac{da^\top}{dt} + a^\top(t)\frac{\partial f}{\partial z}\right)}_{\text{è·¯å¾„é¡¹ (B)}} \delta z(t) dt
\end{aligned}
$$<p>å–æœ€ä¼˜ï¼Œåˆ™æœ‰:</p>$$
\begin{aligned}
\delta \mathcal J
&= \left(\frac{\partial \mathcal L}{\partial z(t_1)}^\top + a^\top(t_1)\right)\delta z(t_1) - \int_{t_0}^{t_1} \left(\frac{da^\top}{dt} + a^\top(t)\frac{\partial f}{\partial z}\right)\delta z dt\\
&= 0
\end{aligned}
$$<p>æ ¹æ® [[å˜åˆ†æ³•åŸºæœ¬å¼•ç† (du Bois-Reymond å¼•ç†)]]ï¼Œ$\delta z(t_1) = \epsilon \eta(t_1)$ï¼Œ$\eta(t_1)$ ä»»å–ï¼Œåˆ†åˆ«æ‰°åŠ¨å¯¹è¾¹ç•Œé¡¹å’Œè·¯å¾„é¡¹ï¼Œæœ‰ï¼š</p>$$
\begin{aligned}
a(t_1) &= -\frac{\partial \mathcal L}{\partial z(t_1)}\\
\frac{da}{dt}^\top &= -a(t)^\top \frac{\partial f(z, t, \theta)}{\partial z}
\end{aligned}
$$<h3 id=15-å¯¹--å˜åˆ†>1.5. å¯¹ $\theta$ å˜åˆ†<a hidden class=anchor aria-hidden=true href=#15-å¯¹--å˜åˆ†>#</a></h3><p>ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬å¯¹ $\theta$ æ‰°åŠ¨ï¼š</p>$$
\theta \to \theta + \epsilon \eta
$$<p>æ ¹æ®å˜åˆ†æ³•ï¼Œæœ‰ï¼š</p>$$
\delta \mathcal J = \frac{\partial \mathcal J}{\partial z(t_1)}\delta z(t_1)+\int_{t_0}^{t_1}a^\top\left(
\delta z' - \frac{\partial f}{\partial z}\delta z - \frac{\partial f}{\partial \theta}\delta \theta
\right)dt
$$<p>ç±»ä¼¼çš„ï¼Œä½¿ç”¨åˆ†éƒ¨ç§¯åˆ†ï¼Œæœ‰ï¼š</p>$$
\delta \mathcal J = \left(\frac{\partial \mathcal J}{\partial z(t_1)} + a(t_1)\right)^\top\delta z(t_1)- \int_{t_0}^{t_1} \left( \frac{da}{dt}^\top + a^\top \frac{\partial f}{\partial z} \right)\delta zdt- \int_{t_0}^{t_1} a^\top \frac{\partial f}{\partial \theta} dt \delta \theta
$$<p>å°†æˆ‘ä»¬ä¹‹å‰çš„å¯¹ $z$ æ‰°åŠ¨çš„ç»“æœå¸¦å…¥ï¼Œåˆ™æœ‰ï¼š</p>$$
\begin{aligned}
\delta \mathcal J
&= - \int_{t_0}^{t_1} a^\top \frac{\partial f}{\partial \theta} dt \delta \theta\\
&= \frac{\partial \mathcal L}{\partial \theta}\delta \theta
\end{aligned}
$$<p>é‚£ä¹ˆï¼Œæœ‰ï¼š</p>$$
\frac{\partial \mathcal L}{\partial \theta} = -\int_{t_0}^{t_1} \mathbf{a}(t)^\top \frac{\partial f}{\partial \theta} (z(t), t, \theta)dt
$$<h2 id=2-æ•°å€¼ä¼˜åŒ–>2. æ•°å€¼ä¼˜åŒ–<a hidden class=anchor aria-hidden=true href=#2-æ•°å€¼ä¼˜åŒ–>#</a></h2><p>å¥½äº†ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰ï¼š</p><table><thead><tr><th>ç±»å‹</th><th>å½¢å¼</th></tr></thead><tbody><tr><td>çŠ¶æ€ $(t)$ åŠ¨åŠ›å­¦</td><td>$\frac{\partial z(t)}{\partial t} = f(z(t), t, \theta)$</td></tr><tr><td>ä¼´éšå› å­ $a(t)$ åŠ¨åŠ›å­¦</td><td>$\begin{aligned}a(t_1) &= -\frac{\partial \mathcal L}{\partial z(t_1)}\\\frac{da}{dt}^\top &= -a(t)^\top \frac{\partial f(z, t, \theta)}{\partial z}\end{aligned}$</td></tr><tr><td>æ¢¯åº¦</td><td>$\frac{\partial \mathcal L}{\partial \theta} = -\int_{t_0}^{t_1} \mathbf{a}(t)^\top \frac{\partial f}{\partial \theta} dt$</td></tr></tbody></table><p>æ¢¯åº¦ä¸‹é™ä¼˜åŒ–çš„æ ¸å¿ƒæ˜¯æ±‚ $\frac{\partial \mathcal L}{\partial \theta}$ã€‚å…¶ä¸­ï¼Œ$\frac{\partial f}{\partial \theta}$ å¯ä»¥é€šè¿‡è‡ªåŠ¨æ±‚å¯¼æœºåˆ¶è®¡ç®—ï¼Œè¿™å¾ˆå®¹æ˜“æ±‚çš„ã€‚ç›¸å¯¹æ¯”è¾ƒéº»çƒ¦çš„æ˜¯ï¼Œéœ€è¦è®¡ç®— $t\in [t_0, t_1]$ ä¸‹æ‰€æœ‰æ—¶åˆ»çš„ $z(t)$ å’Œ $a(t)$ã€‚</p><p>å¯¹äº $z(t)$ å’Œ $a(t)$ï¼Œæˆ‘ä»¬æœ‰å¾®åˆ†æ–¹ç¨‹æè¿°å…¶åŠ¨æ€ã€‚å› æ­¤ï¼ŒNeuralODE çš„è®­ç»ƒè¿‡ç¨‹å¯ä»¥æè¿°ä¸ºï¼š</p><ol><li>ä½¿ç”¨ odeSolverï¼Œè®¡ç®— $z(t_1)$</li><li>è®¡ç®— $a(t_1) = -\frac{\partial \mathcal L}{\partial z(t_1)}$</li><li>ä» $a(t_1)$ å’Œ $z_(t_1)$ å¼€å§‹ï¼Œä½¿ç”¨ odeSolver è®¡ç®— $t_1 \to t_0$ çš„ $z(t)$ å’Œ $a(t)$ã€‚</li><li>è®¡ç®—ç´¯åŠ  $a^\top \frac{\partial f}{\partial \theta}$</li></ol><p>ä¸ºäº†è®¡ç®—æ–¹ä¾¿ã€‚ä¸å¦¨ç›´æ¥ä»¤ï¼š</p>$$
a_\theta = \frac{d}{dt} \frac{\partial \mathcal L}{\partial \theta} = \mathbf{a}(t)^\top \frac{\partial f}{\partial \theta}
$$<p>å¯ä»¥æ„å»ºä¸€ä¸ªå¢å¹¿çŠ¶æ€ï¼š</p>$$
\begin{bmatrix}
a(t)\\z(t)\\a_\theta(t)
\end{bmatrix}
$$<p>é‚£ä¹ˆæœ‰ï¼š</p>$$
\frac{d}{dt} \begin{bmatrix}
a(t)\\z(t)\\a_\theta(t)
\end{bmatrix} = \begin{bmatrix}
a(t)^\top \frac{\partial f(z, t, \theta)}{\partial z}\\
-\frac{\partial z(t)}{\partial t} = f(z(t), t, \theta)\\
\mathbf{a}(t)^\top \frac{\partial f}{\partial \theta}
\end{bmatrix}
$$<p>è¿™ä¸ªå½¢å¼å¯ä»¥ç›´æ¥çš„é€šè¿‡ odeSolver æ±‚è§£ã€‚</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://wangjv0812.cn/tags/neural-ode/>Neural ODE</a></li><li><a href=https://wangjv0812.cn/tags/optimal-control/>Optimal Control</a></li></ul><nav class=paginav><a class=next href=https://wangjv0812.cn/2025/12/neural-ode-1-calculus-of-variations/><span class=title>Next Â»</span><br><span>Neural ODE-1: Calculus of Variations</span></a></nav></footer><script src=https://giscus.app/client.js data-repo=WangJV0812/WangJV-Blog-Pages data-repo-id=R_kgDOPZMmQw data-category=comments data-category-id=DIC_kwDOPZMmQ84Czj63 data-mapping=url data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=zh-CN crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2025 <a href=https://wangjv0812.cn/>WangJV Blog</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>