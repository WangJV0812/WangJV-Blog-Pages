<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ScoreMatching | WangJV Blog</title><meta name=keywords content="unsupervised learning,æ•°æ®ç”Ÿæˆ,å¯¹æ¯”å­¦ä¹ "><meta name=description content="1. ä¸ºä»€ä¹ˆè¦ç”¨ Score Matching
å¾ˆå¤šæ˜¯å¦ï¼Œæˆ‘ä»¬å¸Œæœ›ä»å¤§é‡çš„æ•°æ® $x_1, x_2, \cdots x_n$ï¼ˆæˆ–è€…æ¢å¥è¯è¯´ï¼Œä»ä¸€ä¸ªéšæœºå˜é‡ $X$ çš„å¤§é‡æŠ½è±¡ï¼‰è¿˜åŸå›åˆ†å¸ƒ $p(x)$ æœ¬èº«ã€‚ä¸€ä¸ªå¾ˆæ˜¾ç„¶çš„æƒ³æ³•æ˜¯é€šè¿‡ä¸€ä¸ªå¸¦æœ‰å¯ä¼˜åŒ–å‚æ•° $\theta$ çš„å‡½æ•° $q(x \mid \theta)$ æ¥è¿˜åŸ/è¿‘ä¼¼çœŸå®çš„æ•°æ®åˆ†å¸ƒã€‚ä½†æ˜¯ä¼˜åŒ–è¿‡ç¨‹ä¸­ï¼Œæƒ³è¦ä¿è¯åˆ†å¸ƒçš„å½’ä¸€åŒ–æ€§è´¨å¹¶ä¸å®¹æ˜“ã€‚ä¸€ä¸ªå¾ˆæ˜¾ç„¶æ€è·¯æ—¶ä¼˜åŒ–å®Œæˆåé€šè¿‡å½’ä¸€åŒ–ç³»æ•°æ¥ä¿è¯å½’ä¸€åŒ–æ€§è´¨ï¼š
$$
\begin{array}{c}
p(x\mid \theta) = \frac{1}{Z(\theta)}q(x\mid \theta)\\
\text{where: } Z(\theta) = \int q(x\mid \theta) dx
\end{array}
$$ä½†æ˜¯åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œç”Ÿæˆæ¨¡å‹éœ€è¦å¤„ç†ä¸€ä¸ªæé«˜ç»´åº¦éšæœºå‘é‡çš„æ¦‚ç‡åˆ†å¸ƒçš„ç§¯åˆ†ã€‚æ­¤æ—¶å½’ä¸€åŒ–ç³»æ•° $Z(\theta)$ çš„è®¡ç®—å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚ï¼ˆå¦‚æœå®åœ¨å¸Œæœ›ç›´æ¥è®¡ç®—ï¼Œå¯ä»¥ç”¨æ•°å€¼æ–¹æ³•æˆ–è€… MCMCï¼Œä½†æ˜¯è¿™ç±»æ–¹æ³•åŒæ ·å¾ˆéš¾ç›´æ¥è®¡ç®—ã€‚ï¼‰
è¦è§£å†³å½’ä¸€åŒ–é—®é¢˜çš„åŠæ³•å…¶å®å¾ˆå¤šï¼Œäº‹å®ä¸Šè¿™åœ¨éšæœºåˆ†å¸ƒä¼°è®¡ä¸­æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„é—®é¢˜ã€‚æˆ‘ä»¬ä¸å¦¨ä¸¾ä¸€äº›æ˜¾ç„¶çš„æ–¹æ¡ˆï¼Œä¾‹å¦‚ Flow Moduleã€Bolzemann Machineã€Variational Autoencoder ç­‰ç­‰ã€‚é‚£ä¹ˆå¦‚æœå½’ä¸€åŒ–çš„åˆ†å¸ƒä¸å¥½å¤„ç†ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªä¸å½’ä¸€åŒ–çš„æ¦‚ç‡åˆ†å¸ƒç­‰ä»·çš„ï¼Œä¸éœ€è¦å½’ä¸€æ¢çš„å½¢å¼ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œå°±æ˜¯æˆ‘ä»¬åé¢è¦ä»‹ç»çš„ Score Function å’Œå¯¹åº”çš„ä¼°è®¡çš„æ–¹æ³• Score Matchingã€‚
2. Score Function
å¯¹äºä¸€ä¸ªå—åˆ°å‚æ•° $\boldsymbol{\theta}$ æ§åˆ¶çš„ï¼Œå…³äºéšæœºå‘é‡ $\boldsymbol{\xi}$ çš„éšæœºåˆ†å¸ƒ $p(\boldsymbol{\xi}, \boldsymbol{\theta})$ã€‚æˆ‘ä»¬å®šä¹‰å…¶å¯¹æ•°æ¢¯åº¦ä¸ºå…¶ Score Functionã€‚å½¢å¼åŒ–çš„ï¼Œå¯ä»¥å†™ä½œï¼š
$$
\psi (\boldsymbol{\xi}, \boldsymbol{\theta}) =
\begin{pmatrix}
  \frac{\partial p(\boldsymbol{\xi}, \boldsymbol{\theta})}{\partial \boldsymbol{\xi}_1}\\
  \frac{\partial p(\boldsymbol{\xi}, \boldsymbol{\theta})}{\partial \boldsymbol{\xi}_2}\\
  \vdots\\
  \frac{\partial p(\boldsymbol{\xi}, \boldsymbol{\theta})}{\partial \boldsymbol{\xi}_n}
\end{pmatrix} =
\begin{pmatrix}
  \psi_1(\boldsymbol{\xi}, \boldsymbol{\theta})\\
  \psi_2(\boldsymbol{\xi}, \boldsymbol{\theta})\\
  \vdots\\
  \psi_n(\boldsymbol{\xi}, \boldsymbol{\theta})
\end{pmatrix} =
\nabla_{\boldsymbol{\xi}} \log p(\boldsymbol{\xi}, \boldsymbol{\theta})
$$æˆ‘ä»¬ä¸éš¾å‘ç°ï¼š"><meta name=author content="WangJV"><link rel=canonical href=https://wangjv0812.github.io/WangJV-Blog-Pages/2025/08/scorematching/><link crossorigin=anonymous href=https://wangjv0812.github.io/WangJV-Blog-Pages/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://wangjv0812.github.io/WangJV-Blog-Pages/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://wangjv0812.github.io/WangJV-Blog-Pages/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://wangjv0812.github.io/WangJV-Blog-Pages/favicon-32x32.png><link rel=apple-touch-icon href=https://wangjv0812.github.io/WangJV-Blog-Pages/apple-touch-icon.png><link rel=mask-icon href=https://wangjv0812.github.io/WangJV-Blog-Pages/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://wangjv0812.github.io/WangJV-Blog-Pages/2025/08/scorematching/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script>MathJax={tex:{displayMath:[["\\[","\\]"],["$$","$$"]],inlineMath:[["\\(","\\)"],["$","$"]]},loader:{load:["ui/safe"]}}</script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script><meta property="og:url" content="https://wangjv0812.github.io/WangJV-Blog-Pages/2025/08/scorematching/"><meta property="og:site_name" content="WangJV Blog"><meta property="og:title" content="ScoreMatching"><meta property="og:description" content="1. ä¸ºä»€ä¹ˆè¦ç”¨ Score Matching å¾ˆå¤šæ˜¯å¦ï¼Œæˆ‘ä»¬å¸Œæœ›ä»å¤§é‡çš„æ•°æ® $x_1, x_2, \cdots x_n$ï¼ˆæˆ–è€…æ¢å¥è¯è¯´ï¼Œä»ä¸€ä¸ªéšæœºå˜é‡ $X$ çš„å¤§é‡æŠ½è±¡ï¼‰è¿˜åŸå›åˆ†å¸ƒ $p(x)$ æœ¬èº«ã€‚ä¸€ä¸ªå¾ˆæ˜¾ç„¶çš„æƒ³æ³•æ˜¯é€šè¿‡ä¸€ä¸ªå¸¦æœ‰å¯ä¼˜åŒ–å‚æ•° $\theta$ çš„å‡½æ•° $q(x \mid \theta)$ æ¥è¿˜åŸ/è¿‘ä¼¼çœŸå®çš„æ•°æ®åˆ†å¸ƒã€‚ä½†æ˜¯ä¼˜åŒ–è¿‡ç¨‹ä¸­ï¼Œæƒ³è¦ä¿è¯åˆ†å¸ƒçš„å½’ä¸€åŒ–æ€§è´¨å¹¶ä¸å®¹æ˜“ã€‚ä¸€ä¸ªå¾ˆæ˜¾ç„¶æ€è·¯æ—¶ä¼˜åŒ–å®Œæˆåé€šè¿‡å½’ä¸€åŒ–ç³»æ•°æ¥ä¿è¯å½’ä¸€åŒ–æ€§è´¨ï¼š
$$ \begin{array}{c} p(x\mid \theta) = \frac{1}{Z(\theta)}q(x\mid \theta)\\ \text{where: } Z(\theta) = \int q(x\mid \theta) dx \end{array} $$ä½†æ˜¯åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œç”Ÿæˆæ¨¡å‹éœ€è¦å¤„ç†ä¸€ä¸ªæé«˜ç»´åº¦éšæœºå‘é‡çš„æ¦‚ç‡åˆ†å¸ƒçš„ç§¯åˆ†ã€‚æ­¤æ—¶å½’ä¸€åŒ–ç³»æ•° $Z(\theta)$ çš„è®¡ç®—å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚ï¼ˆå¦‚æœå®åœ¨å¸Œæœ›ç›´æ¥è®¡ç®—ï¼Œå¯ä»¥ç”¨æ•°å€¼æ–¹æ³•æˆ–è€… MCMCï¼Œä½†æ˜¯è¿™ç±»æ–¹æ³•åŒæ ·å¾ˆéš¾ç›´æ¥è®¡ç®—ã€‚ï¼‰
è¦è§£å†³å½’ä¸€åŒ–é—®é¢˜çš„åŠæ³•å…¶å®å¾ˆå¤šï¼Œäº‹å®ä¸Šè¿™åœ¨éšæœºåˆ†å¸ƒä¼°è®¡ä¸­æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„é—®é¢˜ã€‚æˆ‘ä»¬ä¸å¦¨ä¸¾ä¸€äº›æ˜¾ç„¶çš„æ–¹æ¡ˆï¼Œä¾‹å¦‚ Flow Moduleã€Bolzemann Machineã€Variational Autoencoder ç­‰ç­‰ã€‚é‚£ä¹ˆå¦‚æœå½’ä¸€åŒ–çš„åˆ†å¸ƒä¸å¥½å¤„ç†ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªä¸å½’ä¸€åŒ–çš„æ¦‚ç‡åˆ†å¸ƒç­‰ä»·çš„ï¼Œä¸éœ€è¦å½’ä¸€æ¢çš„å½¢å¼ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œå°±æ˜¯æˆ‘ä»¬åé¢è¦ä»‹ç»çš„ Score Function å’Œå¯¹åº”çš„ä¼°è®¡çš„æ–¹æ³• Score Matchingã€‚
2. Score Function å¯¹äºä¸€ä¸ªå—åˆ°å‚æ•° $\boldsymbol{\theta}$ æ§åˆ¶çš„ï¼Œå…³äºéšæœºå‘é‡ $\boldsymbol{\xi}$ çš„éšæœºåˆ†å¸ƒ $p(\boldsymbol{\xi}, \boldsymbol{\theta})$ã€‚æˆ‘ä»¬å®šä¹‰å…¶å¯¹æ•°æ¢¯åº¦ä¸ºå…¶ Score Functionã€‚å½¢å¼åŒ–çš„ï¼Œå¯ä»¥å†™ä½œï¼š
$$ \psi (\boldsymbol{\xi}, \boldsymbol{\theta}) = \begin{pmatrix} \frac{\partial p(\boldsymbol{\xi}, \boldsymbol{\theta})}{\partial \boldsymbol{\xi}_1}\\ \frac{\partial p(\boldsymbol{\xi}, \boldsymbol{\theta})}{\partial \boldsymbol{\xi}_2}\\ \vdots\\ \frac{\partial p(\boldsymbol{\xi}, \boldsymbol{\theta})}{\partial \boldsymbol{\xi}_n} \end{pmatrix} = \begin{pmatrix} \psi_1(\boldsymbol{\xi}, \boldsymbol{\theta})\\ \psi_2(\boldsymbol{\xi}, \boldsymbol{\theta})\\ \vdots\\ \psi_n(\boldsymbol{\xi}, \boldsymbol{\theta}) \end{pmatrix} = \nabla_{\boldsymbol{\xi}} \log p(\boldsymbol{\xi}, \boldsymbol{\theta}) $$æˆ‘ä»¬ä¸éš¾å‘ç°ï¼š"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-08-06T16:29:40+08:00"><meta property="article:modified_time" content="2025-08-06T16:29:40+08:00"><meta property="article:tag" content="Unsupervised Learning"><meta property="article:tag" content="æ•°æ®ç”Ÿæˆ"><meta property="article:tag" content="å¯¹æ¯”å­¦ä¹ "><meta property="og:image" content="https://wangjv0812.github.io/WangJV-Blog-Pages/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wangjv0812.github.io/WangJV-Blog-Pages/"><meta name=twitter:title content="ScoreMatching"><meta name=twitter:description content="1. ä¸ºä»€ä¹ˆè¦ç”¨ Score Matching
å¾ˆå¤šæ˜¯å¦ï¼Œæˆ‘ä»¬å¸Œæœ›ä»å¤§é‡çš„æ•°æ® $x_1, x_2, \cdots x_n$ï¼ˆæˆ–è€…æ¢å¥è¯è¯´ï¼Œä»ä¸€ä¸ªéšæœºå˜é‡ $X$ çš„å¤§é‡æŠ½è±¡ï¼‰è¿˜åŸå›åˆ†å¸ƒ $p(x)$ æœ¬èº«ã€‚ä¸€ä¸ªå¾ˆæ˜¾ç„¶çš„æƒ³æ³•æ˜¯é€šè¿‡ä¸€ä¸ªå¸¦æœ‰å¯ä¼˜åŒ–å‚æ•° $\theta$ çš„å‡½æ•° $q(x \mid \theta)$ æ¥è¿˜åŸ/è¿‘ä¼¼çœŸå®çš„æ•°æ®åˆ†å¸ƒã€‚ä½†æ˜¯ä¼˜åŒ–è¿‡ç¨‹ä¸­ï¼Œæƒ³è¦ä¿è¯åˆ†å¸ƒçš„å½’ä¸€åŒ–æ€§è´¨å¹¶ä¸å®¹æ˜“ã€‚ä¸€ä¸ªå¾ˆæ˜¾ç„¶æ€è·¯æ—¶ä¼˜åŒ–å®Œæˆåé€šè¿‡å½’ä¸€åŒ–ç³»æ•°æ¥ä¿è¯å½’ä¸€åŒ–æ€§è´¨ï¼š
$$
\begin{array}{c}
p(x\mid \theta) = \frac{1}{Z(\theta)}q(x\mid \theta)\\
\text{where: } Z(\theta) = \int q(x\mid \theta) dx
\end{array}
$$ä½†æ˜¯åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œç”Ÿæˆæ¨¡å‹éœ€è¦å¤„ç†ä¸€ä¸ªæé«˜ç»´åº¦éšæœºå‘é‡çš„æ¦‚ç‡åˆ†å¸ƒçš„ç§¯åˆ†ã€‚æ­¤æ—¶å½’ä¸€åŒ–ç³»æ•° $Z(\theta)$ çš„è®¡ç®—å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚ï¼ˆå¦‚æœå®åœ¨å¸Œæœ›ç›´æ¥è®¡ç®—ï¼Œå¯ä»¥ç”¨æ•°å€¼æ–¹æ³•æˆ–è€… MCMCï¼Œä½†æ˜¯è¿™ç±»æ–¹æ³•åŒæ ·å¾ˆéš¾ç›´æ¥è®¡ç®—ã€‚ï¼‰
è¦è§£å†³å½’ä¸€åŒ–é—®é¢˜çš„åŠæ³•å…¶å®å¾ˆå¤šï¼Œäº‹å®ä¸Šè¿™åœ¨éšæœºåˆ†å¸ƒä¼°è®¡ä¸­æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„é—®é¢˜ã€‚æˆ‘ä»¬ä¸å¦¨ä¸¾ä¸€äº›æ˜¾ç„¶çš„æ–¹æ¡ˆï¼Œä¾‹å¦‚ Flow Moduleã€Bolzemann Machineã€Variational Autoencoder ç­‰ç­‰ã€‚é‚£ä¹ˆå¦‚æœå½’ä¸€åŒ–çš„åˆ†å¸ƒä¸å¥½å¤„ç†ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªä¸å½’ä¸€åŒ–çš„æ¦‚ç‡åˆ†å¸ƒç­‰ä»·çš„ï¼Œä¸éœ€è¦å½’ä¸€æ¢çš„å½¢å¼ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œå°±æ˜¯æˆ‘ä»¬åé¢è¦ä»‹ç»çš„ Score Function å’Œå¯¹åº”çš„ä¼°è®¡çš„æ–¹æ³• Score Matchingã€‚
2. Score Function
å¯¹äºä¸€ä¸ªå—åˆ°å‚æ•° $\boldsymbol{\theta}$ æ§åˆ¶çš„ï¼Œå…³äºéšæœºå‘é‡ $\boldsymbol{\xi}$ çš„éšæœºåˆ†å¸ƒ $p(\boldsymbol{\xi}, \boldsymbol{\theta})$ã€‚æˆ‘ä»¬å®šä¹‰å…¶å¯¹æ•°æ¢¯åº¦ä¸ºå…¶ Score Functionã€‚å½¢å¼åŒ–çš„ï¼Œå¯ä»¥å†™ä½œï¼š
$$
\psi (\boldsymbol{\xi}, \boldsymbol{\theta}) =
\begin{pmatrix}
  \frac{\partial p(\boldsymbol{\xi}, \boldsymbol{\theta})}{\partial \boldsymbol{\xi}_1}\\
  \frac{\partial p(\boldsymbol{\xi}, \boldsymbol{\theta})}{\partial \boldsymbol{\xi}_2}\\
  \vdots\\
  \frac{\partial p(\boldsymbol{\xi}, \boldsymbol{\theta})}{\partial \boldsymbol{\xi}_n}
\end{pmatrix} =
\begin{pmatrix}
  \psi_1(\boldsymbol{\xi}, \boldsymbol{\theta})\\
  \psi_2(\boldsymbol{\xi}, \boldsymbol{\theta})\\
  \vdots\\
  \psi_n(\boldsymbol{\xi}, \boldsymbol{\theta})
\end{pmatrix} =
\nabla_{\boldsymbol{\xi}} \log p(\boldsymbol{\xi}, \boldsymbol{\theta})
$$æˆ‘ä»¬ä¸éš¾å‘ç°ï¼š"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wangjv0812.github.io/WangJV-Blog-Pages/posts/"},{"@type":"ListItem","position":2,"name":"ScoreMatching","item":"https://wangjv0812.github.io/WangJV-Blog-Pages/2025/08/scorematching/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ScoreMatching","name":"ScoreMatching","description":"1. ä¸ºä»€ä¹ˆè¦ç”¨ Score Matching å¾ˆå¤šæ˜¯å¦ï¼Œæˆ‘ä»¬å¸Œæœ›ä»å¤§é‡çš„æ•°æ® $x_1, x_2, \\cdots x_n$ï¼ˆæˆ–è€…æ¢å¥è¯è¯´ï¼Œä»ä¸€ä¸ªéšæœºå˜é‡ $X$ çš„å¤§é‡æŠ½è±¡ï¼‰è¿˜åŸå›åˆ†å¸ƒ $p(x)$ æœ¬èº«ã€‚ä¸€ä¸ªå¾ˆæ˜¾ç„¶çš„æƒ³æ³•æ˜¯é€šè¿‡ä¸€ä¸ªå¸¦æœ‰å¯ä¼˜åŒ–å‚æ•° $\\theta$ çš„å‡½æ•° $q(x \\mid \\theta)$ æ¥è¿˜åŸ/è¿‘ä¼¼çœŸå®çš„æ•°æ®åˆ†å¸ƒã€‚ä½†æ˜¯ä¼˜åŒ–è¿‡ç¨‹ä¸­ï¼Œæƒ³è¦ä¿è¯åˆ†å¸ƒçš„å½’ä¸€åŒ–æ€§è´¨å¹¶ä¸å®¹æ˜“ã€‚ä¸€ä¸ªå¾ˆæ˜¾ç„¶æ€è·¯æ—¶ä¼˜åŒ–å®Œæˆåé€šè¿‡å½’ä¸€åŒ–ç³»æ•°æ¥ä¿è¯å½’ä¸€åŒ–æ€§è´¨ï¼š\n$$ \\begin{array}{c} p(x\\mid \\theta) = \\frac{1}{Z(\\theta)}q(x\\mid \\theta)\\\\ \\text{where: } Z(\\theta) = \\int q(x\\mid \\theta) dx \\end{array} $$ä½†æ˜¯åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œç”Ÿæˆæ¨¡å‹éœ€è¦å¤„ç†ä¸€ä¸ªæé«˜ç»´åº¦éšæœºå‘é‡çš„æ¦‚ç‡åˆ†å¸ƒçš„ç§¯åˆ†ã€‚æ­¤æ—¶å½’ä¸€åŒ–ç³»æ•° $Z(\\theta)$ çš„è®¡ç®—å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚ï¼ˆå¦‚æœå®åœ¨å¸Œæœ›ç›´æ¥è®¡ç®—ï¼Œå¯ä»¥ç”¨æ•°å€¼æ–¹æ³•æˆ–è€… MCMCï¼Œä½†æ˜¯è¿™ç±»æ–¹æ³•åŒæ ·å¾ˆéš¾ç›´æ¥è®¡ç®—ã€‚ï¼‰\nè¦è§£å†³å½’ä¸€åŒ–é—®é¢˜çš„åŠæ³•å…¶å®å¾ˆå¤šï¼Œäº‹å®ä¸Šè¿™åœ¨éšæœºåˆ†å¸ƒä¼°è®¡ä¸­æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„é—®é¢˜ã€‚æˆ‘ä»¬ä¸å¦¨ä¸¾ä¸€äº›æ˜¾ç„¶çš„æ–¹æ¡ˆï¼Œä¾‹å¦‚ Flow Moduleã€Bolzemann Machineã€Variational Autoencoder ç­‰ç­‰ã€‚é‚£ä¹ˆå¦‚æœå½’ä¸€åŒ–çš„åˆ†å¸ƒä¸å¥½å¤„ç†ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªä¸å½’ä¸€åŒ–çš„æ¦‚ç‡åˆ†å¸ƒç­‰ä»·çš„ï¼Œä¸éœ€è¦å½’ä¸€æ¢çš„å½¢å¼ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œå°±æ˜¯æˆ‘ä»¬åé¢è¦ä»‹ç»çš„ Score Function å’Œå¯¹åº”çš„ä¼°è®¡çš„æ–¹æ³• Score Matchingã€‚\n2. Score Function å¯¹äºä¸€ä¸ªå—åˆ°å‚æ•° $\\boldsymbol{\\theta}$ æ§åˆ¶çš„ï¼Œå…³äºéšæœºå‘é‡ $\\boldsymbol{\\xi}$ çš„éšæœºåˆ†å¸ƒ $p(\\boldsymbol{\\xi}, \\boldsymbol{\\theta})$ã€‚æˆ‘ä»¬å®šä¹‰å…¶å¯¹æ•°æ¢¯åº¦ä¸ºå…¶ Score Functionã€‚å½¢å¼åŒ–çš„ï¼Œå¯ä»¥å†™ä½œï¼š\n$$ \\psi (\\boldsymbol{\\xi}, \\boldsymbol{\\theta}) = \\begin{pmatrix} \\frac{\\partial p(\\boldsymbol{\\xi}, \\boldsymbol{\\theta})}{\\partial \\boldsymbol{\\xi}_1}\\\\ \\frac{\\partial p(\\boldsymbol{\\xi}, \\boldsymbol{\\theta})}{\\partial \\boldsymbol{\\xi}_2}\\\\ \\vdots\\\\ \\frac{\\partial p(\\boldsymbol{\\xi}, \\boldsymbol{\\theta})}{\\partial \\boldsymbol{\\xi}_n} \\end{pmatrix} = \\begin{pmatrix} \\psi_1(\\boldsymbol{\\xi}, \\boldsymbol{\\theta})\\\\ \\psi_2(\\boldsymbol{\\xi}, \\boldsymbol{\\theta})\\\\ \\vdots\\\\ \\psi_n(\\boldsymbol{\\xi}, \\boldsymbol{\\theta}) \\end{pmatrix} = \\nabla_{\\boldsymbol{\\xi}} \\log p(\\boldsymbol{\\xi}, \\boldsymbol{\\theta}) $$æˆ‘ä»¬ä¸éš¾å‘ç°ï¼š\n","keywords":["unsupervised learning","æ•°æ®ç”Ÿæˆ","å¯¹æ¯”å­¦ä¹ "],"articleBody":"1. ä¸ºä»€ä¹ˆè¦ç”¨ Score Matching å¾ˆå¤šæ˜¯å¦ï¼Œæˆ‘ä»¬å¸Œæœ›ä»å¤§é‡çš„æ•°æ® $x_1, x_2, \\cdots x_n$ï¼ˆæˆ–è€…æ¢å¥è¯è¯´ï¼Œä»ä¸€ä¸ªéšæœºå˜é‡ $X$ çš„å¤§é‡æŠ½è±¡ï¼‰è¿˜åŸå›åˆ†å¸ƒ $p(x)$ æœ¬èº«ã€‚ä¸€ä¸ªå¾ˆæ˜¾ç„¶çš„æƒ³æ³•æ˜¯é€šè¿‡ä¸€ä¸ªå¸¦æœ‰å¯ä¼˜åŒ–å‚æ•° $\\theta$ çš„å‡½æ•° $q(x \\mid \\theta)$ æ¥è¿˜åŸ/è¿‘ä¼¼çœŸå®çš„æ•°æ®åˆ†å¸ƒã€‚ä½†æ˜¯ä¼˜åŒ–è¿‡ç¨‹ä¸­ï¼Œæƒ³è¦ä¿è¯åˆ†å¸ƒçš„å½’ä¸€åŒ–æ€§è´¨å¹¶ä¸å®¹æ˜“ã€‚ä¸€ä¸ªå¾ˆæ˜¾ç„¶æ€è·¯æ—¶ä¼˜åŒ–å®Œæˆåé€šè¿‡å½’ä¸€åŒ–ç³»æ•°æ¥ä¿è¯å½’ä¸€åŒ–æ€§è´¨ï¼š\n$$ \\begin{array}{c} p(x\\mid \\theta) = \\frac{1}{Z(\\theta)}q(x\\mid \\theta)\\\\ \\text{where: } Z(\\theta) = \\int q(x\\mid \\theta) dx \\end{array} $$ä½†æ˜¯åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œç”Ÿæˆæ¨¡å‹éœ€è¦å¤„ç†ä¸€ä¸ªæé«˜ç»´åº¦éšæœºå‘é‡çš„æ¦‚ç‡åˆ†å¸ƒçš„ç§¯åˆ†ã€‚æ­¤æ—¶å½’ä¸€åŒ–ç³»æ•° $Z(\\theta)$ çš„è®¡ç®—å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚ï¼ˆå¦‚æœå®åœ¨å¸Œæœ›ç›´æ¥è®¡ç®—ï¼Œå¯ä»¥ç”¨æ•°å€¼æ–¹æ³•æˆ–è€… MCMCï¼Œä½†æ˜¯è¿™ç±»æ–¹æ³•åŒæ ·å¾ˆéš¾ç›´æ¥è®¡ç®—ã€‚ï¼‰\nè¦è§£å†³å½’ä¸€åŒ–é—®é¢˜çš„åŠæ³•å…¶å®å¾ˆå¤šï¼Œäº‹å®ä¸Šè¿™åœ¨éšæœºåˆ†å¸ƒä¼°è®¡ä¸­æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„é—®é¢˜ã€‚æˆ‘ä»¬ä¸å¦¨ä¸¾ä¸€äº›æ˜¾ç„¶çš„æ–¹æ¡ˆï¼Œä¾‹å¦‚ Flow Moduleã€Bolzemann Machineã€Variational Autoencoder ç­‰ç­‰ã€‚é‚£ä¹ˆå¦‚æœå½’ä¸€åŒ–çš„åˆ†å¸ƒä¸å¥½å¤„ç†ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªä¸å½’ä¸€åŒ–çš„æ¦‚ç‡åˆ†å¸ƒç­‰ä»·çš„ï¼Œä¸éœ€è¦å½’ä¸€æ¢çš„å½¢å¼ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œå°±æ˜¯æˆ‘ä»¬åé¢è¦ä»‹ç»çš„ Score Function å’Œå¯¹åº”çš„ä¼°è®¡çš„æ–¹æ³• Score Matchingã€‚\n2. Score Function å¯¹äºä¸€ä¸ªå—åˆ°å‚æ•° $\\boldsymbol{\\theta}$ æ§åˆ¶çš„ï¼Œå…³äºéšæœºå‘é‡ $\\boldsymbol{\\xi}$ çš„éšæœºåˆ†å¸ƒ $p(\\boldsymbol{\\xi}, \\boldsymbol{\\theta})$ã€‚æˆ‘ä»¬å®šä¹‰å…¶å¯¹æ•°æ¢¯åº¦ä¸ºå…¶ Score Functionã€‚å½¢å¼åŒ–çš„ï¼Œå¯ä»¥å†™ä½œï¼š\n$$ \\psi (\\boldsymbol{\\xi}, \\boldsymbol{\\theta}) = \\begin{pmatrix} \\frac{\\partial p(\\boldsymbol{\\xi}, \\boldsymbol{\\theta})}{\\partial \\boldsymbol{\\xi}_1}\\\\ \\frac{\\partial p(\\boldsymbol{\\xi}, \\boldsymbol{\\theta})}{\\partial \\boldsymbol{\\xi}_2}\\\\ \\vdots\\\\ \\frac{\\partial p(\\boldsymbol{\\xi}, \\boldsymbol{\\theta})}{\\partial \\boldsymbol{\\xi}_n} \\end{pmatrix} = \\begin{pmatrix} \\psi_1(\\boldsymbol{\\xi}, \\boldsymbol{\\theta})\\\\ \\psi_2(\\boldsymbol{\\xi}, \\boldsymbol{\\theta})\\\\ \\vdots\\\\ \\psi_n(\\boldsymbol{\\xi}, \\boldsymbol{\\theta}) \\end{pmatrix} = \\nabla_{\\boldsymbol{\\xi}} \\log p(\\boldsymbol{\\xi}, \\boldsymbol{\\theta}) $$æˆ‘ä»¬ä¸éš¾å‘ç°ï¼š\n$$ \\begin{aligned} \\psi (\\boldsymbol{\\xi}, \\boldsymbol{\\theta}) \u0026= \\nabla_{\\boldsymbol{\\xi}} \\log \\left( \\frac{q(\\boldsymbol{\\xi}, \\boldsymbol{\\theta})}{Z(\\boldsymbol{\\theta})} \\right)\\\\ \u0026= \\nabla_{\\boldsymbol{\\xi}} \\log q(\\boldsymbol{\\xi}, \\boldsymbol{\\theta}) - \\nabla_{\\boldsymbol{\\xi}} \\log Z(\\boldsymbol{\\theta})\\\\ \u0026= \\nabla_{\\boldsymbol{\\xi}} \\log q(\\boldsymbol{\\xi}, \\boldsymbol{\\theta}) \\end{aligned} $$ä¸éš¾å‘ç°ï¼Œåœ¨ä½¿ç”¨ Score Function è¡¨è¾¾ä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒæ—¶ï¼Œå½’ä¸€åŒ–ç³»æ•°è¢«æ¢¯åº¦å¸æ”¶äº†ã€‚æ¢å¥è¯è¯´ï¼Œä½¿ç”¨ Score Function æè¿°åˆ†å¸ƒæ—¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒå½’ä¸€åŒ–ç³»æ•° $Z(\\boldsymbol{\\theta})$ äº†ï¼Œæˆ‘ä»¬ç”¨äº†ä¸€ä¸ªå·§å¦™çš„æ•°å­¦ç»“æ„è§£å†³äº†å›°éš¾çš„å½’ä¸€åŒ–é—®é¢˜ã€‚\nä½ å¯èƒ½ä¼šé—®ï¼šâ€œæ˜¯çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå·§å¦™çš„æ•°å­¦ç»“æ„ï¼Œä½†æ˜¯å¦‚ä½•ä¼°è®¡è¿™ä¸ªåˆ†å¸ƒï¼Œå¦‚ä½•é‡‡æ ·å‘¢ï¼Ÿâ€æˆ‘ä»¬å…ˆè§£å†³é‡‡æ ·çš„é—®é¢˜ï¼Œç­”æ¡ˆæ˜¯ Langevin Dynamicsã€‚\né¢„å‘Šä¸€ä¸‹ï¼Œç¬¬äºŒä¸ªé—®é¢˜çš„ç­”æ¡ˆå°±æ˜¯æˆ‘ä»¬è¿™ç¯‡æ–‡ç« çš„ä¸»é¢˜ï¼ŒScore Matchingã€‚\n2.1. Langevin Dynamics åœ¨å­¦ä¹ äº†å¾—åˆ†å‡½æ•° $s_\\theta(\\boldsymbol{x}) \\approx \\nabla_{\\boldsymbol{x}} \\log p(\\boldsymbol{x})$ åï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†å…¶è½¬æ¢å›åŸæœ¬çš„æ¦‚ç‡åˆ†å¸ƒï¼Œè¿™å®é™…ä¸Šæ˜¯è¦è§£å†³ä¸€ä¸ªéšæœºå¾®åˆ†æ–¹ç¨‹ã€‚è¿™åŒæ ·å¹¶ä¸å®¹æ˜“ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç›´æ¥è·³è¿‡æ±‚åŸæœ¬çš„åˆ†å¸ƒè¿™ä¸€æ­¥ï¼Œç›´æ¥ä» Score Function é‡‡æ ·ï¼Œè¿™ä¸ªæ–¹æ³•è¢«ç§°ä¸ºéƒä¹‹ä¸‡åŠ¨åŠ›å­¦ (Langevin Dynamics)ã€‚éƒä¹‹ä¸‡åŠ¨åŠ›å­¦æä¾›äº†ä¸€ç§é©¬å°”å¯å¤«çš„æ–¹æ³•ï¼›å…·ä½“è€Œè¨€ï¼Œä»ä»»æ„å…ˆéªŒåˆ†å¸ƒ $x_0 \\sim \\pi(x)$ åˆå§‹åŒ–ï¼Œç„¶åè¿›è¡Œå¦‚ä¸‹è¿­ä»£ï¼š\n$$ \\begin{array}{ll} x_{i+1} = x_i + \\epsilon \\nabla_{\\boldsymbol{x}} \\log p(\\boldsymbol{x}) + \\sqrt{2\\epsilon} \\boldsymbol{z}_i \u0026 i = 0, 1, \\cdots K \\end{array} $$å…¶ä¸­ $\\boldsymbol{z_i} \\sim \\mathcal N(0, I)$ï¼Œ$\\epsilon \\to 0$, $K\\to \\infty$ã€‚å®é™…ä¸Šè¿™ä¸ªè¡Œä¸ºç±»ä¼¼ä¸æ•°å€¼å¾®åˆ†æ–¹ç¨‹çš„æ±‚è§£ï¼Œåé¢çš„é«˜æ–¯åˆ†å¸ƒé¡¹å¯ä»¥æœ‰æ•ˆçš„é¿å…é™·å…¥å±€éƒ¨æœ€ä¼˜ã€‚äº‹å®ä¸Šåªè¦è¿™ä¸ªè¿‡ç¨‹è¶³å¤Ÿï¼Œè¯¯å·®å‡ ä¹å¯ä»¥å¿½ç•¥ã€‚\n3. Score Matching ä¸€ä¸ªå¾ˆç›´è§‰çš„æƒ³æ³•æ˜¯ï¼Œå¯¹äºä¸€ä¸ªåŸå§‹åˆ†å¸ƒçš„ Score Function $\\psi_X(\\xi)$ï¼Œæˆ‘ä»¬å¸Œæœ›ç”¨ä¸€ä¸ªæ”¶å‚æ•° $\\theta$ æ§åˆ¶çš„æ¨¡å‹åˆ†å¸ƒ $\\psi(\\xi, \\theta)$ æ¥è¿‘ä¼¼ã€‚ä¸€ä¸ªå¾ˆç›´æ¥çš„æ–¹æ³•æ˜¯ç”¨ä¸€ä¸ªå‡æ–¹æœŸæœ›æ¥è¡¡é‡äºŒè€…ä¹‹é—´çš„è·ç¦»ï¼š\n$$ J(\\theta) = \\frac 1 2 \\int_{\\xi\\in R^n} p_X(\\xi)\\left\\| \\psi(\\xi, \\theta) - \\psi_X(\\xi) \\right\\| ^2 d\\xi $$è¿™é‡Œéœ€è¦æ³¨æ„åˆ°ä¸€ä¸ªç»†èŠ‚ï¼Œæ­¤å¤„æˆ‘ä»¬æ˜¯å¯¹ä¸€ä¸ªæŒ‰ç…§åŸå§‹åˆ†å¸ƒ $p_X(\\xi)$ çš„æœŸæœ›ï¼Œè¿™å¯¹æˆ‘ä»¬çš„ç¼–å†™ç¨‹åºæ˜¯æœ‰å¾ˆå¤§å¸®åŠ©çš„ã€‚å¯¹äºä¸€ä¸ªæœ‰ $m$ ä¸ªæ•°æ®çš„åŸå§‹åˆ†å¸ƒï¼ˆæ•°æ®é›†ï¼‰ï¼Œæˆ‘ä»¬å‡åŒ€éšæœºçš„é€‰æ‹©å‡ºå…¶ä¸­ $k$ ä¸ªæ•°æ®ç‚¹ $\\xi_1, \\xi_2, \\cdots, \\xi_k$ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢çš„ä¾èµ–äºåŸå§‹åˆ†å¸ƒçš„æœŸæœ›å¯ä»¥ä¼¼ä¸ºï¼š\n$$ J(\\theta) \\approx \\frac{1}{2k} \\sum_{i=1}^k \\left\\| \\psi(\\xi_i, \\theta) - \\psi_X(\\xi_i) \\right\\| ^2 $$é‚£ä¹ˆï¼Œå¯¹æ¨¡å‹åˆ†å¸ƒ $\\psi(\\xi_i, \\theta)$ çš„å‚æ•° $\\theta$ çš„ä¸€ä¸ªæœ€ä¼˜ä¼°è®¡å¯ä»¥é€šè¿‡æœ€å°åŒ–ä¸Šé¢çš„å½¢å¼æ¥è·å¾—ã€‚äº‹å®ä¸Šåœ¨è¿™ä¸ªæœ€ä¼˜ä¼°è®¡å°±æ˜¯ Score Matchingï¼š\n$$ \\hat \\theta = \\arg\\min_\\theta J(\\theta) $$ä¸Šé¢è¿™ä¸ªå½¢å¼çš„ä¼°è®¡ç¡®å®è§£å†³äº†éœ€è¦è®¡ç®—å½’ä¸€åŒ–å‚æ•°çš„ç§¯åˆ†çš„é—®é¢˜ï¼Œä½†æ˜¯æƒ³ç›´æ¥ä½¿ç”¨è¿™ä¸ªå½¢å¼ä¾æ—§å›°éš¾ã€‚å› ä¸ºæˆ‘ä»¬åœ¨äº‹å®ä¸Šæ— æ³•è®¡ç®—åŸå§‹åˆ†å¸ƒçš„ Score Function $\\psi_X(\\xi)$ã€‚Score Function çš„ç²¾å¦™ä¹‹å¤„å°±åœ¨äºé€šè¿‡ä¸€ä¸ªæ•°å­¦å˜æ¢é¿å…äº†ç›´æ¥å¯¹åŸå§‹åˆ†å¸ƒçš„å¯¹æ•°æ¢¯åº¦çš„ä¾èµ–ã€‚\næˆ‘ä»¬ä¸å¦¨å‡è®¾æ¨¡å‹åˆ†å¸ƒçš„ Score Function $\\psi(\\xi_i, \\theta)$ æ˜¯å¯å¯¼ã€‚å±•å¼€å‡æ–¹å½¢å¼ï¼Œæœ‰ï¼š\n$$ \\begin{aligned} J(\\theta) \u0026= \\frac 1 2 \\int_{\\xi\\in R^n} p_X(\\xi)\\left\\| \\psi(\\xi, \\theta) - \\psi_X(\\xi) \\right\\| ^2 d\\xi\\\\ \u0026= \\frac 1 2 \\int_{\\xi\\in R^n} p_X(\\xi) \\left( \\psi^2(\\xi, \\theta) - 2 \\psi(\\xi, \\theta) \\psi_X(\\xi) + \\psi_X^2(\\xi) \\right) d\\xi\\\\ \u0026= \\frac 1 2\\int_{\\xi\\in R^n} p_X(\\xi)\\psi^2(\\xi, \\theta) d\\xi - \\int_{\\xi\\in R^n} p_X(\\xi)\\psi(\\xi, \\theta) \\psi_X(\\xi) d\\xi + \\frac 1 2 \\int_{\\xi\\in R^n} p_X(\\xi)\\psi_X^2(\\xi) d\\xi\\\\ \\end{aligned} $$æ˜¾ç„¶ï¼Œå…¶ä¸­ $\\int_{\\xi\\in R^n} p_X(\\xi)\\psi_X^2(\\xi) d\\xi$ ä¸åŒ…å«å¾…ä¼˜åŒ–å‚æ•° $\\theta$ï¼Œå¯ä»¥å¿½ç•¥ï¼Œä¸Šå¼ç®€åŒ–ä¸ºï¼š\n$$ J(\\theta) = \\frac 1 2\\int_{\\xi\\in R^n} p_X(\\xi)\\psi^2(\\xi, \\theta) d\\xi - \\int_{\\xi\\in R^n} p_X(\\xi)\\psi(\\xi, \\theta) \\psi_X(\\xi) d\\xi $$å…¶ä¸­ $\\frac 1 2\\int_{\\xi\\in R^n} p_X(\\xi)\\psi^2(\\xi, \\theta) d\\xi$ å¯ä»¥ç›´æ¥è®¡ç®—ï¼Œæˆ‘ä»¬å¹¶ä¸å…³å¿ƒã€‚éœ€è¦å¤„ç†çš„æ˜¯ $\\int_{\\xi\\in R^n} p_X(\\xi)\\psi(\\xi, \\theta)^T \\psi_X(\\xi) d\\xi$ã€‚å¯¹äºè¿™ä¸ªå½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥åšå¦‚ä¸‹å˜æ¢ï¼š\n$$ \\begin{aligned} \\int_{\\xi\\in R^n} p_X(\\xi)\\psi(\\xi, \\theta) \\psi_X(\\xi) d\\xi \u0026= \\int_{\\xi\\in R^n} p_X(\\xi) \\frac{\\partial \\log p_X(\\xi)}{\\partial \\xi_i} \\psi(\\xi, \\theta) d\\xi\\\\ \u0026= \\int_{\\xi\\in R^n} \\frac{p_X(\\xi)}{p_X(\\xi)} \\frac{\\partial p_X(\\xi)}{\\partial \\xi_i} \\psi(\\xi, \\theta) d\\xi\\\\ \u0026= \\int_{\\xi\\in R^n} \\frac{\\partial p_X(\\xi)}{\\partial \\xi_i} \\psi(\\xi, \\theta) d\\xi \\end{aligned} $$$\\frac{\\partial p_X(\\xi)}{\\partial \\xi_i}$ ä¾ç„¶ä¸å¥½è®¡ç®—ï¼Œä½†æ˜¯å¯ä»¥ç”¨åˆ†éƒ¨ç§¯åˆ†æ¥å¤„ç†ï¼š\n$$ \\begin{aligned} \\int d \\left(\\frac{\\partial \\log p(\\xi, \\theta)}{\\partial \\xi_i} p_X(\\xi)\\right) \u0026= \\int \\frac{\\partial \\log p(\\xi, \\theta)}{\\partial \\xi_i} \\frac{\\partial p_X(\\xi)}{\\partial \\xi_i} d \\xi + \\int \\frac{\\partial^2 \\log p(\\xi, \\theta)}{\\partial \\xi_i^2} p_X(\\xi) d \\xi \\end{aligned} $$é‚£ä¹ˆï¼ŒåŸå§‹åˆ†å¸ƒå¯ä»¥å˜å½¢ä¸ºï¼š\n$$ \\begin{aligned} \\int_{\\xi\\in R^n} p_X(\\xi)\\psi(\\xi, \\theta) \\psi_X(\\xi) d\\xi \u0026= \\frac{\\partial \\log p(\\xi, \\theta)}{\\partial \\xi_i} p_X(\\xi) \\bigg|^\\infty_{-\\infty} - \\int \\frac{\\partial^2 \\log p(\\xi, \\theta)}{\\partial \\xi_i^2} p_X(\\xi) d \\xi \\end{aligned} $$æˆ‘ä»¬ä¸å¦¨åšä¸€ä¸ªæ¯”è¾ƒä¸€èˆ¬çš„å‡è®¾ï¼ˆç¡®å®æ˜¯ä¸€ä¸ªå¾ˆå¼±çš„å‡è®¾ï¼‰ï¼Œå‡è®¾ $p(\\xi, \\theta)$ å’Œ $p_X(\\xi)$ æ˜¯çŸ­å°¾çš„ï¼Œä¹˜ç§¯ $\\frac{\\partial \\log p(\\xi, \\theta)}{\\partial \\xi_i} p_X(\\xi)$ åœ¨ $\\infty, -\\infty$ å¤„æ”¶æ•›ä¸º $0$ã€‚è¿™ä¸ªå‡è®¾å¼±åˆ°å‡ ä¹æ‰¾ä¸åˆ°ä¸€ä¸ªåä¾‹ï¼ˆäº‹å®ä¸Šæœ‰åä¾‹ï¼Œä¾‹å¦‚å¸•ç´¯æ‰˜åˆ†å¸ƒï¼‰ã€‚æˆ‘ä»¬å‡ ä¹æ€»æ˜¯å¯ä»¥è®¤ä¸ºè¿™ä¸ªå‡è®¾æ˜¯æˆç«‹çš„ã€‚\n$$ \\int_{\\xi\\in R^n} p_X(\\xi)\\psi(\\xi, \\theta) \\psi_X(\\xi) d\\xi = - \\int \\frac{\\partial^2 \\log p(\\xi, \\theta)}{\\partial \\xi_i^2} p_X(\\xi) d \\xi $$åŸå§‹çš„å‡æ–¹æœŸæœ›å¯ä»¥è¢«å˜æ¢ä¸ºï¼š\n$$ \\begin{aligned} J(\\theta) \u0026= \\frac 1 2\\int_{\\xi\\in R^n} p_X(\\xi)\\psi^2(\\xi, \\theta) d\\xi + \\sum_{i=1}^n\\int_{\\xi\\in R^n} \\frac{\\partial^2 \\log p(\\xi, \\theta)}{\\partial \\xi_i^2} p_X(\\xi) d \\xi \\\\ \u0026= \\int_{\\xi\\in R^n} p_X(\\xi) \\sum_{i=1}^{n} \\left[ \\frac 1 2 \\psi_i(\\xi, \\theta)^2 + \\frac{\\partial \\psi(\\xi, \\theta)}{\\partial \\xi_i} \\right] d \\xi \\end{aligned} $$é—®é¢˜å·²ç»è§£å†³äº†ï¼Œä½†æ˜¯ç»“è®ºè¿˜ä¸å¤Ÿå¥½çœ‹ã€‚ä¸å¦¨æ³¨æ„åŠ›é›†ä¸­ä¸€ç‚¹ï¼Œä¸éš¾æ³¨æ„åˆ°ï¼š\n$$ \\sum_{i=1}^{n} \\frac{\\partial^2 \\log p(\\xi, \\theta)}{\\partial \\xi_i^2} = \\text{tr} \\left(\\nabla^2_\\xi \\log p(\\xi, \\theta)\\right) $$ç»“è®ºå¯ä»¥å†™æˆä¸€ä¸ªæ›´ç®€æ´ä¼˜é›…çš„å½¢å¼ï¼š\n$$ \\begin{aligned} J(\\theta) \u0026= \\text{E}_{\\xi \\sim p_X(\\xi)}\\left[ \\text{tr} \\left(\\nabla^2_\\xi \\log p(\\xi, \\theta)\\right) + \\frac 1 2\\left\\| \\nabla_\\xi \\log p(\\xi, \\theta)\\right\\|^2\\right] \\\\ \u0026= \\text{E}_{\\xi \\sim p_X(\\xi)}\\left[ \\text{tr} \\left(\\nabla_\\xi \\psi(\\xi, \\theta)\\right) + \\frac 1 2\\left\\| \\psi(\\xi, \\theta)\\right \\|^2\\right] \\\\ \\end{aligned} $$4. è®¨è®º æˆ‘ä»¬åœ¨è¿™é‡Œåªå¸Œæœ›è®¨è®ºä¸€ä¸‹åœ¨ç¼–ç¨‹å®è·µä¸­å¯èƒ½é‡åˆ°çš„é—®é¢˜ã€‚å¯¹äºä¸€ä¸ªæœ‰ $m$ ä¸ªæ•°æ®çš„åŸå§‹åˆ†å¸ƒï¼Œæˆ‘å˜›å¯ä»¥è®¤ä¸ºæ˜¯å¯¹åŸå§‹åˆ†å¸ƒæ‰€åœ¨çš„æµå½¢ä¸Šé‡‡æ ·å‡ºäº† $m$ ä¸ªæ•°æ®ç‚¹ã€‚ä¸ºäº†æè¿°æ–¹ä¾¿ï¼Œä¸å¦¨å°†è¿™äº›é‡‡æ ·è®°ä½œ $X_1, X_2, \\cdots, X_{m}$ã€‚é‚£ä¹ˆ Score Matching çš„ç›®æ ‡å‡½æ•°å¯ä»¥å†™ä½œï¼š\n$$ \\check{J}(\\theta) = \\frac{1}{m} \\sum_{j=1}^{m} \\sum_{i=1}^{n} \\left[ \\frac 1 2 \\psi_i(\\xi, \\theta)^2 + \\frac{\\partial \\psi(\\xi, \\theta)}{\\partial \\xi_i} \\right] $$è™½ç„¶ Score Matching é¿å…äº†è®¡ç®—å¤æ‚çš„å½’ä¸€åŒ–ç³»æ•°ï¼Œä½†æ˜¯å´å¼•å…¥äº†å¦ä¸€ä¸ªè®¡ç®—ä¸Šçš„éº»çƒ¦ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—æµ·æ£®çŸ©é˜µçš„è¿¹ã€‚å¯¹äºä¸€ä¸ªç»´åº¦ä¸º $d$ çš„éšæœºåˆ†å¸ƒçš„ä¼°è®¡ $\\psi(\\xi, \\theta)$ï¼Œå…¶å¯¹äº $\\xi$ çš„æ¢¯åº¦æ˜¯ä¸€ä¸ª $d \\times d$ ç»´åº¦çš„çŸ©é˜µï¼Œåœ¨äº‹å®ä¸Šæˆ‘ä»¬è¿›è¡Œäº† $$d(d+1)/2$$ æ¬¡çš„è®¡ç®—ã€‚äº‹å®ä¸Šæˆ‘ä»¬ä¸éœ€è¦è®¡ç®—è¿™ä¹ˆå¤šå…ƒç´ ï¼Œåªéœ€è¦è®¡ç®—å¯¹è§’çº¿ä¸Šçš„å…ƒç´ å°±å¯ä»¥äº†ã€‚å…¨éƒ¨è®¡ç®—æ˜¯ååˆ†ä¸ç»æµçš„ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œä¼šç”¨å“ˆé’¦æ£®è¿¹ä¼°è®¡ï¼ˆHutchinsonâ€™s Trace Estimationï¼‰æ¥è¿‘ä¼¼ã€‚\n4.1. å“ˆé’¦æ£®è¿¹ä¼°è®¡ (Hutchinsonâ€™s Trace Estimation) å¯¹äºä»»æ„ä¸€ä¸ªæ–¹é˜µ $H\\in R^{d\\times d}$ å’Œä¸€ä¸ªæ»¡è¶³å‡å€¼ä¸º $0$ï¼Œæ–¹å·®ä¸º $I$çš„éšæœºåˆ†å¸ƒï¼ˆä¸€èˆ¬å¯ä»¥å– Rademacher åˆ†å¸ƒ æˆ–è€… æ ‡å‡†é«˜æ–¯åˆ†å¸ƒï¼‰ $v\\in R^d$ï¼Œæœ‰ï¼š\n$$ \\begin{aligned} \\mathbb{E}\\left[\\text{tr}(v^\\top H v)\\right] \u0026= \\mathbb{E} \\left[\\sum_{i=1}^d \\sum_{j=1} v_i H_{ij} v_j\\right]\\\\ \u0026= \\sum_{i=1}^d \\sum_{j=1} H_{ij}\\mathbb{E}\\left[v_i v_j^T\\right] \\end{aligned} $$å› ä¸º $v$ æ»¡è¶³æ ‡å‡†é«˜æ–¯åˆ†å¸ƒï¼Œå› æ­¤æ–¹å·® $\\mathbb{E}\\left[v_i v_j^T\\right] = I$ã€‚æ‰€ä»¥ï¼š\n$$ \\mathbb{E}\\left[\\text{tr}(v^\\top H v)\\right] = \\sum_{i=1}^d H_{ii} = \\text{tr}(H) $$æ­¤æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦ä»æ ‡å‡†é«˜æ–¯åˆ†å¸ƒä¸­é‡‡æ ·å‡ºä¸€å®š $k$ ä¸ªéšæœºå˜é‡ $v_1, v_2, \\cdots, v_k$ï¼ˆä¸€èˆ¬ $k$ æ˜¯è¿œå°äºéšæœºå˜é‡ç»´åº¦ $d$ çš„ï¼‰ï¼Œç„¶åè®¡ç®— $v^\\top Hv$ã€‚å› ä¸º $Hv$ æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ æµ·æ£®å‘é‡ç§¯ (Hessian-Vector Product, HVP)ã€‚\nHVP åœ¨è®¡ç®—ä¸Šæ˜¯ç»æµçš„ï¼Œæ˜¯å› ä¸ºï¼š\n$$ \\nabla_\\xi^2 p(\\xi; \\theta) v = \\nabla_\\xi \\left(\\nabla_\\xi p(\\xi; \\theta) v\\right) $$ä¸éš¾å‘ç°:\n$$ \\begin{array}{lc} \\text{Hessian-Vector Product} \u0026 \\text{Shape}\\\\ \\nabla_\\xi^2 p(\\xi; \\theta) \u0026 d \\times d\\\\ \\nabla_\\xi p(\\xi; \\theta) \u0026 d \\times 1\\\\ \\nabla_\\xi p(\\xi; \\theta) \\cdot v \u0026 1 \\times 1\\\\ \\nabla_\\xi[\\nabla_\\xi p(\\xi; \\theta)v] \u0026 d \\times 1\\\\ \\end{array} $$è¿™ä¸ªè®¡ç®—è¿‡ç¨‹ä¸­é¿å…äº†ç›´æ¥å­˜å‚¨å’Œè®¡ç®—é«˜ç»´çš„ Hessian Matrixã€‚å› æ­¤å…·æœ‰é«˜æ•ˆæ€§ã€‚\n4.2. éšåˆ†å¸ƒä¼°è®¡ (Score Estimation for Implicit Distributions) ä¸€äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šé¢å¯¹ä¸€äº›éšå¼åˆ†å¸ƒï¼Œè¿™äº›åˆ†å¸ƒå¸¸å¸¸å®¹æ˜“é‡‡æ ·ï¼Œä½†æ˜¯éš¾ç§»ç›´æ¥è®¡ç®—æ¦‚ç‡å¯†åº¦ã€‚ä¾‹å¦‚å¯¹æŠ—ç”Ÿæˆç½‘ç»œ (GAN) çš„ç”Ÿæˆå™¨ã€‚GAN çš„ç”Ÿæˆå™¨å¯ä»¥çœ‹ä½œä¸€ä¸ªä¸“é—¨ç”¨æ¥åšé‡‡æ ·çš„å‡½æ•°ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬å¸Œæœ›å¾—çŸ¥æŸä¸€ä¸ªé‡‡æ ·ç»“æœåœ¨åˆ†å¸ƒä¸­çš„æ¦‚ç‡ï¼Œè¿™å°±å¾ˆéš¾äº†ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼ŒScore Function $\\psi_q(x) = \\nabla_x \\log q_\\theta(x)$ å°±å¾ˆæœ‰ç”¨äº†ã€‚\nä¸‹é¢ä¸å¦¨ç”¨ä¸€ä¸ªä¾‹å­ï¼Œæ¥å…·ä½“è®²è®² Score Matching åœ¨éšåˆ†å¸ƒä¼°è®¡ä¸­çš„åº”ç”¨ã€‚åœ¨ Variational Free Energy ä¸­ï¼Œå¸¸å¸¸ä½¿ç”¨ ç†µæ­£åˆ™åŒ– ï¼ˆEntropy Regularizationï¼‰æ¥å¸®åŠ©ä¼˜åŒ–ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œå¯¹äºä¸€ä¸ªéšåˆ†å¸ƒ $q(x)$ï¼Œå…¶ç†µå¯ä»¥å†™ä½œï¼š\n$$ H\\left(q_\\theta(x)\\right) = \\mathbb{E}_{q_\\theta(x)}\\big[\\log q_\\theta(x)\\big] $$ç†µä¸€èˆ¬ç”¨æ¥è¡¡é‡ä¸€ä¸ªåˆ†å¸ƒçš„ä¸ç¡®å®šç¨‹åº¦ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºç†µæ­£åˆ™åŒ–æ˜¯ä¸€ç§ â€œæ¨¡å‹æ¨åŠ¨åŠ›â€ï¼Œå®ƒä¼šä¿ƒä½¿æ¨¡å‹å»æ¢ç´¢æ›´å¹¿å¤§çš„åˆ†å¸ƒç©ºé—´ï¼Œæé«˜æ¨¡å‹çš„å¤šæ ·æ€§ã€‚ä½†æ˜¯å¯¹äºä¸€ä¸ª GAN ç”Ÿæˆå™¨ï¼Œæˆ‘ä»¬åªèƒ½å¾ˆæ–¹ä¾¿çš„å®ç°é‡‡æ ·ï¼Œç†µæ­£æ‚åŒ–å¹¶ä¸å®¹æ˜“ã€‚\nä¾‹å¦‚å¯¹äºä¸€ä¸ªç”Ÿæˆå™¨ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºå­˜åœ¨ä¸€ä¸ªè®­ç»ƒçš„ã€ç¡®å®šæ€§çš„å˜æ¢ $g_\\theta(\\epsilon)$ï¼Œè¿™ä¸ªå˜æ¢å°†ä¸€ä¸ªç®€å•çš„åˆ†å¸ƒ $\\epsilon$ï¼ˆä¸€èˆ¬æ˜¯æ­£æ€åˆ†å¸ƒï¼‰ å˜æ¢åˆ°ä¸€ä¸ªå¤æ‚åˆ†å¸ƒä¸Šï¼ˆå°±æ˜¯æˆ‘ä»¬çš„ç›®æ ‡åˆ†å¸ƒï¼‰ï¼Œå› æ­¤åœ¨é‡‡æ ·ä¸­ï¼Œåªéœ€è¦åœ¨æ­£æ€åˆ†å¸ƒ $\\epsilon$ ä¸Šé‡‡æ ·ï¼Œå¹¶é€šè¿‡å˜æ¢ $g_\\theta(\\epsilon)$ è·å¾—ä¸€ä¸ªé‡‡æ · $x = g_\\theta(\\epsilon)$ã€‚ä½†æ˜¯å…³äºé‡‡æ · $x$ çš„æ¦‚ç‡å¯†åº¦ï¼Œæˆ‘ä»¬å¹¶ä¸æ¸…æ¥šï¼Œè¿™å¯¼è‡´æˆ‘ä»¬æ— æ³•ç›´æ¥è®¡ç®—ç†µæ­£åˆ™åŒ–ã€‚ä½†æ˜¯ç†µæ­£åˆ™åŒ–å…³äºå¯å­¦ä¹ å‚æ•°çš„æ¢¯åº¦å¯ä»¥å†™ä½œï¼š\n$$ \\begin{aligned} \\nabla_\\theta H\\left(q_\\theta(x)\\right) \u0026= \\nabla_\\theta \\mathbb{E}_{q_\\theta(x)}\\big[\\log q_\\theta(x)\\big]\\\\ \u0026= \\nabla_\\theta \\mathbb{E}_{p(\\epsilon)}\\big[ \\log q_\\theta(g_\\theta(\\epsilon)) \\big]\\\\ \u0026= \\mathbb{E}_{p(\\epsilon)}\\big[ \\nabla_x \\log q_\\theta(x)\\bigg|_{x=g_\\theta(\\epsilon)} \\nabla_\\theta g_\\theta(\\epsilon)\\big]\\\\ \\end{aligned} $$å…¶ä¸­ $\\nabla_\\theta g_\\theta(\\epsilon)$ï¼Œç›´æ¥åå‘ä¼ æ’­å³å¯ï¼Œæ¯”è¾ƒå®¹æ˜“è®¡ç®—ã€‚è€Œ $\\nabla_x \\log q_\\theta(x)\\bigg|_{x=g_\\theta(\\epsilon)}$ åˆ™æ˜¯ä¸€ä¸ª Score Functionã€‚ä½†æ˜¯è¿™é¡¹ä¾ç„¶æ²¡æ³•ç›´æ¥ç®—ï¼Œå¯ä»¥é€šè¿‡ Score Matching æ¥ä¼°è®¡ã€‚\næ­¤æ—¶ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›é€šè¿‡ç†µæ­£åˆ™åŒ–æ¥ä¼˜åŒ–æˆ‘ä»¬çš„æ¨¡å‹ï¼Œåˆ™éœ€è¦å…ˆé€šè¿‡ä¸€ä¸ª Score Matching æ¥ä¼°è®¡ Score Function $\\nabla_x \\log q_\\theta(x)$ï¼Œç„¶åå†é€šè¿‡ä¸Šé¢çš„å½¢å¼æ¥è®¡ç®—æ¢¯åº¦ã€‚\nreference @article{JMLR:v6:hyvarinen05a, author = {Aapo Hyv{{\"a}}rinen}, title = {Estimation of Non-Normalized Statistical Models by Score Matching}, journal = {Journal of Machine Learning Research}, year = {2005}, volume = {6}, number = {24}, pages = {695â€“709}, url = {http://jmlr.org/papers/v6/hyvarinen05a.html} }\n","wordCount":"910","inLanguage":"en","image":"https://wangjv0812.github.io/WangJV-Blog-Pages/","datePublished":"2025-08-06T16:29:40+08:00","dateModified":"2025-08-06T16:29:40+08:00","author":{"@type":"Person","name":"WangJV"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wangjv0812.github.io/WangJV-Blog-Pages/2025/08/scorematching/"},"publisher":{"@type":"Organization","name":"WangJV Blog","logo":{"@type":"ImageObject","url":"https://wangjv0812.github.io/WangJV-Blog-Pages/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wangjv0812.github.io/WangJV-Blog-Pages/ accesskey=h title="WangJV Blog (Alt + H)">WangJV Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://wangjv0812.github.io/WangJV-Blog-Pages/ title=Home><span>Home</span></a></li><li><a href=https://wangjv0812.github.io/WangJV-Blog-Pages/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://wangjv0812.github.io/WangJV-Blog-Pages/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://wangjv0812.github.io/WangJV-Blog-Pages/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://wangjv0812.github.io/WangJV-Blog-Pages/search/ title="ğŸ” Search (Alt + /)" accesskey=/><span>ğŸ” Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wangjv0812.github.io/WangJV-Blog-Pages/>Home</a>&nbsp;Â»&nbsp;<a href=https://wangjv0812.github.io/WangJV-Blog-Pages/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">ScoreMatching</h1><div class=post-meta><span title='2025-08-06 16:29:40 +0800 +0800'>August 6, 2025</span>&nbsp;Â·&nbsp;5 min&nbsp;Â·&nbsp;910 words&nbsp;Â·&nbsp;WangJV&nbsp;|&nbsp;<a href=https://github.com/WangJV0812/WangJV-Blog-Source/tree/master/content/posts/ScoreMatching/index.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#1-ä¸ºä»€ä¹ˆè¦ç”¨-score-matching>1. ä¸ºä»€ä¹ˆè¦ç”¨ Score Matching</a></li><li><a href=#2-score-function>2. Score Function</a><ul><li><a href=#21-langevin-dynamics>2.1. Langevin Dynamics</a></li></ul></li><li><a href=#3-score-matching>3. Score Matching</a></li><li><a href=#4-è®¨è®º>4. è®¨è®º</a><ul><li><a href=#41-å“ˆé’¦æ£®è¿¹ä¼°è®¡-hutchinsons-trace-estimation>4.1. å“ˆé’¦æ£®è¿¹ä¼°è®¡ (Hutchinson&rsquo;s Trace Estimation)</a></li><li><a href=#42-éšåˆ†å¸ƒä¼°è®¡-score-estimation-for-implicit-distributions>4.2. éšåˆ†å¸ƒä¼°è®¡ (Score Estimation for Implicit Distributions)</a></li></ul></li><li><a href=#reference>reference</a></li></ul></nav></div></details></div><div class=post-content><h2 id=1-ä¸ºä»€ä¹ˆè¦ç”¨-score-matching>1. ä¸ºä»€ä¹ˆè¦ç”¨ Score Matching<a hidden class=anchor aria-hidden=true href=#1-ä¸ºä»€ä¹ˆè¦ç”¨-score-matching>#</a></h2><p>å¾ˆå¤šæ˜¯å¦ï¼Œæˆ‘ä»¬å¸Œæœ›ä»å¤§é‡çš„æ•°æ® $x_1, x_2, \cdots x_n$ï¼ˆæˆ–è€…æ¢å¥è¯è¯´ï¼Œä»ä¸€ä¸ªéšæœºå˜é‡ $X$ çš„å¤§é‡æŠ½è±¡ï¼‰è¿˜åŸå›åˆ†å¸ƒ $p(x)$ æœ¬èº«ã€‚ä¸€ä¸ªå¾ˆæ˜¾ç„¶çš„æƒ³æ³•æ˜¯é€šè¿‡ä¸€ä¸ªå¸¦æœ‰å¯ä¼˜åŒ–å‚æ•° $\theta$ çš„å‡½æ•° $q(x \mid \theta)$ æ¥è¿˜åŸ/è¿‘ä¼¼çœŸå®çš„æ•°æ®åˆ†å¸ƒã€‚ä½†æ˜¯ä¼˜åŒ–è¿‡ç¨‹ä¸­ï¼Œæƒ³è¦ä¿è¯åˆ†å¸ƒçš„å½’ä¸€åŒ–æ€§è´¨å¹¶ä¸å®¹æ˜“ã€‚ä¸€ä¸ªå¾ˆæ˜¾ç„¶æ€è·¯æ—¶ä¼˜åŒ–å®Œæˆåé€šè¿‡å½’ä¸€åŒ–ç³»æ•°æ¥ä¿è¯å½’ä¸€åŒ–æ€§è´¨ï¼š</p>$$
\begin{array}{c}
p(x\mid \theta) = \frac{1}{Z(\theta)}q(x\mid \theta)\\
\text{where: } Z(\theta) = \int q(x\mid \theta) dx
\end{array}
$$<p>ä½†æ˜¯åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œç”Ÿæˆæ¨¡å‹éœ€è¦å¤„ç†ä¸€ä¸ªæé«˜ç»´åº¦éšæœºå‘é‡çš„æ¦‚ç‡åˆ†å¸ƒçš„ç§¯åˆ†ã€‚æ­¤æ—¶å½’ä¸€åŒ–ç³»æ•° $Z(\theta)$ çš„è®¡ç®—å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚ï¼ˆå¦‚æœå®åœ¨å¸Œæœ›ç›´æ¥è®¡ç®—ï¼Œå¯ä»¥ç”¨æ•°å€¼æ–¹æ³•æˆ–è€… MCMCï¼Œä½†æ˜¯è¿™ç±»æ–¹æ³•åŒæ ·å¾ˆéš¾ç›´æ¥è®¡ç®—ã€‚ï¼‰</p><p>è¦è§£å†³å½’ä¸€åŒ–é—®é¢˜çš„åŠæ³•å…¶å®å¾ˆå¤šï¼Œäº‹å®ä¸Šè¿™åœ¨éšæœºåˆ†å¸ƒä¼°è®¡ä¸­æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„é—®é¢˜ã€‚æˆ‘ä»¬ä¸å¦¨ä¸¾ä¸€äº›æ˜¾ç„¶çš„æ–¹æ¡ˆï¼Œä¾‹å¦‚ Flow Moduleã€Bolzemann Machineã€Variational Autoencoder ç­‰ç­‰ã€‚é‚£ä¹ˆå¦‚æœå½’ä¸€åŒ–çš„åˆ†å¸ƒä¸å¥½å¤„ç†ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªä¸å½’ä¸€åŒ–çš„æ¦‚ç‡åˆ†å¸ƒç­‰ä»·çš„ï¼Œä¸éœ€è¦å½’ä¸€æ¢çš„å½¢å¼ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œå°±æ˜¯æˆ‘ä»¬åé¢è¦ä»‹ç»çš„ Score Function å’Œå¯¹åº”çš„ä¼°è®¡çš„æ–¹æ³• Score Matchingã€‚</p><h2 id=2-score-function>2. Score Function<a hidden class=anchor aria-hidden=true href=#2-score-function>#</a></h2><p>å¯¹äºä¸€ä¸ªå—åˆ°å‚æ•° $\boldsymbol{\theta}$ æ§åˆ¶çš„ï¼Œå…³äºéšæœºå‘é‡ $\boldsymbol{\xi}$ çš„éšæœºåˆ†å¸ƒ $p(\boldsymbol{\xi}, \boldsymbol{\theta})$ã€‚æˆ‘ä»¬å®šä¹‰å…¶å¯¹æ•°æ¢¯åº¦ä¸ºå…¶ Score Functionã€‚å½¢å¼åŒ–çš„ï¼Œå¯ä»¥å†™ä½œï¼š</p>$$
\psi (\boldsymbol{\xi}, \boldsymbol{\theta}) =
\begin{pmatrix}
\frac{\partial p(\boldsymbol{\xi}, \boldsymbol{\theta})}{\partial \boldsymbol{\xi}_1}\\
\frac{\partial p(\boldsymbol{\xi}, \boldsymbol{\theta})}{\partial \boldsymbol{\xi}_2}\\
\vdots\\
\frac{\partial p(\boldsymbol{\xi}, \boldsymbol{\theta})}{\partial \boldsymbol{\xi}_n}
\end{pmatrix} =
\begin{pmatrix}
\psi_1(\boldsymbol{\xi}, \boldsymbol{\theta})\\
\psi_2(\boldsymbol{\xi}, \boldsymbol{\theta})\\
\vdots\\
\psi_n(\boldsymbol{\xi}, \boldsymbol{\theta})
\end{pmatrix} =
\nabla_{\boldsymbol{\xi}} \log p(\boldsymbol{\xi}, \boldsymbol{\theta})
$$<p>æˆ‘ä»¬ä¸éš¾å‘ç°ï¼š</p>$$
\begin{aligned}
\psi (\boldsymbol{\xi}, \boldsymbol{\theta})
&= \nabla_{\boldsymbol{\xi}} \log \left( \frac{q(\boldsymbol{\xi}, \boldsymbol{\theta})}{Z(\boldsymbol{\theta})} \right)\\
&= \nabla_{\boldsymbol{\xi}} \log q(\boldsymbol{\xi}, \boldsymbol{\theta}) - \nabla_{\boldsymbol{\xi}} \log Z(\boldsymbol{\theta})\\
&= \nabla_{\boldsymbol{\xi}} \log q(\boldsymbol{\xi}, \boldsymbol{\theta})
\end{aligned}
$$<p>ä¸éš¾å‘ç°ï¼Œåœ¨ä½¿ç”¨ Score Function è¡¨è¾¾ä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒæ—¶ï¼Œå½’ä¸€åŒ–ç³»æ•°è¢«æ¢¯åº¦å¸æ”¶äº†ã€‚æ¢å¥è¯è¯´ï¼Œä½¿ç”¨ Score Function æè¿°åˆ†å¸ƒæ—¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒå½’ä¸€åŒ–ç³»æ•° $Z(\boldsymbol{\theta})$ äº†ï¼Œæˆ‘ä»¬ç”¨äº†ä¸€ä¸ªå·§å¦™çš„æ•°å­¦ç»“æ„è§£å†³äº†å›°éš¾çš„å½’ä¸€åŒ–é—®é¢˜ã€‚</p><p>ä½ å¯èƒ½ä¼šé—®ï¼šâ€œæ˜¯çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå·§å¦™çš„æ•°å­¦ç»“æ„ï¼Œä½†æ˜¯å¦‚ä½•ä¼°è®¡è¿™ä¸ªåˆ†å¸ƒï¼Œå¦‚ä½•é‡‡æ ·å‘¢ï¼Ÿâ€æˆ‘ä»¬å…ˆè§£å†³é‡‡æ ·çš„é—®é¢˜ï¼Œç­”æ¡ˆæ˜¯ Langevin Dynamicsã€‚</p><p>é¢„å‘Šä¸€ä¸‹ï¼Œç¬¬äºŒä¸ªé—®é¢˜çš„ç­”æ¡ˆå°±æ˜¯æˆ‘ä»¬è¿™ç¯‡æ–‡ç« çš„ä¸»é¢˜ï¼ŒScore Matchingã€‚</p><h3 id=21-langevin-dynamics>2.1. Langevin Dynamics<a hidden class=anchor aria-hidden=true href=#21-langevin-dynamics>#</a></h3><p>åœ¨å­¦ä¹ äº†å¾—åˆ†å‡½æ•° $s_\theta(\boldsymbol{x}) \approx \nabla_{\boldsymbol{x}} \log p(\boldsymbol{x})$ åï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†å…¶è½¬æ¢å›åŸæœ¬çš„æ¦‚ç‡åˆ†å¸ƒï¼Œè¿™å®é™…ä¸Šæ˜¯è¦è§£å†³ä¸€ä¸ªéšæœºå¾®åˆ†æ–¹ç¨‹ã€‚è¿™åŒæ ·å¹¶ä¸å®¹æ˜“ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç›´æ¥è·³è¿‡æ±‚åŸæœ¬çš„åˆ†å¸ƒè¿™ä¸€æ­¥ï¼Œç›´æ¥ä» Score Function é‡‡æ ·ï¼Œè¿™ä¸ªæ–¹æ³•è¢«ç§°ä¸ºéƒä¹‹ä¸‡åŠ¨åŠ›å­¦ (Langevin Dynamics)ã€‚éƒä¹‹ä¸‡åŠ¨åŠ›å­¦æä¾›äº†ä¸€ç§é©¬å°”å¯å¤«çš„æ–¹æ³•ï¼›å…·ä½“è€Œè¨€ï¼Œä»ä»»æ„å…ˆéªŒåˆ†å¸ƒ $x_0 \sim \pi(x)$ åˆå§‹åŒ–ï¼Œç„¶åè¿›è¡Œå¦‚ä¸‹è¿­ä»£ï¼š</p>$$
\begin{array}{ll}
x_{i+1} = x_i + \epsilon \nabla_{\boldsymbol{x}} \log p(\boldsymbol{x}) + \sqrt{2\epsilon} \boldsymbol{z}_i
& i = 0, 1, \cdots K
\end{array}
$$<p>å…¶ä¸­ $\boldsymbol{z_i} \sim \mathcal N(0, I)$ï¼Œ$\epsilon \to 0$, $K\to \infty$ã€‚å®é™…ä¸Šè¿™ä¸ªè¡Œä¸ºç±»ä¼¼ä¸æ•°å€¼å¾®åˆ†æ–¹ç¨‹çš„æ±‚è§£ï¼Œåé¢çš„é«˜æ–¯åˆ†å¸ƒé¡¹å¯ä»¥æœ‰æ•ˆçš„é¿å…é™·å…¥å±€éƒ¨æœ€ä¼˜ã€‚äº‹å®ä¸Šåªè¦è¿™ä¸ªè¿‡ç¨‹è¶³å¤Ÿï¼Œè¯¯å·®å‡ ä¹å¯ä»¥å¿½ç•¥ã€‚</p><p><img alt="Langevin Dynamics" loading=lazy src=https://wangjv0812.github.io/WangJV-Blog-Pages/2025/08/scorematching/Images/langevin_dynamics.gif></p><h2 id=3-score-matching>3. Score Matching<a hidden class=anchor aria-hidden=true href=#3-score-matching>#</a></h2><p>ä¸€ä¸ªå¾ˆç›´è§‰çš„æƒ³æ³•æ˜¯ï¼Œå¯¹äºä¸€ä¸ªåŸå§‹åˆ†å¸ƒçš„ Score Function $\psi_X(\xi)$ï¼Œæˆ‘ä»¬å¸Œæœ›ç”¨ä¸€ä¸ªæ”¶å‚æ•° $\theta$ æ§åˆ¶çš„æ¨¡å‹åˆ†å¸ƒ $\psi(\xi, \theta)$ æ¥è¿‘ä¼¼ã€‚ä¸€ä¸ªå¾ˆç›´æ¥çš„æ–¹æ³•æ˜¯ç”¨ä¸€ä¸ªå‡æ–¹æœŸæœ›æ¥è¡¡é‡äºŒè€…ä¹‹é—´çš„è·ç¦»ï¼š</p>$$
J(\theta) = \frac 1 2 \int_{\xi\in R^n} p_X(\xi)\left\|
\psi(\xi, \theta) - \psi_X(\xi)
\right\| ^2 d\xi
$$<p>è¿™é‡Œéœ€è¦æ³¨æ„åˆ°ä¸€ä¸ªç»†èŠ‚ï¼Œæ­¤å¤„æˆ‘ä»¬æ˜¯å¯¹ä¸€ä¸ªæŒ‰ç…§åŸå§‹åˆ†å¸ƒ $p_X(\xi)$ çš„æœŸæœ›ï¼Œè¿™å¯¹æˆ‘ä»¬çš„ç¼–å†™ç¨‹åºæ˜¯æœ‰å¾ˆå¤§å¸®åŠ©çš„ã€‚å¯¹äºä¸€ä¸ªæœ‰ $m$ ä¸ªæ•°æ®çš„åŸå§‹åˆ†å¸ƒï¼ˆæ•°æ®é›†ï¼‰ï¼Œæˆ‘ä»¬å‡åŒ€éšæœºçš„é€‰æ‹©å‡ºå…¶ä¸­ $k$ ä¸ªæ•°æ®ç‚¹ $\xi_1, \xi_2, \cdots, \xi_k$ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢çš„ä¾èµ–äºåŸå§‹åˆ†å¸ƒçš„æœŸæœ›å¯ä»¥ä¼¼ä¸ºï¼š</p>$$
J(\theta) \approx \frac{1}{2k} \sum_{i=1}^k \left\|
\psi(\xi_i, \theta) - \psi_X(\xi_i)
\right\| ^2
$$<p>é‚£ä¹ˆï¼Œå¯¹æ¨¡å‹åˆ†å¸ƒ $\psi(\xi_i, \theta)$ çš„å‚æ•° $\theta$ çš„ä¸€ä¸ªæœ€ä¼˜ä¼°è®¡å¯ä»¥é€šè¿‡æœ€å°åŒ–ä¸Šé¢çš„å½¢å¼æ¥è·å¾—ã€‚äº‹å®ä¸Šåœ¨è¿™ä¸ªæœ€ä¼˜ä¼°è®¡å°±æ˜¯ Score Matchingï¼š</p>$$
\hat \theta = \arg\min_\theta J(\theta)
$$<p>ä¸Šé¢è¿™ä¸ªå½¢å¼çš„ä¼°è®¡ç¡®å®è§£å†³äº†éœ€è¦è®¡ç®—å½’ä¸€åŒ–å‚æ•°çš„ç§¯åˆ†çš„é—®é¢˜ï¼Œä½†æ˜¯æƒ³ç›´æ¥ä½¿ç”¨è¿™ä¸ªå½¢å¼ä¾æ—§å›°éš¾ã€‚å› ä¸ºæˆ‘ä»¬åœ¨äº‹å®ä¸Šæ— æ³•è®¡ç®—åŸå§‹åˆ†å¸ƒçš„ Score Function $\psi_X(\xi)$ã€‚Score Function çš„ç²¾å¦™ä¹‹å¤„å°±åœ¨äºé€šè¿‡ä¸€ä¸ªæ•°å­¦å˜æ¢é¿å…äº†ç›´æ¥å¯¹åŸå§‹åˆ†å¸ƒçš„å¯¹æ•°æ¢¯åº¦çš„ä¾èµ–ã€‚</p><p>æˆ‘ä»¬ä¸å¦¨å‡è®¾æ¨¡å‹åˆ†å¸ƒçš„ Score Function $\psi(\xi_i, \theta)$ æ˜¯å¯å¯¼ã€‚å±•å¼€å‡æ–¹å½¢å¼ï¼Œæœ‰ï¼š</p>$$
\begin{aligned}
J(\theta)
&= \frac 1 2 \int_{\xi\in R^n} p_X(\xi)\left\|
\psi(\xi, \theta) - \psi_X(\xi)
\right\| ^2 d\xi\\
&= \frac 1 2 \int_{\xi\in R^n} p_X(\xi) \left(
\psi^2(\xi, \theta) - 2 \psi(\xi, \theta) \psi_X(\xi) + \psi_X^2(\xi)
\right) d\xi\\
&= \frac 1 2\int_{\xi\in R^n} p_X(\xi)\psi^2(\xi, \theta) d\xi - \int_{\xi\in R^n} p_X(\xi)\psi(\xi, \theta) \psi_X(\xi) d\xi + \frac 1 2 \int_{\xi\in R^n} p_X(\xi)\psi_X^2(\xi) d\xi\\
\end{aligned}
$$<p>æ˜¾ç„¶ï¼Œå…¶ä¸­ $\int_{\xi\in R^n} p_X(\xi)\psi_X^2(\xi) d\xi$ ä¸åŒ…å«å¾…ä¼˜åŒ–å‚æ•° $\theta$ï¼Œå¯ä»¥å¿½ç•¥ï¼Œä¸Šå¼ç®€åŒ–ä¸ºï¼š</p>$$
J(\theta) = \frac 1 2\int_{\xi\in R^n} p_X(\xi)\psi^2(\xi, \theta) d\xi - \int_{\xi\in R^n} p_X(\xi)\psi(\xi, \theta) \psi_X(\xi) d\xi
$$<p>å…¶ä¸­ $\frac 1 2\int_{\xi\in R^n} p_X(\xi)\psi^2(\xi, \theta) d\xi$ å¯ä»¥ç›´æ¥è®¡ç®—ï¼Œæˆ‘ä»¬å¹¶ä¸å…³å¿ƒã€‚éœ€è¦å¤„ç†çš„æ˜¯ $\int_{\xi\in R^n} p_X(\xi)\psi(\xi, \theta)^T \psi_X(\xi) d\xi$ã€‚å¯¹äºè¿™ä¸ªå½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥åšå¦‚ä¸‹å˜æ¢ï¼š</p>$$
\begin{aligned}
\int_{\xi\in R^n} p_X(\xi)\psi(\xi, \theta) \psi_X(\xi) d\xi
&= \int_{\xi\in R^n} p_X(\xi) \frac{\partial \log p_X(\xi)}{\partial \xi_i} \psi(\xi, \theta) d\xi\\
&= \int_{\xi\in R^n} \frac{p_X(\xi)}{p_X(\xi)} \frac{\partial p_X(\xi)}{\partial \xi_i} \psi(\xi, \theta) d\xi\\
&= \int_{\xi\in R^n} \frac{\partial p_X(\xi)}{\partial \xi_i} \psi(\xi, \theta) d\xi
\end{aligned}
$$<p>$\frac{\partial p_X(\xi)}{\partial \xi_i}$ ä¾ç„¶ä¸å¥½è®¡ç®—ï¼Œä½†æ˜¯å¯ä»¥ç”¨åˆ†éƒ¨ç§¯åˆ†æ¥å¤„ç†ï¼š</p>$$
\begin{aligned}
\int d \left(\frac{\partial \log p(\xi, \theta)}{\partial \xi_i} p_X(\xi)\right)
&= \int \frac{\partial \log p(\xi, \theta)}{\partial \xi_i} \frac{\partial p_X(\xi)}{\partial \xi_i} d \xi + \int \frac{\partial^2 \log p(\xi, \theta)}{\partial \xi_i^2} p_X(\xi) d \xi
\end{aligned}
$$<p>é‚£ä¹ˆï¼ŒåŸå§‹åˆ†å¸ƒå¯ä»¥å˜å½¢ä¸ºï¼š</p>$$
\begin{aligned}
\int_{\xi\in R^n} p_X(\xi)\psi(\xi, \theta) \psi_X(\xi) d\xi
&= \frac{\partial \log p(\xi, \theta)}{\partial \xi_i} p_X(\xi) \bigg|^\infty_{-\infty} - \int \frac{\partial^2 \log p(\xi, \theta)}{\partial \xi_i^2} p_X(\xi) d \xi
\end{aligned}
$$<p>æˆ‘ä»¬ä¸å¦¨åšä¸€ä¸ªæ¯”è¾ƒä¸€èˆ¬çš„å‡è®¾ï¼ˆç¡®å®æ˜¯ä¸€ä¸ªå¾ˆå¼±çš„å‡è®¾ï¼‰ï¼Œå‡è®¾ $p(\xi, \theta)$ å’Œ $p_X(\xi)$ æ˜¯çŸ­å°¾çš„ï¼Œä¹˜ç§¯ $\frac{\partial \log p(\xi, \theta)}{\partial \xi_i} p_X(\xi)$ åœ¨ $\infty, -\infty$ å¤„æ”¶æ•›ä¸º $0$ã€‚è¿™ä¸ªå‡è®¾å¼±åˆ°å‡ ä¹æ‰¾ä¸åˆ°ä¸€ä¸ªåä¾‹ï¼ˆäº‹å®ä¸Šæœ‰åä¾‹ï¼Œä¾‹å¦‚å¸•ç´¯æ‰˜åˆ†å¸ƒï¼‰ã€‚æˆ‘ä»¬å‡ ä¹æ€»æ˜¯å¯ä»¥è®¤ä¸ºè¿™ä¸ªå‡è®¾æ˜¯æˆç«‹çš„ã€‚</p>$$
\int_{\xi\in R^n} p_X(\xi)\psi(\xi, \theta) \psi_X(\xi) d\xi
= - \int \frac{\partial^2 \log p(\xi, \theta)}{\partial \xi_i^2} p_X(\xi) d \xi
$$<p>åŸå§‹çš„å‡æ–¹æœŸæœ›å¯ä»¥è¢«å˜æ¢ä¸ºï¼š</p>$$
\begin{aligned}
J(\theta)
&= \frac 1 2\int_{\xi\in R^n} p_X(\xi)\psi^2(\xi, \theta) d\xi + \sum_{i=1}^n\int_{\xi\in R^n} \frac{\partial^2 \log p(\xi, \theta)}{\partial \xi_i^2} p_X(\xi) d \xi \\
&= \int_{\xi\in R^n} p_X(\xi) \sum_{i=1}^{n} \left[
\frac 1 2 \psi_i(\xi, \theta)^2 + \frac{\partial \psi(\xi, \theta)}{\partial \xi_i}
\right] d \xi
\end{aligned}
$$<p>é—®é¢˜å·²ç»è§£å†³äº†ï¼Œä½†æ˜¯ç»“è®ºè¿˜ä¸å¤Ÿå¥½çœ‹ã€‚ä¸å¦¨æ³¨æ„åŠ›é›†ä¸­ä¸€ç‚¹ï¼Œä¸éš¾æ³¨æ„åˆ°ï¼š</p>$$
\sum_{i=1}^{n} \frac{\partial^2 \log p(\xi, \theta)}{\partial \xi_i^2} = \text{tr} \left(\nabla^2_\xi \log p(\xi, \theta)\right)
$$<p>ç»“è®ºå¯ä»¥å†™æˆä¸€ä¸ªæ›´ç®€æ´ä¼˜é›…çš„å½¢å¼ï¼š</p>$$
\begin{aligned}
J(\theta)
&= \text{E}_{\xi \sim p_X(\xi)}\left[
\text{tr} \left(\nabla^2_\xi \log p(\xi, \theta)\right) + \frac 1 2\left\| \nabla_\xi \log p(\xi, \theta)\right\|^2\right] \\
&= \text{E}_{\xi \sim p_X(\xi)}\left[
\text{tr} \left(\nabla_\xi \psi(\xi, \theta)\right) + \frac 1 2\left\| \psi(\xi, \theta)\right \|^2\right] \\
\end{aligned}
$$<h2 id=4-è®¨è®º>4. è®¨è®º<a hidden class=anchor aria-hidden=true href=#4-è®¨è®º>#</a></h2><p>æˆ‘ä»¬åœ¨è¿™é‡Œåªå¸Œæœ›è®¨è®ºä¸€ä¸‹åœ¨ç¼–ç¨‹å®è·µä¸­å¯èƒ½é‡åˆ°çš„é—®é¢˜ã€‚å¯¹äºä¸€ä¸ªæœ‰ $m$ ä¸ªæ•°æ®çš„åŸå§‹åˆ†å¸ƒï¼Œæˆ‘å˜›å¯ä»¥è®¤ä¸ºæ˜¯å¯¹åŸå§‹åˆ†å¸ƒæ‰€åœ¨çš„æµå½¢ä¸Šé‡‡æ ·å‡ºäº† $m$ ä¸ªæ•°æ®ç‚¹ã€‚ä¸ºäº†æè¿°æ–¹ä¾¿ï¼Œä¸å¦¨å°†è¿™äº›é‡‡æ ·è®°ä½œ $X_1, X_2, \cdots, X_{m}$ã€‚é‚£ä¹ˆ Score Matching çš„ç›®æ ‡å‡½æ•°å¯ä»¥å†™ä½œï¼š</p>$$
\check{J}(\theta) = \frac{1}{m} \sum_{j=1}^{m} \sum_{i=1}^{n} \left[
\frac 1 2 \psi_i(\xi, \theta)^2 + \frac{\partial \psi(\xi, \theta)}{\partial \xi_i}
\right]
$$<p>è™½ç„¶ Score Matching é¿å…äº†è®¡ç®—å¤æ‚çš„å½’ä¸€åŒ–ç³»æ•°ï¼Œä½†æ˜¯å´å¼•å…¥äº†å¦ä¸€ä¸ªè®¡ç®—ä¸Šçš„éº»çƒ¦ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—æµ·æ£®çŸ©é˜µçš„è¿¹ã€‚å¯¹äºä¸€ä¸ªç»´åº¦ä¸º $d$ çš„éšæœºåˆ†å¸ƒçš„ä¼°è®¡ $\psi(\xi, \theta)$ï¼Œå…¶å¯¹äº $\xi$ çš„æ¢¯åº¦æ˜¯ä¸€ä¸ª $d \times d$ ç»´åº¦çš„çŸ©é˜µï¼Œåœ¨äº‹å®ä¸Šæˆ‘ä»¬è¿›è¡Œäº†</p>$$d(d+1)/2$$<p>æ¬¡çš„è®¡ç®—ã€‚äº‹å®ä¸Šæˆ‘ä»¬ä¸éœ€è¦è®¡ç®—è¿™ä¹ˆå¤šå…ƒç´ ï¼Œåªéœ€è¦è®¡ç®—å¯¹è§’çº¿ä¸Šçš„å…ƒç´ å°±å¯ä»¥äº†ã€‚å…¨éƒ¨è®¡ç®—æ˜¯ååˆ†ä¸ç»æµçš„ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œä¼šç”¨å“ˆé’¦æ£®è¿¹ä¼°è®¡ï¼ˆHutchinson&rsquo;s Trace Estimationï¼‰æ¥è¿‘ä¼¼ã€‚</p><h3 id=41-å“ˆé’¦æ£®è¿¹ä¼°è®¡-hutchinsons-trace-estimation>4.1. å“ˆé’¦æ£®è¿¹ä¼°è®¡ (Hutchinson&rsquo;s Trace Estimation)<a hidden class=anchor aria-hidden=true href=#41-å“ˆé’¦æ£®è¿¹ä¼°è®¡-hutchinsons-trace-estimation>#</a></h3><p>å¯¹äºä»»æ„ä¸€ä¸ªæ–¹é˜µ $H\in R^{d\times d}$ å’Œä¸€ä¸ªæ»¡è¶³å‡å€¼ä¸º $0$ï¼Œæ–¹å·®ä¸º $I$çš„éšæœºåˆ†å¸ƒï¼ˆä¸€èˆ¬å¯ä»¥å– <strong>Rademacher åˆ†å¸ƒ</strong> æˆ–è€… <strong>æ ‡å‡†é«˜æ–¯åˆ†å¸ƒ</strong>ï¼‰ $v\in R^d$ï¼Œæœ‰ï¼š</p>$$
\begin{aligned}
\mathbb{E}\left[\text{tr}(v^\top H v)\right]
&= \mathbb{E} \left[\sum_{i=1}^d \sum_{j=1} v_i H_{ij} v_j\right]\\
&= \sum_{i=1}^d \sum_{j=1} H_{ij}\mathbb{E}\left[v_i v_j^T\right]
\end{aligned}
$$<p>å› ä¸º $v$ æ»¡è¶³æ ‡å‡†é«˜æ–¯åˆ†å¸ƒï¼Œå› æ­¤æ–¹å·® $\mathbb{E}\left[v_i v_j^T\right] = I$ã€‚æ‰€ä»¥ï¼š</p>$$
\mathbb{E}\left[\text{tr}(v^\top H v)\right] = \sum_{i=1}^d H_{ii} = \text{tr}(H)
$$<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦ä»æ ‡å‡†é«˜æ–¯åˆ†å¸ƒä¸­é‡‡æ ·å‡ºä¸€å®š $k$ ä¸ªéšæœºå˜é‡ $v_1, v_2, \cdots, v_k$ï¼ˆä¸€èˆ¬ $k$ æ˜¯è¿œå°äºéšæœºå˜é‡ç»´åº¦ $d$ çš„ï¼‰ï¼Œç„¶åè®¡ç®— $v^\top Hv$ã€‚å› ä¸º $Hv$ æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ æµ·æ£®å‘é‡ç§¯ (Hessian-Vector Product, HVP)ã€‚</p><p>HVP åœ¨è®¡ç®—ä¸Šæ˜¯ç»æµçš„ï¼Œæ˜¯å› ä¸ºï¼š</p>$$
\nabla_\xi^2 p(\xi; \theta) v = \nabla_\xi \left(\nabla_\xi p(\xi; \theta) v\right)
$$<p>ä¸éš¾å‘ç°:</p>$$
\begin{array}{lc}
\text{Hessian-Vector Product} & \text{Shape}\\
\nabla_\xi^2 p(\xi; \theta) & d \times d\\
\nabla_\xi p(\xi; \theta) & d \times 1\\
\nabla_\xi p(\xi; \theta) \cdot v & 1 \times 1\\
\nabla_\xi[\nabla_\xi p(\xi; \theta)v] & d \times 1\\
\end{array}
$$<p>è¿™ä¸ªè®¡ç®—è¿‡ç¨‹ä¸­é¿å…äº†ç›´æ¥å­˜å‚¨å’Œè®¡ç®—é«˜ç»´çš„ Hessian Matrixã€‚å› æ­¤å…·æœ‰é«˜æ•ˆæ€§ã€‚</p><h3 id=42-éšåˆ†å¸ƒä¼°è®¡-score-estimation-for-implicit-distributions>4.2. éšåˆ†å¸ƒä¼°è®¡ (Score Estimation for Implicit Distributions)<a hidden class=anchor aria-hidden=true href=#42-éšåˆ†å¸ƒä¼°è®¡-score-estimation-for-implicit-distributions>#</a></h3><p>ä¸€äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šé¢å¯¹ä¸€äº›éšå¼åˆ†å¸ƒï¼Œè¿™äº›åˆ†å¸ƒå¸¸å¸¸å®¹æ˜“é‡‡æ ·ï¼Œä½†æ˜¯éš¾ç§»ç›´æ¥è®¡ç®—æ¦‚ç‡å¯†åº¦ã€‚ä¾‹å¦‚å¯¹æŠ—ç”Ÿæˆç½‘ç»œ (GAN) çš„ç”Ÿæˆå™¨ã€‚GAN çš„ç”Ÿæˆå™¨å¯ä»¥çœ‹ä½œä¸€ä¸ªä¸“é—¨ç”¨æ¥åšé‡‡æ ·çš„å‡½æ•°ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬å¸Œæœ›å¾—çŸ¥æŸä¸€ä¸ªé‡‡æ ·ç»“æœåœ¨åˆ†å¸ƒä¸­çš„æ¦‚ç‡ï¼Œè¿™å°±å¾ˆéš¾äº†ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼ŒScore Function $\psi_q(x) = \nabla_x \log q_\theta(x)$ å°±å¾ˆæœ‰ç”¨äº†ã€‚</p><p>ä¸‹é¢ä¸å¦¨ç”¨ä¸€ä¸ªä¾‹å­ï¼Œæ¥å…·ä½“è®²è®² Score Matching åœ¨éšåˆ†å¸ƒä¼°è®¡ä¸­çš„åº”ç”¨ã€‚åœ¨ Variational Free Energy ä¸­ï¼Œå¸¸å¸¸ä½¿ç”¨ <strong>ç†µæ­£åˆ™åŒ–</strong> ï¼ˆEntropy Regularizationï¼‰æ¥å¸®åŠ©ä¼˜åŒ–ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œå¯¹äºä¸€ä¸ªéšåˆ†å¸ƒ $q(x)$ï¼Œå…¶ç†µå¯ä»¥å†™ä½œï¼š</p>$$
H\left(q_\theta(x)\right)
= \mathbb{E}_{q_\theta(x)}\big[\log q_\theta(x)\big]
$$<p>ç†µä¸€èˆ¬ç”¨æ¥è¡¡é‡ä¸€ä¸ªåˆ†å¸ƒçš„ä¸ç¡®å®šç¨‹åº¦ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºç†µæ­£åˆ™åŒ–æ˜¯ä¸€ç§ â€œæ¨¡å‹æ¨åŠ¨åŠ›â€ï¼Œå®ƒä¼šä¿ƒä½¿æ¨¡å‹å»æ¢ç´¢æ›´å¹¿å¤§çš„åˆ†å¸ƒç©ºé—´ï¼Œæé«˜æ¨¡å‹çš„å¤šæ ·æ€§ã€‚ä½†æ˜¯å¯¹äºä¸€ä¸ª GAN ç”Ÿæˆå™¨ï¼Œæˆ‘ä»¬åªèƒ½å¾ˆæ–¹ä¾¿çš„å®ç°é‡‡æ ·ï¼Œç†µæ­£æ‚åŒ–å¹¶ä¸å®¹æ˜“ã€‚</p><p>ä¾‹å¦‚å¯¹äºä¸€ä¸ªç”Ÿæˆå™¨ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºå­˜åœ¨ä¸€ä¸ªè®­ç»ƒçš„ã€ç¡®å®šæ€§çš„å˜æ¢ $g_\theta(\epsilon)$ï¼Œè¿™ä¸ªå˜æ¢å°†ä¸€ä¸ªç®€å•çš„åˆ†å¸ƒ $\epsilon$ï¼ˆä¸€èˆ¬æ˜¯æ­£æ€åˆ†å¸ƒï¼‰ å˜æ¢åˆ°ä¸€ä¸ªå¤æ‚åˆ†å¸ƒä¸Šï¼ˆå°±æ˜¯æˆ‘ä»¬çš„ç›®æ ‡åˆ†å¸ƒï¼‰ï¼Œå› æ­¤åœ¨é‡‡æ ·ä¸­ï¼Œåªéœ€è¦åœ¨æ­£æ€åˆ†å¸ƒ $\epsilon$ ä¸Šé‡‡æ ·ï¼Œå¹¶é€šè¿‡å˜æ¢ $g_\theta(\epsilon)$ è·å¾—ä¸€ä¸ªé‡‡æ · $x = g_\theta(\epsilon)$ã€‚ä½†æ˜¯å…³äºé‡‡æ · $x$ çš„æ¦‚ç‡å¯†åº¦ï¼Œæˆ‘ä»¬å¹¶ä¸æ¸…æ¥šï¼Œè¿™å¯¼è‡´æˆ‘ä»¬æ— æ³•ç›´æ¥è®¡ç®—ç†µæ­£åˆ™åŒ–ã€‚ä½†æ˜¯ç†µæ­£åˆ™åŒ–å…³äºå¯å­¦ä¹ å‚æ•°çš„æ¢¯åº¦å¯ä»¥å†™ä½œï¼š</p>$$
\begin{aligned}
\nabla_\theta H\left(q_\theta(x)\right)
&= \nabla_\theta \mathbb{E}_{q_\theta(x)}\big[\log q_\theta(x)\big]\\
&= \nabla_\theta \mathbb{E}_{p(\epsilon)}\big[
\log q_\theta(g_\theta(\epsilon)) \big]\\
&= \mathbb{E}_{p(\epsilon)}\big[
\nabla_x \log q_\theta(x)\bigg|_{x=g_\theta(\epsilon)} \nabla_\theta g_\theta(\epsilon)\big]\\
\end{aligned}
$$<p>å…¶ä¸­ $\nabla_\theta g_\theta(\epsilon)$ï¼Œç›´æ¥åå‘ä¼ æ’­å³å¯ï¼Œæ¯”è¾ƒå®¹æ˜“è®¡ç®—ã€‚è€Œ $\nabla_x \log q_\theta(x)\bigg|_{x=g_\theta(\epsilon)}$ åˆ™æ˜¯ä¸€ä¸ª Score Functionã€‚ä½†æ˜¯è¿™é¡¹ä¾ç„¶æ²¡æ³•ç›´æ¥ç®—ï¼Œå¯ä»¥é€šè¿‡ Score Matching æ¥ä¼°è®¡ã€‚</p><p>æ­¤æ—¶ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›é€šè¿‡ç†µæ­£åˆ™åŒ–æ¥ä¼˜åŒ–æˆ‘ä»¬çš„æ¨¡å‹ï¼Œåˆ™éœ€è¦å…ˆé€šè¿‡ä¸€ä¸ª Score Matching æ¥ä¼°è®¡ Score Function $\nabla_x \log q_\theta(x)$ï¼Œç„¶åå†é€šè¿‡ä¸Šé¢çš„å½¢å¼æ¥è®¡ç®—æ¢¯åº¦ã€‚</p><h2 id=reference>reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h2><p>@article{JMLR:v6:hyvarinen05a,
author = {Aapo Hyv{{"a}}rinen},
title = {Estimation of Non-Normalized Statistical Models by Score Matching},
journal = {Journal of Machine Learning Research},
year = {2005},
volume = {6},
number = {24},
pages = {695&ndash;709},
url = {<a href=http://jmlr.org/papers/v6/hyvarinen05a.html>http://jmlr.org/papers/v6/hyvarinen05a.html</a>}
}</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://wangjv0812.github.io/WangJV-Blog-Pages/tags/unsupervised-learning/>Unsupervised Learning</a></li><li><a href=https://wangjv0812.github.io/WangJV-Blog-Pages/tags/%E6%95%B0%E6%8D%AE%E7%94%9F%E6%88%90/>æ•°æ®ç”Ÿæˆ</a></li><li><a href=https://wangjv0812.github.io/WangJV-Blog-Pages/tags/%E5%AF%B9%E6%AF%94%E5%AD%A6%E4%B9%A0/>å¯¹æ¯”å­¦ä¹ </a></li></ul><nav class=paginav><a class=prev href=https://wangjv0812.github.io/WangJV-Blog-Pages/2025/08/sliced-score-matching/><span class=title>Â« Prev</span><br><span>Sliced Score Matching</span>
</a><a class=next href=https://wangjv0812.github.io/WangJV-Blog-Pages/2025/06/lie-group-and-lie-algebra/><span class=title>Next Â»</span><br><span>Lie Group and Lie Algebra</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://wangjv0812.github.io/WangJV-Blog-Pages/>WangJV Blog</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>