<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Geodesic and Lie Algebra in SO(3) | WangJV Blog</title><meta name=keywords content="SO(3),测地线,李代数,指数映射"><meta name=description content="1. 测地线（Geodesic）
对于一个曲率不为 $0$ 的流形，其上任意两点之间的最短路径无法简单的像是欧式几何上一样，直接通过一条平直曲线描述。因此在一个曲面上，我们定一任意两点之间最短的路径为测地线（Geodesic）。我们不妨记在 $SO(3)$ 上受到参数 $t$ 控制的任意曲线为 $R(t)$。对于一个 Riemann 度量 $\| \cdot \|$，我们可以定义曲线的弧长：
$$
\begin{gather}
L(R)\int_a^b \sqrt{\| dR \|^2} = \int_a^b \sqrt{\| \dot R \|^2} dt
\end{gather}
$$这就是在一个流形（或者说曲面）上关于任意曲线的弧长泛函。对于上个泛函，我们只需要对 $R(t)$ 变分，得到任意两点之间弧长泛函最小的曲线 $R(t)$ 满足的形式，测地线问题就解决了。但是如果你对变分和 Eular-Lagrange 方程熟悉的话，会自然的发现上面这个形式要处理并不容易。我们一般会扔掉 $\sqrt{\cdot}$，直接取曲线的能量泛函：
$$
\begin{gather}
E(R) = \frac{1}{2} \int_a^b \| \dot R \|^2 dt
\end{gather}
$$1.1. SO(3) 上的 Riemann 度量
在任意的 Riemann 流形 $M$ 上的每个点 $p \in M$，切空间 $T_pM$ 是一个向量空间。我们在这个空间上定义一个内积：
$$
\langle \cdot, \cdot \rangle_p : T_pM \times T_pM \to \mathbb{R}
$$内积需要满足四个性质：

对称性：$\langle X, Y \rangle_p = \langle Y, X \rangle_p$
双线性：线性于两个分量
正定性：$\langle X, X \rangle_p > 0$ 当 $X \neq 0$
平滑性：对于任意光滑向量场 $X, Y$，$\langle X, Y \rangle$ 是一个光滑函数

当我们将每个点的内积拼接起来时，可以得到一个光滑的张量场："><meta name=author content="WangJV"><link rel=canonical href=https://wangjv0812.cn/2025/10/geodesic-and-lie-algebra-in-so3/><link crossorigin=anonymous href=https://wangjv0812.cn/assets/css/stylesheet.2211ca3164be7830024f6aad2b3a2e520843a64f8f048445c3401c1249aa051d.css integrity="sha256-IhHKMWS+eDACT2qtKzouUghDpk+PBIRFw0AcEkmqBR0=" rel="preload stylesheet" as=style><link rel=icon href=https://wangjv0812.cn/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://wangjv0812.cn/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://wangjv0812.cn/favicon-32x32.png><link rel=apple-touch-icon href=https://wangjv0812.cn/apple-touch-icon.png><link rel=mask-icon href=https://wangjv0812.cn/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://wangjv0812.cn/2025/10/geodesic-and-lie-algebra-in-so3/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script>MathJax={tex:{displayMath:[["\\[","\\]"],["$$","$$"]],inlineMath:[["\\(","\\)"],["$","$"]],processEscapes:!0,processEnvironments:!0,tags:"ams"},chtml:{scale:1,minScale:.5,matchFontHeight:!1,displayAlign:"center",displayIndent:"0",mtextInheritFont:!1,merrorInheritFont:!0,mathmlSpacing:!1,skipHtmlTags:["script","noscript","style","textarea","pre","code","a"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"},svg:{scale:1,minScale:.5,mtextInheritFont:!1,merrorInheritFont:!0,mathmlSpacing:!1,skipHtmlTags:["script","noscript","style","textarea","pre","code","a"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"},options:{enableMenu:!0,menuOptions:{settings:{zoom:"Click"}}},loader:{load:["ui/safe","a11y/assistive-mml"]},startup:{ready(){MathJax.startup.defaultReady();const e=new ResizeObserver(e=>{MathJax.typesetPromise()});e.observe(document.body)}}},window.innerWidth<=768&&(MathJax.chtml=MathJax.chtml||{},MathJax.chtml.scale=.9)</script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script><style>.MathJax{outline:0}@media(max-width:768px){.MathJax{font-size:90%!important}.MathJax_Display{overflow-x:auto;overflow-y:hidden;padding:0!important;margin:1em 0!important}.MathJax_CHTML{line-height:1.2!important}}mjx-container[jax=CHTML][display=true]{overflow-x:auto;overflow-y:hidden;padding:1px 0}</style><meta property="og:url" content="https://wangjv0812.cn/2025/10/geodesic-and-lie-algebra-in-so3/"><meta property="og:site_name" content="WangJV Blog"><meta property="og:title" content="Geodesic and Lie Algebra in SO(3)"><meta property="og:description" content="1. 测地线（Geodesic） 对于一个曲率不为 $0$ 的流形，其上任意两点之间的最短路径无法简单的像是欧式几何上一样，直接通过一条平直曲线描述。因此在一个曲面上，我们定一任意两点之间最短的路径为测地线（Geodesic）。我们不妨记在 $SO(3)$ 上受到参数 $t$ 控制的任意曲线为 $R(t)$。对于一个 Riemann 度量 $\| \cdot \|$，我们可以定义曲线的弧长：
$$ \begin{gather} L(R)\int_a^b \sqrt{\| dR \|^2} = \int_a^b \sqrt{\| \dot R \|^2} dt \end{gather} $$这就是在一个流形（或者说曲面）上关于任意曲线的弧长泛函。对于上个泛函，我们只需要对 $R(t)$ 变分，得到任意两点之间弧长泛函最小的曲线 $R(t)$ 满足的形式，测地线问题就解决了。但是如果你对变分和 Eular-Lagrange 方程熟悉的话，会自然的发现上面这个形式要处理并不容易。我们一般会扔掉 $\sqrt{\cdot}$，直接取曲线的能量泛函：
$$ \begin{gather} E(R) = \frac{1}{2} \int_a^b \| \dot R \|^2 dt \end{gather} $$1.1. SO(3) 上的 Riemann 度量 在任意的 Riemann 流形 $M$ 上的每个点 $p \in M$，切空间 $T_pM$ 是一个向量空间。我们在这个空间上定义一个内积：
$$ \langle \cdot, \cdot \rangle_p : T_pM \times T_pM \to \mathbb{R} $$内积需要满足四个性质：
对称性：$\langle X, Y \rangle_p = \langle Y, X \rangle_p$ 双线性：线性于两个分量 正定性：$\langle X, X \rangle_p > 0$ 当 $X \neq 0$ 平滑性：对于任意光滑向量场 $X, Y$，$\langle X, Y \rangle$ 是一个光滑函数 当我们将每个点的内积拼接起来时，可以得到一个光滑的张量场："><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-10-31T11:37:25+08:00"><meta property="article:modified_time" content="2025-10-31T11:37:25+08:00"><meta property="article:tag" content="SO(3)"><meta property="article:tag" content="测地线"><meta property="article:tag" content="李代数"><meta property="article:tag" content="指数映射"><meta property="og:image" content="https://wangjv0812.cn/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wangjv0812.cn/"><meta name=twitter:title content="Geodesic and Lie Algebra in SO(3)"><meta name=twitter:description content="1. 测地线（Geodesic）
对于一个曲率不为 $0$ 的流形，其上任意两点之间的最短路径无法简单的像是欧式几何上一样，直接通过一条平直曲线描述。因此在一个曲面上，我们定一任意两点之间最短的路径为测地线（Geodesic）。我们不妨记在 $SO(3)$ 上受到参数 $t$ 控制的任意曲线为 $R(t)$。对于一个 Riemann 度量 $\| \cdot \|$，我们可以定义曲线的弧长：
$$
\begin{gather}
L(R)\int_a^b \sqrt{\| dR \|^2} = \int_a^b \sqrt{\| \dot R \|^2} dt
\end{gather}
$$这就是在一个流形（或者说曲面）上关于任意曲线的弧长泛函。对于上个泛函，我们只需要对 $R(t)$ 变分，得到任意两点之间弧长泛函最小的曲线 $R(t)$ 满足的形式，测地线问题就解决了。但是如果你对变分和 Eular-Lagrange 方程熟悉的话，会自然的发现上面这个形式要处理并不容易。我们一般会扔掉 $\sqrt{\cdot}$，直接取曲线的能量泛函：
$$
\begin{gather}
E(R) = \frac{1}{2} \int_a^b \| \dot R \|^2 dt
\end{gather}
$$1.1. SO(3) 上的 Riemann 度量
在任意的 Riemann 流形 $M$ 上的每个点 $p \in M$，切空间 $T_pM$ 是一个向量空间。我们在这个空间上定义一个内积：
$$
\langle \cdot, \cdot \rangle_p : T_pM \times T_pM \to \mathbb{R}
$$内积需要满足四个性质：

对称性：$\langle X, Y \rangle_p = \langle Y, X \rangle_p$
双线性：线性于两个分量
正定性：$\langle X, X \rangle_p > 0$ 当 $X \neq 0$
平滑性：对于任意光滑向量场 $X, Y$，$\langle X, Y \rangle$ 是一个光滑函数

当我们将每个点的内积拼接起来时，可以得到一个光滑的张量场："><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wangjv0812.cn/posts/"},{"@type":"ListItem","position":2,"name":"Geodesic and Lie Algebra in SO(3)","item":"https://wangjv0812.cn/2025/10/geodesic-and-lie-algebra-in-so3/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Geodesic and Lie Algebra in SO(3)","name":"Geodesic and Lie Algebra in SO(3)","description":"1. 测地线（Geodesic） 对于一个曲率不为 $0$ 的流形，其上任意两点之间的最短路径无法简单的像是欧式几何上一样，直接通过一条平直曲线描述。因此在一个曲面上，我们定一任意两点之间最短的路径为测地线（Geodesic）。我们不妨记在 $SO(3)$ 上受到参数 $t$ 控制的任意曲线为 $R(t)$。对于一个 Riemann 度量 $\\| \\cdot \\|$，我们可以定义曲线的弧长：\n$$ \\begin{gather} L(R)\\int_a^b \\sqrt{\\| dR \\|^2} = \\int_a^b \\sqrt{\\| \\dot R \\|^2} dt \\end{gather} $$这就是在一个流形（或者说曲面）上关于任意曲线的弧长泛函。对于上个泛函，我们只需要对 $R(t)$ 变分，得到任意两点之间弧长泛函最小的曲线 $R(t)$ 满足的形式，测地线问题就解决了。但是如果你对变分和 Eular-Lagrange 方程熟悉的话，会自然的发现上面这个形式要处理并不容易。我们一般会扔掉 $\\sqrt{\\cdot}$，直接取曲线的能量泛函：\n$$ \\begin{gather} E(R) = \\frac{1}{2} \\int_a^b \\| \\dot R \\|^2 dt \\end{gather} $$1.1. SO(3) 上的 Riemann 度量 在任意的 Riemann 流形 $M$ 上的每个点 $p \\in M$，切空间 $T_pM$ 是一个向量空间。我们在这个空间上定义一个内积：\n$$ \\langle \\cdot, \\cdot \\rangle_p : T_pM \\times T_pM \\to \\mathbb{R} $$内积需要满足四个性质：\n对称性：$\\langle X, Y \\rangle_p = \\langle Y, X \\rangle_p$ 双线性：线性于两个分量 正定性：$\\langle X, X \\rangle_p \u003e 0$ 当 $X \\neq 0$ 平滑性：对于任意光滑向量场 $X, Y$，$\\langle X, Y \\rangle$ 是一个光滑函数 当我们将每个点的内积拼接起来时，可以得到一个光滑的张量场：\n","keywords":["SO(3)","测地线","李代数","指数映射"],"articleBody":"1. 测地线（Geodesic） 对于一个曲率不为 $0$ 的流形，其上任意两点之间的最短路径无法简单的像是欧式几何上一样，直接通过一条平直曲线描述。因此在一个曲面上，我们定一任意两点之间最短的路径为测地线（Geodesic）。我们不妨记在 $SO(3)$ 上受到参数 $t$ 控制的任意曲线为 $R(t)$。对于一个 Riemann 度量 $\\| \\cdot \\|$，我们可以定义曲线的弧长：\n$$ \\begin{gather} L(R)\\int_a^b \\sqrt{\\| dR \\|^2} = \\int_a^b \\sqrt{\\| \\dot R \\|^2} dt \\end{gather} $$这就是在一个流形（或者说曲面）上关于任意曲线的弧长泛函。对于上个泛函，我们只需要对 $R(t)$ 变分，得到任意两点之间弧长泛函最小的曲线 $R(t)$ 满足的形式，测地线问题就解决了。但是如果你对变分和 Eular-Lagrange 方程熟悉的话，会自然的发现上面这个形式要处理并不容易。我们一般会扔掉 $\\sqrt{\\cdot}$，直接取曲线的能量泛函：\n$$ \\begin{gather} E(R) = \\frac{1}{2} \\int_a^b \\| \\dot R \\|^2 dt \\end{gather} $$1.1. SO(3) 上的 Riemann 度量 在任意的 Riemann 流形 $M$ 上的每个点 $p \\in M$，切空间 $T_pM$ 是一个向量空间。我们在这个空间上定义一个内积：\n$$ \\langle \\cdot, \\cdot \\rangle_p : T_pM \\times T_pM \\to \\mathbb{R} $$内积需要满足四个性质：\n对称性：$\\langle X, Y \\rangle_p = \\langle Y, X \\rangle_p$ 双线性：线性于两个分量 正定性：$\\langle X, X \\rangle_p \u003e 0$ 当 $X \\neq 0$ 平滑性：对于任意光滑向量场 $X, Y$，$\\langle X, Y \\rangle$ 是一个光滑函数 当我们将每个点的内积拼接起来时，可以得到一个光滑的张量场：\n$$ \\begin{gather} g_p(X, Y) = \\langle X, Y \\rangle_p\\\\ g : TM \\times TM \\to \\mathbb{R} \\end{gather} $$我们 $g$ 是黎曼度量（Riemann Metric）。那么诱导的，我们需要在 SO(3) 上定义一个合理的内积，就解决了能量泛函中所需要的 $\\| \\dot R \\|^2$ 的问题。不妨用内积来描述能量泛函更佳优雅：\n$$ \\begin{gather} E(R) = \\frac{1}{2} \\int_a^b \\langle \\dot R, \\dot R \\rangle dt \\end{gather} $$在 SO(3) 上，我们知道，切空间 $T_{R(t)}SO(3)$ 是 $3 \\times 3$ 反对称矩阵和叉乘构成的群，其同构于三维欧式空间 $\\mathbb{R}^3$ 与加法构成的群。因此对于任意 $R \\in SO(3)$，$\\dot R \\in T_{R(t)}SO(3)$，$\\dot R$ 同构于 $\\omega \\in \\mathbb{R}^3$。一个自然的内积定义是：\n$$ \\langle \\omega_1, \\omega_2 \\rangle = \\frac{1}{2} \\omega_1^T \\omega_2 $$很容易证明，该内积在 $T_{R(t)}SO(3)$ 中等价于：\n$$ \\begin{gather} \\langle \\dot R_1, \\dot R_2 \\rangle = \\frac{1}{2} \\text{tr}(\\dot R_1^T \\dot R_2) \\end{gather} $$这个内积有很棒的性质，它在左作用和右作用下都是不变的，我们称之为双边不变（bi-invariant）内积。也就是说对于任意 $A, B \\in SO(3)$，都有：\n$$ \\langle A \\dot R_1 B, A \\dot R_2 B \\rangle = \\langle \\dot R_1, \\dot R_2 \\rangle $$双不变性代表了对于任意群元 $A, B\\in SO(3)$，不论将其变换到何处，其内积都保持不变。SO(3) 中存在双不变度量，恰恰对应于 $SO(3)$ 代表刚体运动与位置无关的物理意义。利用这个内积，我们可以将能量泛函写成：\n$$ \\begin{gather}\\begin{aligned} E(R) \u0026= \\frac{1}{2} \\int_a^b \\langle \\dot R, \\dot R \\rangle dt\\\\ \u0026= \\frac{1}{4} \\int_a^b \\text{tr}(\\dot R^T \\dot R) dt \\end{aligned}\\end{gather} $$对于优化问题，不妨把形式前的 $\\frac{1}{2}$ 忽略掉，因为它并不影响优化结果：\n$$ \\begin{gather} E(R) = \\int_a^b \\text{tr}(\\dot R^T \\dot R) dt \\end{gather}\n$$\n1.2. 引入约束 由于 $R\\in SO(3)$，需要满足正交条件：\n$$ R^T R = I $$因此不能直接优化上面的能量泛函。我们需要通过拉格朗日乘子法 (Lagrange Multiplier Method) 引入约束。假设存在对称矩阵 $\\Lambda(t)$，我们可以构造约束量：\n$$ \\begin{gather} \\begin{aligned} E(R) \u0026= \\int_a^b \\text{tr}(\\dot R^T \\dot R) dt + \\int_a^b \\text{tr}(\\Lambda^T (R^T R - I)) dt\\\\ \u0026= \\int_a^b \\text{tr}(\\dot R^T \\dot R) + \\text{tr}(\\Lambda^T (R^T R - I)) dt\\\\ \u0026= \\int_a^b \\mathcal L(R, \\dot R, \\Lambda) dt \\end{aligned} \\end{gather} $$其中 $L(R, \\dot R, \\Lambda)$ 是拉格朗日量，有：\n$$ L(R, \\dot R, \\Lambda) = \\text{tr}(\\dot R^T \\dot R) + \\text{tr}(\\Lambda^T (R^T R - I)) $$1.3. 变分并得到 Euler–Lagrange 方程 对于 $L(R, \\dot R, \\Lambda)$，我们希望对 $R$ 变分，得到满足测地线条件的 $R(t)$。考虑一个小扰动 $\\epsilon$：\n$$ \\begin{aligned} \u0026R(t) = R(t) + \\epsilon \\delta R(t)\u0026 \\text{where: }\\sigma R(a) = \\delta R(b) = 0 \\end{aligned} $$那么拉格朗日量 $L(R, \\dot R, \\Lambda)$ 对于 $R$ 的变分为：\n$$ \\delta L = \\frac{d}{d\\epsilon}\\bigg|_{\\epsilon=0} \\mathcal{L}(R + \\epsilon \\delta R, \\dot R + \\epsilon \\delta \\dot R, \\Lambda) $$不妨分块分析。对于能量项，有：\n$$ \\text{tr}\\left((\\dot R + \\epsilon \\delta \\dot R)^T (\\dot R + \\epsilon \\delta \\dot R)\\right) = \\text{tr}(\\dot R^T \\dot R) + 2\\epsilon \\text{tr}(\\dot R^T \\delta \\dot R) + O(\\epsilon^2) $$那么：\n$$ \\begin{gather}\\begin{aligned} \u0026\\frac{d}{d\\epsilon}\\bigg|_{\\epsilon=0} \\text{tr}\\left((\\dot R + \\epsilon \\delta \\dot R)^T (\\dot R + \\epsilon \\delta \\dot R)\\right)\\\\ =\u0026 \\lim_{\\epsilon\\to 0}\\frac{\\text{tr}\\left((\\dot R + \\epsilon \\delta \\dot R)^T (\\dot R + \\epsilon \\delta \\dot R)\\right) - \\text{tr}(\\dot R^T \\dot R)}{\\epsilon}\\\\ =\u0026 2 \\text{tr}(\\dot R^T \\delta \\dot R) \\end{aligned}\\end{gather} $$对于约束项，有：\n$$ \\begin{gather} \\begin{aligned} \u0026\\frac{d}{d\\epsilon}\\bigg|_{\\epsilon=0} \\text{tr}\\left(\\Lambda^T \\left((R(t) + \\epsilon \\delta R(t))^T (R(t) + \\epsilon \\delta R(t)) - I\\right)\\right)\\\\ =\u0026 \\lim_{\\epsilon\\to 0} \\frac{\\text{tr}\\left(\\Lambda^T \\left((R(t) + \\epsilon \\delta R(t))^T (R(t) + \\epsilon \\delta R(t)) - I\\right)\\right) - \\text{tr}\\left(\\Lambda^T (R(t)^T R(t) - I)\\right)}{\\epsilon}\\\\ =\u0026 2\\text{tr}\\left(\\Lambda^T R^T\\delta R \\right) \\end{aligned} \\end{gather} $$那么有：\n$$ \\begin{gather} \\delta \\mathcal L = 2 \\text{tr}(\\dot R^T \\delta \\dot R) + 2\\text{tr}\\left(\\Lambda^T R^T\\delta R \\right) \\end{gather} $$那么有：\n$$ \\begin{gather}\\begin{aligned} \\delta E \u0026= \\int_a^b \\delta \\mathcal L dt \\\\ \u0026= \\int_a^b 2 \\text{tr}(\\dot R^T \\delta \\dot R) + 2\\text{tr}\\left(\\Lambda^T R^T\\delta R \\right) dt \\end{aligned}\\end{gather} $$对于第一项，可以使用分布积分计算：\n$$ \\begin{gather} \\begin{aligned} \\int_a^b 2 \\text{tr}(\\dot R^T \\delta \\dot R) dt \u0026= 2 \\text{tr}(\\dot R^T \\delta R) \\bigg|_a^b - \\int_a^b 2 \\text{tr}(\\ddot R^T \\delta R) dt\\\\ \u0026= - \\int_a^b 2 \\text{tr}(\\ddot R^T \\delta R) dt \\end{aligned} \\end{gather} $$那么有：\n$$ \\begin{aligned} \\sigma E \u0026= \\int_a^b -\\text{tr}(\\ddot R^T \\delta R) + 2\\text{tr}\\left(\\Lambda^T R^T\\delta R \\right)dt\\\\ \u0026= \\int_a^b 2\\text{tr}\\left( \\Lambda^T R^T\\delta R - \\ddot R^T \\delta R \\right)dt\\\\ \u0026= \\int_a^b 2\\text{tr}\\left( (\\Lambda^T R^T - \\ddot R^T) \\delta R \\right)dt \\end{aligned} $$泛函最优条件是：\n$$ \\delta E = 0 $$那么要对任意 $\\delta R$ 都成立，必须有：\n$$ \\begin{aligned} \\Lambda^T R^T - \\ddot R^T \u0026= 0\\\\ \\ddot R \u0026= R \\Lambda \\end{aligned} $$这就是我们的测地线方程！\n$$ \\begin{gather} \\boxed{\\ddot R = R \\Lambda} \\end{gather} $$2. 从测地线到指数映射 在 SO(3) 上，不妨假设存在一条通过单位元 $I$ 的曲线 $R(t)$，满足：\n$$ R(0) = I $$那么应有：\n$$ R^T(t)R(t) = I $$两边对 $t$ 求导，则有：\n$$ \\begin{aligned} \\dot R^T(t) R(t) + R^T(t) \\dot R(t) \u0026= 0\\\\ R(t)^T\\dot R^T(t) \u0026= -\\left(R(t)^T\\dot R^T(t)\\right)^T \\end{aligned} $$可以知道 $\\dot R^T(t) R(t)$ 是一个反对称矩阵，不妨将这个反对称矩阵记作 $\\Omega(t)$，则有：\n$$ \\begin{aligned} R(t)^T\\dot R^T(t) \u0026= \\Omega(t)\\\\ \\end{aligned} $$对上面的形式再次求导，则有：\n$$ \\begin{aligned} \\dot \\Omega(t) = \\dot R^T\\dot R + R^T \\ddot R \\end{aligned} $$根据约束条件，不难得出：\n$$ \\dot R = -R \\dot R^T R $$那么第一项可以变换为：\n$$ \\dot R^T\\dot R = -\\dot R^T R \\dot R^T R = -\\Omega^2 $$那么，有：\n$$ \\dot \\Omega = R^T \\ddot R - \\Omega^2 $$带入测地线方程，则有：\n$$ \\dot \\Omega = \\Lambda - \\Omega^2 $$我们知道：\n形式 性质 $\\Omega$ 反对称矩阵 $\\Lambda$ 对称矩阵 $\\Omega^2$ 对称矩阵 $\\dot \\Omega$ 反对称矩阵 $\\Lambda - \\Omega^2$ 对称矩阵 这要求 $\\dot \\Omega$ 即是反对称矩阵，还是对称矩阵。因此唯一的可能形式：\n$$ \\dot \\Omega = 0 $$那么 $\\Omega(t)$ 则与 $t$ 无关，是一个常矩阵，不妨记作 $\\Omega$。那么有：\n$$ \\dot R(t) = R(t) \\Omega $$如果你对常微分方程熟悉不难看出，对于上面这个简单的一阶常微分方程，其解可以很容易的写出：\n$$ R(t) = R_0\\exp(t\\Omega) $$这恰恰是指数映射！\n3. 讨论 在3d-kinematics-and-dynamics 一文中我们讨论过旋转矩阵导数与角速度之间的关系。不难发现事实上 $\\Omega$ 就是角速度向量的反对称矩阵的形式。\n那么 $\\dot \\Omega = 0$ 的物理含义就很好理解了。这事实上对应了三维刚体上的匀速旋转。这也是测地线的物理意义。对于一个刚体来说，在没有外力矩作用下，其会以匀速旋转的形式运动。而这个匀速旋转恰恰对应了 SO(3) 上的测地线。\n那么对于指数映射 $R = \\exp(\\omega^\\times)$，可以解释为：从单位元 $I$ 出发，在单位时间以角速度 $\\omega$ 旋转所到达的角度。\n那么李代数所同构的单参数子群的物理含义也很好解释了：事实上表达的是从单位元出发，以全部角速度出发，在单位时间内的所有测地线的总和。\n","wordCount":"852","inLanguage":"en","image":"https://wangjv0812.cn/","datePublished":"2025-10-31T11:37:25+08:00","dateModified":"2025-10-31T11:37:25+08:00","author":{"@type":"Person","name":"WangJV"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wangjv0812.cn/2025/10/geodesic-and-lie-algebra-in-so3/"},"publisher":{"@type":"Organization","name":"WangJV Blog","logo":{"@type":"ImageObject","url":"https://wangjv0812.cn/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wangjv0812.cn/ accesskey=h title="WangJV Blog (Alt + H)">WangJV Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://wangjv0812.cn/ title=Home><span>Home</span></a></li><li><a href=https://wangjv0812.cn/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://wangjv0812.cn/resources/ title=Resources><span>Resources</span></a></li><li><a href=https://wangjv0812.cn/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://wangjv0812.cn/search/ title="🔍 Search (Alt + /)" accesskey=/><span>🔍 Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wangjv0812.cn/>Home</a>&nbsp;»&nbsp;<a href=https://wangjv0812.cn/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Geodesic and Lie Algebra in SO(3)</h1><div class=post-meta><span title='2025-10-31 11:37:25 +0800 +0800'>October 31, 2025</span>&nbsp;·&nbsp;WangJV&nbsp;|&nbsp;<a href=https://github.com/WangJV0812/WangJV-Blog-Source/tree/master/content/posts/Geodesic%20and%20Lie%20Algebra%20in%20SO%283%29/inedx.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#1-测地线geodesic>1. 测地线（Geodesic）</a><ul><li><a href=#11-so3-上的-riemann-度量>1.1. SO(3) 上的 Riemann 度量</a></li><li><a href=#12-引入约束>1.2. 引入约束</a></li><li><a href=#13-变分并得到-eulerlagrange-方程>1.3. 变分并得到 Euler–Lagrange 方程</a></li></ul></li><li><a href=#2-从测地线到指数映射>2. 从测地线到指数映射</a></li><li><a href=#3-讨论>3. 讨论</a></li></ul></nav></div></details></div><div class=post-content><h2 id=1-测地线geodesic>1. 测地线（Geodesic）<a hidden class=anchor aria-hidden=true href=#1-测地线geodesic>#</a></h2><p>对于一个曲率不为 $0$ 的流形，其上任意两点之间的最短路径无法简单的像是欧式几何上一样，直接通过一条平直曲线描述。因此在一个曲面上，我们定一任意两点之间最短的路径为测地线（Geodesic）。我们不妨记在 $SO(3)$ 上受到参数 $t$ 控制的任意曲线为 $R(t)$。对于一个 Riemann 度量 $\| \cdot \|$，我们可以定义曲线的弧长：</p>$$
\begin{gather}
L(R)\int_a^b \sqrt{\| dR \|^2} = \int_a^b \sqrt{\| \dot R \|^2} dt
\end{gather}
$$<p>这就是在一个流形（或者说曲面）上关于任意曲线的弧长泛函。对于上个泛函，我们只需要对 $R(t)$ 变分，得到任意两点之间弧长泛函最小的曲线 $R(t)$ 满足的形式，测地线问题就解决了。但是如果你对变分和 Eular-Lagrange 方程熟悉的话，会自然的发现上面这个形式要处理并不容易。我们一般会扔掉 $\sqrt{\cdot}$，直接取曲线的能量泛函：</p>$$
\begin{gather}
E(R) = \frac{1}{2} \int_a^b \| \dot R \|^2 dt
\end{gather}
$$<h3 id=11-so3-上的-riemann-度量>1.1. SO(3) 上的 Riemann 度量<a hidden class=anchor aria-hidden=true href=#11-so3-上的-riemann-度量>#</a></h3><p>在任意的 Riemann 流形 $M$ 上的每个点 $p \in M$，切空间 $T_pM$ 是一个向量空间。我们在这个空间上定义一个内积：</p>$$
\langle \cdot, \cdot \rangle_p : T_pM \times T_pM \to \mathbb{R}
$$<p>内积需要满足四个性质：</p><ol><li>对称性：$\langle X, Y \rangle_p = \langle Y, X \rangle_p$</li><li>双线性：线性于两个分量</li><li>正定性：$\langle X, X \rangle_p > 0$ 当 $X \neq 0$</li><li>平滑性：对于任意光滑向量场 $X, Y$，$\langle X, Y \rangle$ 是一个光滑函数</li></ol><p>当我们将每个点的内积拼接起来时，可以得到一个光滑的张量场：</p>$$
\begin{gather}
g_p(X, Y) = \langle X, Y \rangle_p\\
g : TM \times TM \to \mathbb{R}
\end{gather}
$$<p>我们 $g$ 是黎曼度量（Riemann Metric）。那么诱导的，我们需要在 SO(3) 上定义一个合理的内积，就解决了能量泛函中所需要的 $\| \dot R \|^2$ 的问题。不妨用内积来描述能量泛函更佳优雅：</p>$$
\begin{gather}
E(R) = \frac{1}{2} \int_a^b \langle \dot R, \dot R \rangle dt
\end{gather}
$$<p>在 SO(3) 上，我们知道，切空间 $T_{R(t)}SO(3)$ 是 $3 \times 3$ 反对称矩阵和叉乘构成的群，其同构于三维欧式空间 $\mathbb{R}^3$ 与加法构成的群。因此对于任意 $R \in SO(3)$，$\dot R \in T_{R(t)}SO(3)$，$\dot R$ 同构于 $\omega \in \mathbb{R}^3$。一个自然的内积定义是：</p>$$
\langle \omega_1, \omega_2 \rangle = \frac{1}{2} \omega_1^T \omega_2
$$<p>很容易证明，该内积在 $T_{R(t)}SO(3)$ 中等价于：</p>$$
\begin{gather}
\langle \dot R_1, \dot R_2 \rangle = \frac{1}{2} \text{tr}(\dot R_1^T \dot R_2)
\end{gather}
$$<p>这个内积有很棒的性质，它在左作用和右作用下都是不变的，我们称之为双边不变（bi-invariant）内积。也就是说对于任意 $A, B \in SO(3)$，都有：</p>$$
\langle A \dot R_1 B, A \dot R_2 B \rangle = \langle \dot R_1, \dot R_2 \rangle
$$<p>双不变性代表了对于任意群元 $A, B\in SO(3)$，不论将其变换到何处，其内积都保持不变。SO(3) 中存在双不变度量，恰恰对应于 $SO(3)$ 代表刚体运动与位置无关的物理意义。利用这个内积，我们可以将能量泛函写成：</p>$$
\begin{gather}\begin{aligned}
E(R)
&= \frac{1}{2} \int_a^b \langle \dot R, \dot R \rangle dt\\
&= \frac{1}{4} \int_a^b \text{tr}(\dot R^T \dot R) dt
\end{aligned}\end{gather}
$$<p>对于优化问题，不妨把形式前的 $\frac{1}{2}$ 忽略掉，因为它并不影响优化结果：</p><p>$$
\begin{gather}
E(R) = \int_a^b \text{tr}(\dot R^T \dot R) dt
\end{gather}</p><p>$$</p><h3 id=12-引入约束>1.2. 引入约束<a hidden class=anchor aria-hidden=true href=#12-引入约束>#</a></h3><p>由于 $R\in SO(3)$，需要满足正交条件：</p>$$
R^T R = I
$$<p>因此不能直接优化上面的能量泛函。我们需要通过拉格朗日乘子法 (Lagrange Multiplier Method) 引入约束。假设存在对称矩阵 $\Lambda(t)$，我们可以构造约束量：</p>$$
\begin{gather}
\begin{aligned}
E(R)
&= \int_a^b \text{tr}(\dot R^T \dot R) dt + \int_a^b \text{tr}(\Lambda^T (R^T R - I)) dt\\
&= \int_a^b \text{tr}(\dot R^T \dot R) + \text{tr}(\Lambda^T (R^T R - I)) dt\\
&= \int_a^b \mathcal L(R, \dot R, \Lambda) dt
\end{aligned}
\end{gather}
$$<p>其中 $L(R, \dot R, \Lambda)$ 是拉格朗日量，有：</p>$$
L(R, \dot R, \Lambda) = \text{tr}(\dot R^T \dot R) + \text{tr}(\Lambda^T (R^T R - I))
$$<h3 id=13-变分并得到-eulerlagrange-方程>1.3. 变分并得到 Euler–Lagrange 方程<a hidden class=anchor aria-hidden=true href=#13-变分并得到-eulerlagrange-方程>#</a></h3><p>对于 $L(R, \dot R, \Lambda)$，我们希望对 $R$ 变分，得到满足测地线条件的 $R(t)$。考虑一个小扰动 $\epsilon$：</p>$$
\begin{aligned}
&R(t) = R(t) + \epsilon \delta R(t)& \text{where: }\sigma R(a) = \delta R(b) = 0
\end{aligned}
$$<p>那么拉格朗日量 $L(R, \dot R, \Lambda)$ 对于 $R$ 的变分为：</p>$$
\delta L = \frac{d}{d\epsilon}\bigg|_{\epsilon=0} \mathcal{L}(R + \epsilon \delta R, \dot R + \epsilon \delta \dot R, \Lambda)
$$<p>不妨分块分析。对于能量项，有：</p>$$
\text{tr}\left((\dot R + \epsilon \delta \dot R)^T (\dot R + \epsilon \delta \dot R)\right) = \text{tr}(\dot R^T \dot R) + 2\epsilon \text{tr}(\dot R^T \delta \dot R) + O(\epsilon^2)
$$<p>那么：</p>$$
\begin{gather}\begin{aligned}
&\frac{d}{d\epsilon}\bigg|_{\epsilon=0} \text{tr}\left((\dot R + \epsilon \delta \dot R)^T (\dot R + \epsilon \delta \dot R)\right)\\
=& \lim_{\epsilon\to 0}\frac{\text{tr}\left((\dot R + \epsilon \delta \dot R)^T (\dot R + \epsilon \delta \dot R)\right) - \text{tr}(\dot R^T \dot R)}{\epsilon}\\
=& 2 \text{tr}(\dot R^T \delta \dot R)
\end{aligned}\end{gather}
$$<p>对于约束项，有：</p>$$
\begin{gather}
\begin{aligned}
&\frac{d}{d\epsilon}\bigg|_{\epsilon=0} \text{tr}\left(\Lambda^T \left((R(t) + \epsilon \delta R(t))^T (R(t) + \epsilon \delta R(t)) - I\right)\right)\\
=& \lim_{\epsilon\to 0} \frac{\text{tr}\left(\Lambda^T \left((R(t) + \epsilon \delta R(t))^T (R(t) + \epsilon \delta R(t)) - I\right)\right) - \text{tr}\left(\Lambda^T (R(t)^T R(t) - I)\right)}{\epsilon}\\
=& 2\text{tr}\left(\Lambda^T R^T\delta R \right)
\end{aligned}
\end{gather}
$$<p>那么有：</p>$$
\begin{gather}
\delta \mathcal L = 2 \text{tr}(\dot R^T \delta \dot R) + 2\text{tr}\left(\Lambda^T R^T\delta R \right)
\end{gather}
$$<p>那么有：</p>$$
\begin{gather}\begin{aligned}
\delta E
&= \int_a^b \delta \mathcal L dt \\
&= \int_a^b 2 \text{tr}(\dot R^T \delta \dot R) + 2\text{tr}\left(\Lambda^T R^T\delta R \right) dt
\end{aligned}\end{gather}
$$<p>对于第一项，可以使用分布积分计算：</p>$$
\begin{gather}
\begin{aligned}
\int_a^b 2 \text{tr}(\dot R^T \delta \dot R) dt
&= 2 \text{tr}(\dot R^T \delta R) \bigg|_a^b - \int_a^b 2 \text{tr}(\ddot R^T \delta R) dt\\
&= - \int_a^b 2 \text{tr}(\ddot R^T \delta R) dt
\end{aligned}
\end{gather}
$$<p>那么有：</p>$$
\begin{aligned}
\sigma E
&= \int_a^b -\text{tr}(\ddot R^T \delta R) + 2\text{tr}\left(\Lambda^T R^T\delta R \right)dt\\
&= \int_a^b 2\text{tr}\left(
\Lambda^T R^T\delta R - \ddot R^T \delta R
\right)dt\\
&= \int_a^b 2\text{tr}\left(
(\Lambda^T R^T - \ddot R^T) \delta R
\right)dt
\end{aligned}
$$<p>泛函最优条件是：</p>$$
\delta E = 0
$$<p>那么要对任意 $\delta R$ 都成立，必须有：</p>$$
\begin{aligned}
\Lambda^T R^T - \ddot R^T &= 0\\
\ddot R &= R \Lambda
\end{aligned}
$$<p>这就是我们的测地线方程！</p>$$
\begin{gather}
\boxed{\ddot R = R \Lambda}
\end{gather}
$$<h2 id=2-从测地线到指数映射>2. 从测地线到指数映射<a hidden class=anchor aria-hidden=true href=#2-从测地线到指数映射>#</a></h2><p>在 SO(3) 上，不妨假设存在一条通过单位元 $I$ 的曲线 $R(t)$，满足：</p>$$
R(0) = I
$$<p>那么应有：</p>$$
R^T(t)R(t) = I
$$<p>两边对 $t$ 求导，则有：</p>$$
\begin{aligned}
\dot R^T(t) R(t) + R^T(t) \dot R(t) &= 0\\
R(t)^T\dot R^T(t) &= -\left(R(t)^T\dot R^T(t)\right)^T
\end{aligned}
$$<p>可以知道 $\dot R^T(t) R(t)$ 是一个反对称矩阵，不妨将这个反对称矩阵记作 $\Omega(t)$，则有：</p>$$
\begin{aligned}
R(t)^T\dot R^T(t) &= \Omega(t)\\
\end{aligned}
$$<p>对上面的形式再次求导，则有：</p>$$
\begin{aligned}
\dot \Omega(t) = \dot R^T\dot R + R^T \ddot R
\end{aligned}
$$<p>根据约束条件，不难得出：</p>$$
\dot R = -R \dot R^T R
$$<p>那么第一项可以变换为：</p>$$
\dot R^T\dot R = -\dot R^T R \dot R^T R = -\Omega^2
$$<p>那么，有：</p>$$
\dot \Omega = R^T \ddot R - \Omega^2
$$<p>带入测地线方程，则有：</p>$$
\dot \Omega = \Lambda - \Omega^2
$$<p>我们知道：</p><table><thead><tr><th>形式</th><th>性质</th></tr></thead><tbody><tr><td>$\Omega$</td><td>反对称矩阵</td></tr><tr><td>$\Lambda$</td><td>对称矩阵</td></tr><tr><td>$\Omega^2$</td><td>对称矩阵</td></tr><tr><td>$\dot \Omega$</td><td>反对称矩阵</td></tr><tr><td>$\Lambda - \Omega^2$</td><td>对称矩阵</td></tr></tbody></table><p>这要求 $\dot \Omega$ 即是反对称矩阵，还是对称矩阵。因此唯一的可能形式：</p>$$
\dot \Omega = 0
$$<p>那么 $\Omega(t)$ 则与 $t$ 无关，是一个常矩阵，不妨记作 $\Omega$。那么有：</p>$$
\dot R(t) = R(t) \Omega
$$<p>如果你对常微分方程熟悉不难看出，对于上面这个简单的一阶常微分方程，其解可以很容易的写出：</p>$$
R(t) = R_0\exp(t\Omega)
$$<p>这恰恰是指数映射！</p><h2 id=3-讨论>3. 讨论<a hidden class=anchor aria-hidden=true href=#3-讨论>#</a></h2><p>在<a href=https://wangjv0812.cn/2025/06/3d-kinematics-and-dynamics/#23-%E6%97%8B%E8%BD%AC%E7%9F%A9%E9%98%B5%E7%9A%84%E5%AF%BC%E6%95%B0>3d-kinematics-and-dynamics</a> 一文中我们讨论过旋转矩阵导数与角速度之间的关系。不难发现事实上 $\Omega$ 就是角速度向量的反对称矩阵的形式。</p><p>那么 $\dot \Omega = 0$ 的物理含义就很好理解了。这事实上对应了三维刚体上的匀速旋转。这也是测地线的物理意义。对于一个刚体来说，在没有外力矩作用下，其会以匀速旋转的形式运动。而这个匀速旋转恰恰对应了 SO(3) 上的测地线。</p><p>那么对于指数映射 $R = \exp(\omega^\times)$，可以解释为：从单位元 $I$ 出发，在单位时间以角速度 $\omega$ 旋转所到达的角度。</p><p>那么李代数所同构的单参数子群的物理含义也很好解释了：事实上表达的是从单位元出发，以全部角速度出发，在单位时间内的所有测地线的总和。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://wangjv0812.cn/tags/so3/>SO(3)</a></li><li><a href=https://wangjv0812.cn/tags/%E6%B5%8B%E5%9C%B0%E7%BA%BF/>测地线</a></li><li><a href=https://wangjv0812.cn/tags/%E6%9D%8E%E4%BB%A3%E6%95%B0/>李代数</a></li><li><a href=https://wangjv0812.cn/tags/%E6%8C%87%E6%95%B0%E6%98%A0%E5%B0%84/>指数映射</a></li></ul><nav class=paginav><a class=next href=https://wangjv0812.cn/2025/10/variational-bayesian-inference/><span class=title>Next »</span><br><span>Variational Bayesian Inference</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://wangjv0812.cn/>WangJV Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>