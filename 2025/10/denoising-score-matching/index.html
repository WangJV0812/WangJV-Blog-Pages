<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Denoising Score Matching | WangJV Blog</title><meta name=keywords content="ç¥ç»ç½‘ç»œ,ç”Ÿæˆæ¨¡å‹,Denoising Score Matching,diffusion,æ— ç›‘ç£å­¦ä¹ "><meta name=description content="1. åŠ¨æœº
ä»¥æ•°æ®ç”Ÿæˆä¸ºä»£è¡¨çš„è‡ªç›‘ç£å­¦ä¹ å¾€å¾€å¸Œæœ›è®¾è®¡å‡ºä¸€ç§ç‹¬ç‰¹ä¸”æœ‰æ•ˆçš„æœºåˆ¶ï¼Œé€šè¿‡ç½‘ç»œç»“æ„å’Œè®­ç»ƒæ–¹æ³•çš„è®¾è®¡ï¼Œè¿«ä½¿æ¨¡å‹æ‰¾åˆ°ä»£è¡¨ä¸€ä¸ªæ•°æ®æœ€æ ¸å¿ƒå’Œå…³é”®çš„ä¿¡æ¯æˆ–è€…è¯´ç‰¹å¾ï¼Œæˆ–è€…å¸Œæœ›è®©æ¨¡å‹è‡ªå·±æ€»ç»“å‡ºæ•°æ®çš„å†…åœ¨ç»“æ„ã€‚æˆ–è€…ç”¨ä¸€ä¸ªæ›´æ¦‚ç‡çš„è¡¨è¾¾ï¼Œå°±åƒæ˜¯ä¹‹å‰æˆ‘ä»¬åœ¨ NCE ä¸­å¯¹äºæ•°æ®æµå½¢ è®¨è®ºè¿‡çš„ã€‚æ•°æ®æ˜¯ä¸€ä¸ªéšè—åœ¨é«˜ç»´ç©ºé—´ä¸­çš„ä½ç»´æµå½¢ï¼Œè€Œæ¦‚ç‡åˆ†å¸ƒæ°å¥½ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„æè¿°æµå½¢çš„æ•°å­¦å·¥å…·ã€‚
æˆ‘ä»¬å‡è®¾çœŸå®æ•°æ®æœ‰æ¦‚ç‡åˆ†å¸ƒ $p(x)$ï¼Œè€Œæˆ‘ä»¬å¸Œæœ›å¯»æ‰¾ä¸€ä¸ªæ”¶åˆ°å‚æ•° $\theta$ æ§åˆ¶çš„æ¦‚ç‡åˆ†å¸ƒ $q(x\mid \theta)$ï¼Œå°½å¯èƒ½çš„æ¥è¿‘çœŸå®åˆ†å¸ƒã€‚ç”Ÿæˆæ¨¡å‹å­¦ä¹ äº‹å®ä¸Šå¸Œæœ›è§£å†³ä¸¤ä¸ªå®è´¨æ€§çš„é—®é¢˜ï¼š

æˆ‘ä»¬ä¸çŸ¥é“çœŸå®åˆ†å¸ƒ $p(x)$ï¼Œåªæœ‰å¯¹äº $p(x)$ çš„ä¸€ç³»åˆ—é‡‡æ · $\{x_1, x_2, \cdots x_n\}$ï¼ˆå°±æ˜¯æˆ‘ä»¬çš„æ•°æ®é›†ï¼‰ï¼Œå¦‚ä½•åˆ©ç”¨è¿™äº›é‡‡æ ·å°½å¯èƒ½å¥½çš„æ‰¾åˆ°ä¸€ç»„å‚æ•° $\theta$ï¼Œä½¿å¾— $q(x\mid \theta)$ å°½å¯èƒ½æ¥è¿‘ $p(x)$ã€‚
å¯¹äºä¸€ä¸ªå®Œæˆå­¦ä¹ çš„åˆ†å¸ƒ $p(x\mid \theta)$ï¼Œå¦‚ä½•å¯¹å…¶é‡‡æ ·ï¼Œè·å¾—ä¸€ç»„æ–°çš„æ•°æ®ã€‚è¿›ä¸€æ­¥å°†ï¼Œå¦‚ä½•è®©é‡‡æ ·æ»¡è¶³ä¸€å®šçš„æ¡ä»¶ã€‚

è¿™ä¸¤ä¸ªé—®é¢˜çœ‹è¯´æ¥å®¹æ˜“ï¼Œä½†åšèµ·æ¥å´ä½•å…¶éš¾ã€‚ä»æ¬¡å¼•å‡ºäº†å·¨é‡çš„é—®é¢˜ï¼Œä¾‹å¦‚å¦‚ä½•è§„é¿åˆ†å¸ƒçš„å½’ä¸€åŒ–ç³»æ•°ã€å¦‚ä½•é¿å…å­¦ä¹ ä¸€ä¸ªæ’ç­‰æ˜ å°„ï¼ˆä¾‹å¦‚ AutoEncoderï¼‰ã€å¦‚ä½•é¿å…åªå­¦åˆ°ä¸€ä¸ªå¾ˆçª„çš„åˆ†å¸ƒï¼ˆSMï¼‰ç­‰ç­‰ã€‚å½’ä¸€åŒ–ç³»æ•°æˆ‘ä»¬ä¹‹å‰åœ¨ Score Matching ä¸­è®¨è®ºè¿‡ã€‚ä¸ºäº† DSM å™è¿°çš„è¿è´¯æ€§ï¼Œæˆ‘ä»¬ä¸å¦¨å…ˆä» Autoencoder çš„ç¼ºé™·å’Œæ”¹è¿›èŠèµ·ã€‚
1.1. Denoising AutoEncoder
AutoEncoder æ˜¯ä¸€ä¸ªéå¸¸ç›´è§‰çš„æ— ç›‘ç£å­¦ä¹ æ–¹æ³•ã€‚å®ƒåŸºäºä¸€ä¸ªå¾ˆç›´è§‰çš„è®¤è¯†ï¼šæ— ç›‘ç£å­¦ä¹ å¸Œæœ›å­¦ä¹ ä¸€æ¡åˆ†å¸ƒåœ¨é«˜ç»´ç©ºé—´ä¸­çš„ä½ç»´æµå½¢ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç»´åº¦æ°å¥½ä¸ºä½ç»´æµå½¢ç‹¬ç«‹ç»´åº¦çš„ç“¶é¢ˆå±‚æ¥å¼ºè¿«æ¨¡å‹å­¦ä¹ ä¸€ä¸ªæœ‰æ•ˆçš„æ•°æ®å‹ç¼©å’Œæ¢å¤ï¼Œæ˜¯å¦æ°å¥½å¯ä»¥æå–å‡ºæ•°æ®æœ€æ ¹æœ¬çš„å†…åœ¨ç»“æ„ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¾ç„¶æœ‰å¾ˆå¤šç¼ºé™·ï¼Œä¾‹å¦‚æ¨¡å‹å­¦ä¹ åˆ°çš„ latent space ä¸å…·æœ‰è¿ç»­æ€§ï¼Œæ— æ³•ç›´æ¥æ’å€¼ï¼ˆè¿™ä¸ªé—®é¢˜è¢« VAE è§£å†³äº†ï¼‰ï¼Œæ¨¡å‹å¾ˆå®¹æ˜“å­¦åˆ°ä¸€ä¸ªæ’ç­‰æ˜ å°„ç­‰ç­‰ã€‚
ä¸ºäº†è§£å†³æ’ç­‰æ˜ å°„è¿™ä¸ªé—®é¢˜ï¼ŒDAE çš„æ€è·¯æ˜¯ï¼šå¦‚æœç®€å•çš„è¦æ±‚æ¨¡å‹è‡ªå·±é€šè¿‡ ç¼–ç -è§£ç  çš„æ–¹å¼ç ´åé‡å»ºæ•°æ®æ— æ³•ä¿è¯æ¨¡å‹å­¦åˆ°å¯é çš„ç‰¹å¾ï¼Œé‚£ä¹ˆä½•ä¸æˆ‘æ¥ç ´åå‘¢ï¼Ÿæˆ‘ä»¬ç›´æ¥ç»™æ•°æ®æ·»åŠ å™ªå£°ï¼Œå°†å¸¦æœ‰å™ªå£°çš„æ•°æ®è¾“å…¥ç¼–ç å™¨ï¼Œè®©æ¨¡å‹æ¢å¤å‡ºæ²¡æœ‰å™ªå£°çš„ï¼Œæºåˆçš„æ•°æ®ã€‚
å½¢å¼åŒ–çš„è®²ï¼Œå¯¹äºæ•°æ® $x$ï¼Œæˆ‘ä»¬æ·»åŠ æœä»é«˜æ–¯åˆ†å¸ƒçš„å™ªå£° $\epsilon \sim \mathcal N(x\mid 0, \sigma^2I)$ï¼Œæœ‰è¢«æ±¡æŸ“çš„æ•°æ®ï¼š
$$
\tilde{x} = x + \epsilon
$$é‚£ä¹ˆï¼ŒæŸå¤±å¯ä»¥å†™ä½œï¼š
$$
J_{DATA}(\theta) = \mathbb{E}\left(\left\|
\text{Decoder}(\text{Encoder} (x + \epsilon)) - x
\right\|^2\right)
$$1.2. Score Matching
æˆ‘ä»¬ä¹‹å‰åœ¨ Score Matching ä¸­è®¨è®ºè¿‡ Score Matching çš„åŸºæœ¬åŸç†ã€‚è¿™é‡Œç®€å•å›é¡¾ä¸€ä¸‹ã€‚Score Matching æœ€æ ¸å¿ƒçš„åˆ›æ–°æ˜¯å­¦ä¹ åˆ†å¸ƒçš„ Score Functionï¼Œè€Œä¸æ˜¯ç›´æ¥å­¦ä¹ åˆ†å¸ƒæœ¬èº«ã€‚å­¦ä¹  Score Function æœ€æ ¸å¿ƒçš„ä¼˜åŠ¿æ˜¯ï¼Œæˆ‘ä»¬å¯¹ Score Function çš„å½¢å¼æ²¡æœ‰ä»»ä½•è¦æ±‚ï¼Œå¯ä»¥ç”¨ä»»æ„ä¸€ä¸ªç¥ç»ç½‘ç»œæ‹Ÿåˆï¼Œä»æœ¬è´¨ä¸Šè§£å†³äº†å½’ä¸€åŒ–ç³»æ•°çš„é—®é¢˜ã€‚å¸Œæœ›å­¦ä¹ åˆ°åˆ†å¸ƒçš„ Score Function æœ€ç›´æ¥çš„æ–¹å¼ï¼Œå³ä½¿ç›´æ¥ä½¿ç”¨ Fisher Divergenceã€‚"><meta name=author content="WangJV"><link rel=canonical href=https://wangjv0812.cn/2025/10/denoising-score-matching/><link crossorigin=anonymous href=https://wangjv0812.cn/assets/css/stylesheet.2211ca3164be7830024f6aad2b3a2e520843a64f8f048445c3401c1249aa051d.css integrity="sha256-IhHKMWS+eDACT2qtKzouUghDpk+PBIRFw0AcEkmqBR0=" rel="preload stylesheet" as=style><link rel=icon href=https://wangjv0812.cn/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://wangjv0812.cn/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://wangjv0812.cn/favicon-32x32.png><link rel=apple-touch-icon href=https://wangjv0812.cn/apple-touch-icon.png><link rel=mask-icon href=https://wangjv0812.cn/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://wangjv0812.cn/2025/10/denoising-score-matching/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script>MathJax={tex:{displayMath:[["\\[","\\]"],["$$","$$"]],inlineMath:[["\\(","\\)"],["$","$"]],processEscapes:!0,processEnvironments:!0,tags:"ams"},chtml:{scale:1,minScale:.5,matchFontHeight:!1,displayAlign:"center",displayIndent:"0",mtextInheritFont:!1,merrorInheritFont:!0,mathmlSpacing:!1,skipHtmlTags:["script","noscript","style","textarea","pre","code","a"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"},svg:{scale:1,minScale:.5,mtextInheritFont:!1,merrorInheritFont:!0,mathmlSpacing:!1,skipHtmlTags:["script","noscript","style","textarea","pre","code","a"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"},options:{enableMenu:!0,menuOptions:{settings:{zoom:"Click"}}},loader:{load:["ui/safe","a11y/assistive-mml"]},startup:{ready(){MathJax.startup.defaultReady();const e=new ResizeObserver(e=>{MathJax.typesetPromise()});e.observe(document.body)}}},window.innerWidth<=768&&(MathJax.chtml=MathJax.chtml||{},MathJax.chtml.scale=.9)</script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script><style>.MathJax{outline:0}@media(max-width:768px){.MathJax{font-size:90%!important}.MathJax_Display{overflow-x:auto;overflow-y:hidden;padding:0!important;margin:1em 0!important}.MathJax_CHTML{line-height:1.2!important}}mjx-container[jax=CHTML][display=true]{overflow-x:auto;overflow-y:hidden;padding:1px 0}</style><meta property="og:url" content="https://wangjv0812.cn/2025/10/denoising-score-matching/"><meta property="og:site_name" content="WangJV Blog"><meta property="og:title" content="Denoising Score Matching"><meta property="og:description" content="1. åŠ¨æœº ä»¥æ•°æ®ç”Ÿæˆä¸ºä»£è¡¨çš„è‡ªç›‘ç£å­¦ä¹ å¾€å¾€å¸Œæœ›è®¾è®¡å‡ºä¸€ç§ç‹¬ç‰¹ä¸”æœ‰æ•ˆçš„æœºåˆ¶ï¼Œé€šè¿‡ç½‘ç»œç»“æ„å’Œè®­ç»ƒæ–¹æ³•çš„è®¾è®¡ï¼Œè¿«ä½¿æ¨¡å‹æ‰¾åˆ°ä»£è¡¨ä¸€ä¸ªæ•°æ®æœ€æ ¸å¿ƒå’Œå…³é”®çš„ä¿¡æ¯æˆ–è€…è¯´ç‰¹å¾ï¼Œæˆ–è€…å¸Œæœ›è®©æ¨¡å‹è‡ªå·±æ€»ç»“å‡ºæ•°æ®çš„å†…åœ¨ç»“æ„ã€‚æˆ–è€…ç”¨ä¸€ä¸ªæ›´æ¦‚ç‡çš„è¡¨è¾¾ï¼Œå°±åƒæ˜¯ä¹‹å‰æˆ‘ä»¬åœ¨ NCE ä¸­å¯¹äºæ•°æ®æµå½¢ è®¨è®ºè¿‡çš„ã€‚æ•°æ®æ˜¯ä¸€ä¸ªéšè—åœ¨é«˜ç»´ç©ºé—´ä¸­çš„ä½ç»´æµå½¢ï¼Œè€Œæ¦‚ç‡åˆ†å¸ƒæ°å¥½ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„æè¿°æµå½¢çš„æ•°å­¦å·¥å…·ã€‚
æˆ‘ä»¬å‡è®¾çœŸå®æ•°æ®æœ‰æ¦‚ç‡åˆ†å¸ƒ $p(x)$ï¼Œè€Œæˆ‘ä»¬å¸Œæœ›å¯»æ‰¾ä¸€ä¸ªæ”¶åˆ°å‚æ•° $\theta$ æ§åˆ¶çš„æ¦‚ç‡åˆ†å¸ƒ $q(x\mid \theta)$ï¼Œå°½å¯èƒ½çš„æ¥è¿‘çœŸå®åˆ†å¸ƒã€‚ç”Ÿæˆæ¨¡å‹å­¦ä¹ äº‹å®ä¸Šå¸Œæœ›è§£å†³ä¸¤ä¸ªå®è´¨æ€§çš„é—®é¢˜ï¼š
æˆ‘ä»¬ä¸çŸ¥é“çœŸå®åˆ†å¸ƒ $p(x)$ï¼Œåªæœ‰å¯¹äº $p(x)$ çš„ä¸€ç³»åˆ—é‡‡æ · $\{x_1, x_2, \cdots x_n\}$ï¼ˆå°±æ˜¯æˆ‘ä»¬çš„æ•°æ®é›†ï¼‰ï¼Œå¦‚ä½•åˆ©ç”¨è¿™äº›é‡‡æ ·å°½å¯èƒ½å¥½çš„æ‰¾åˆ°ä¸€ç»„å‚æ•° $\theta$ï¼Œä½¿å¾— $q(x\mid \theta)$ å°½å¯èƒ½æ¥è¿‘ $p(x)$ã€‚ å¯¹äºä¸€ä¸ªå®Œæˆå­¦ä¹ çš„åˆ†å¸ƒ $p(x\mid \theta)$ï¼Œå¦‚ä½•å¯¹å…¶é‡‡æ ·ï¼Œè·å¾—ä¸€ç»„æ–°çš„æ•°æ®ã€‚è¿›ä¸€æ­¥å°†ï¼Œå¦‚ä½•è®©é‡‡æ ·æ»¡è¶³ä¸€å®šçš„æ¡ä»¶ã€‚ è¿™ä¸¤ä¸ªé—®é¢˜çœ‹è¯´æ¥å®¹æ˜“ï¼Œä½†åšèµ·æ¥å´ä½•å…¶éš¾ã€‚ä»æ¬¡å¼•å‡ºäº†å·¨é‡çš„é—®é¢˜ï¼Œä¾‹å¦‚å¦‚ä½•è§„é¿åˆ†å¸ƒçš„å½’ä¸€åŒ–ç³»æ•°ã€å¦‚ä½•é¿å…å­¦ä¹ ä¸€ä¸ªæ’ç­‰æ˜ å°„ï¼ˆä¾‹å¦‚ AutoEncoderï¼‰ã€å¦‚ä½•é¿å…åªå­¦åˆ°ä¸€ä¸ªå¾ˆçª„çš„åˆ†å¸ƒï¼ˆSMï¼‰ç­‰ç­‰ã€‚å½’ä¸€åŒ–ç³»æ•°æˆ‘ä»¬ä¹‹å‰åœ¨ Score Matching ä¸­è®¨è®ºè¿‡ã€‚ä¸ºäº† DSM å™è¿°çš„è¿è´¯æ€§ï¼Œæˆ‘ä»¬ä¸å¦¨å…ˆä» Autoencoder çš„ç¼ºé™·å’Œæ”¹è¿›èŠèµ·ã€‚
1.1. Denoising AutoEncoder AutoEncoder æ˜¯ä¸€ä¸ªéå¸¸ç›´è§‰çš„æ— ç›‘ç£å­¦ä¹ æ–¹æ³•ã€‚å®ƒåŸºäºä¸€ä¸ªå¾ˆç›´è§‰çš„è®¤è¯†ï¼šæ— ç›‘ç£å­¦ä¹ å¸Œæœ›å­¦ä¹ ä¸€æ¡åˆ†å¸ƒåœ¨é«˜ç»´ç©ºé—´ä¸­çš„ä½ç»´æµå½¢ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç»´åº¦æ°å¥½ä¸ºä½ç»´æµå½¢ç‹¬ç«‹ç»´åº¦çš„ç“¶é¢ˆå±‚æ¥å¼ºè¿«æ¨¡å‹å­¦ä¹ ä¸€ä¸ªæœ‰æ•ˆçš„æ•°æ®å‹ç¼©å’Œæ¢å¤ï¼Œæ˜¯å¦æ°å¥½å¯ä»¥æå–å‡ºæ•°æ®æœ€æ ¹æœ¬çš„å†…åœ¨ç»“æ„ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¾ç„¶æœ‰å¾ˆå¤šç¼ºé™·ï¼Œä¾‹å¦‚æ¨¡å‹å­¦ä¹ åˆ°çš„ latent space ä¸å…·æœ‰è¿ç»­æ€§ï¼Œæ— æ³•ç›´æ¥æ’å€¼ï¼ˆè¿™ä¸ªé—®é¢˜è¢« VAE è§£å†³äº†ï¼‰ï¼Œæ¨¡å‹å¾ˆå®¹æ˜“å­¦åˆ°ä¸€ä¸ªæ’ç­‰æ˜ å°„ç­‰ç­‰ã€‚
ä¸ºäº†è§£å†³æ’ç­‰æ˜ å°„è¿™ä¸ªé—®é¢˜ï¼ŒDAE çš„æ€è·¯æ˜¯ï¼šå¦‚æœç®€å•çš„è¦æ±‚æ¨¡å‹è‡ªå·±é€šè¿‡ ç¼–ç -è§£ç  çš„æ–¹å¼ç ´åé‡å»ºæ•°æ®æ— æ³•ä¿è¯æ¨¡å‹å­¦åˆ°å¯é çš„ç‰¹å¾ï¼Œé‚£ä¹ˆä½•ä¸æˆ‘æ¥ç ´åå‘¢ï¼Ÿæˆ‘ä»¬ç›´æ¥ç»™æ•°æ®æ·»åŠ å™ªå£°ï¼Œå°†å¸¦æœ‰å™ªå£°çš„æ•°æ®è¾“å…¥ç¼–ç å™¨ï¼Œè®©æ¨¡å‹æ¢å¤å‡ºæ²¡æœ‰å™ªå£°çš„ï¼Œæºåˆçš„æ•°æ®ã€‚
å½¢å¼åŒ–çš„è®²ï¼Œå¯¹äºæ•°æ® $x$ï¼Œæˆ‘ä»¬æ·»åŠ æœä»é«˜æ–¯åˆ†å¸ƒçš„å™ªå£° $\epsilon \sim \mathcal N(x\mid 0, \sigma^2I)$ï¼Œæœ‰è¢«æ±¡æŸ“çš„æ•°æ®ï¼š
$$ \tilde{x} = x + \epsilon $$é‚£ä¹ˆï¼ŒæŸå¤±å¯ä»¥å†™ä½œï¼š
$$ J_{DATA}(\theta) = \mathbb{E}\left(\left\| \text{Decoder}(\text{Encoder} (x + \epsilon)) - x \right\|^2\right) $$1.2. Score Matching æˆ‘ä»¬ä¹‹å‰åœ¨ Score Matching ä¸­è®¨è®ºè¿‡ Score Matching çš„åŸºæœ¬åŸç†ã€‚è¿™é‡Œç®€å•å›é¡¾ä¸€ä¸‹ã€‚Score Matching æœ€æ ¸å¿ƒçš„åˆ›æ–°æ˜¯å­¦ä¹ åˆ†å¸ƒçš„ Score Functionï¼Œè€Œä¸æ˜¯ç›´æ¥å­¦ä¹ åˆ†å¸ƒæœ¬èº«ã€‚å­¦ä¹  Score Function æœ€æ ¸å¿ƒçš„ä¼˜åŠ¿æ˜¯ï¼Œæˆ‘ä»¬å¯¹ Score Function çš„å½¢å¼æ²¡æœ‰ä»»ä½•è¦æ±‚ï¼Œå¯ä»¥ç”¨ä»»æ„ä¸€ä¸ªç¥ç»ç½‘ç»œæ‹Ÿåˆï¼Œä»æœ¬è´¨ä¸Šè§£å†³äº†å½’ä¸€åŒ–ç³»æ•°çš„é—®é¢˜ã€‚å¸Œæœ›å­¦ä¹ åˆ°åˆ†å¸ƒçš„ Score Function æœ€ç›´æ¥çš„æ–¹å¼ï¼Œå³ä½¿ç›´æ¥ä½¿ç”¨ Fisher Divergenceã€‚"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-10-13T20:40:25+08:00"><meta property="article:modified_time" content="2025-10-13T20:40:25+08:00"><meta property="article:tag" content="ç¥ç»ç½‘ç»œ"><meta property="article:tag" content="ç”Ÿæˆæ¨¡å‹"><meta property="article:tag" content="Denoising Score Matching"><meta property="article:tag" content="Diffusion"><meta property="article:tag" content="æ— ç›‘ç£å­¦ä¹ "><meta property="og:image" content="https://wangjv0812.cn/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wangjv0812.cn/"><meta name=twitter:title content="Denoising Score Matching"><meta name=twitter:description content="1. åŠ¨æœº
ä»¥æ•°æ®ç”Ÿæˆä¸ºä»£è¡¨çš„è‡ªç›‘ç£å­¦ä¹ å¾€å¾€å¸Œæœ›è®¾è®¡å‡ºä¸€ç§ç‹¬ç‰¹ä¸”æœ‰æ•ˆçš„æœºåˆ¶ï¼Œé€šè¿‡ç½‘ç»œç»“æ„å’Œè®­ç»ƒæ–¹æ³•çš„è®¾è®¡ï¼Œè¿«ä½¿æ¨¡å‹æ‰¾åˆ°ä»£è¡¨ä¸€ä¸ªæ•°æ®æœ€æ ¸å¿ƒå’Œå…³é”®çš„ä¿¡æ¯æˆ–è€…è¯´ç‰¹å¾ï¼Œæˆ–è€…å¸Œæœ›è®©æ¨¡å‹è‡ªå·±æ€»ç»“å‡ºæ•°æ®çš„å†…åœ¨ç»“æ„ã€‚æˆ–è€…ç”¨ä¸€ä¸ªæ›´æ¦‚ç‡çš„è¡¨è¾¾ï¼Œå°±åƒæ˜¯ä¹‹å‰æˆ‘ä»¬åœ¨ NCE ä¸­å¯¹äºæ•°æ®æµå½¢ è®¨è®ºè¿‡çš„ã€‚æ•°æ®æ˜¯ä¸€ä¸ªéšè—åœ¨é«˜ç»´ç©ºé—´ä¸­çš„ä½ç»´æµå½¢ï¼Œè€Œæ¦‚ç‡åˆ†å¸ƒæ°å¥½ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„æè¿°æµå½¢çš„æ•°å­¦å·¥å…·ã€‚
æˆ‘ä»¬å‡è®¾çœŸå®æ•°æ®æœ‰æ¦‚ç‡åˆ†å¸ƒ $p(x)$ï¼Œè€Œæˆ‘ä»¬å¸Œæœ›å¯»æ‰¾ä¸€ä¸ªæ”¶åˆ°å‚æ•° $\theta$ æ§åˆ¶çš„æ¦‚ç‡åˆ†å¸ƒ $q(x\mid \theta)$ï¼Œå°½å¯èƒ½çš„æ¥è¿‘çœŸå®åˆ†å¸ƒã€‚ç”Ÿæˆæ¨¡å‹å­¦ä¹ äº‹å®ä¸Šå¸Œæœ›è§£å†³ä¸¤ä¸ªå®è´¨æ€§çš„é—®é¢˜ï¼š

æˆ‘ä»¬ä¸çŸ¥é“çœŸå®åˆ†å¸ƒ $p(x)$ï¼Œåªæœ‰å¯¹äº $p(x)$ çš„ä¸€ç³»åˆ—é‡‡æ · $\{x_1, x_2, \cdots x_n\}$ï¼ˆå°±æ˜¯æˆ‘ä»¬çš„æ•°æ®é›†ï¼‰ï¼Œå¦‚ä½•åˆ©ç”¨è¿™äº›é‡‡æ ·å°½å¯èƒ½å¥½çš„æ‰¾åˆ°ä¸€ç»„å‚æ•° $\theta$ï¼Œä½¿å¾— $q(x\mid \theta)$ å°½å¯èƒ½æ¥è¿‘ $p(x)$ã€‚
å¯¹äºä¸€ä¸ªå®Œæˆå­¦ä¹ çš„åˆ†å¸ƒ $p(x\mid \theta)$ï¼Œå¦‚ä½•å¯¹å…¶é‡‡æ ·ï¼Œè·å¾—ä¸€ç»„æ–°çš„æ•°æ®ã€‚è¿›ä¸€æ­¥å°†ï¼Œå¦‚ä½•è®©é‡‡æ ·æ»¡è¶³ä¸€å®šçš„æ¡ä»¶ã€‚

è¿™ä¸¤ä¸ªé—®é¢˜çœ‹è¯´æ¥å®¹æ˜“ï¼Œä½†åšèµ·æ¥å´ä½•å…¶éš¾ã€‚ä»æ¬¡å¼•å‡ºäº†å·¨é‡çš„é—®é¢˜ï¼Œä¾‹å¦‚å¦‚ä½•è§„é¿åˆ†å¸ƒçš„å½’ä¸€åŒ–ç³»æ•°ã€å¦‚ä½•é¿å…å­¦ä¹ ä¸€ä¸ªæ’ç­‰æ˜ å°„ï¼ˆä¾‹å¦‚ AutoEncoderï¼‰ã€å¦‚ä½•é¿å…åªå­¦åˆ°ä¸€ä¸ªå¾ˆçª„çš„åˆ†å¸ƒï¼ˆSMï¼‰ç­‰ç­‰ã€‚å½’ä¸€åŒ–ç³»æ•°æˆ‘ä»¬ä¹‹å‰åœ¨ Score Matching ä¸­è®¨è®ºè¿‡ã€‚ä¸ºäº† DSM å™è¿°çš„è¿è´¯æ€§ï¼Œæˆ‘ä»¬ä¸å¦¨å…ˆä» Autoencoder çš„ç¼ºé™·å’Œæ”¹è¿›èŠèµ·ã€‚
1.1. Denoising AutoEncoder
AutoEncoder æ˜¯ä¸€ä¸ªéå¸¸ç›´è§‰çš„æ— ç›‘ç£å­¦ä¹ æ–¹æ³•ã€‚å®ƒåŸºäºä¸€ä¸ªå¾ˆç›´è§‰çš„è®¤è¯†ï¼šæ— ç›‘ç£å­¦ä¹ å¸Œæœ›å­¦ä¹ ä¸€æ¡åˆ†å¸ƒåœ¨é«˜ç»´ç©ºé—´ä¸­çš„ä½ç»´æµå½¢ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç»´åº¦æ°å¥½ä¸ºä½ç»´æµå½¢ç‹¬ç«‹ç»´åº¦çš„ç“¶é¢ˆå±‚æ¥å¼ºè¿«æ¨¡å‹å­¦ä¹ ä¸€ä¸ªæœ‰æ•ˆçš„æ•°æ®å‹ç¼©å’Œæ¢å¤ï¼Œæ˜¯å¦æ°å¥½å¯ä»¥æå–å‡ºæ•°æ®æœ€æ ¹æœ¬çš„å†…åœ¨ç»“æ„ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¾ç„¶æœ‰å¾ˆå¤šç¼ºé™·ï¼Œä¾‹å¦‚æ¨¡å‹å­¦ä¹ åˆ°çš„ latent space ä¸å…·æœ‰è¿ç»­æ€§ï¼Œæ— æ³•ç›´æ¥æ’å€¼ï¼ˆè¿™ä¸ªé—®é¢˜è¢« VAE è§£å†³äº†ï¼‰ï¼Œæ¨¡å‹å¾ˆå®¹æ˜“å­¦åˆ°ä¸€ä¸ªæ’ç­‰æ˜ å°„ç­‰ç­‰ã€‚
ä¸ºäº†è§£å†³æ’ç­‰æ˜ å°„è¿™ä¸ªé—®é¢˜ï¼ŒDAE çš„æ€è·¯æ˜¯ï¼šå¦‚æœç®€å•çš„è¦æ±‚æ¨¡å‹è‡ªå·±é€šè¿‡ ç¼–ç -è§£ç  çš„æ–¹å¼ç ´åé‡å»ºæ•°æ®æ— æ³•ä¿è¯æ¨¡å‹å­¦åˆ°å¯é çš„ç‰¹å¾ï¼Œé‚£ä¹ˆä½•ä¸æˆ‘æ¥ç ´åå‘¢ï¼Ÿæˆ‘ä»¬ç›´æ¥ç»™æ•°æ®æ·»åŠ å™ªå£°ï¼Œå°†å¸¦æœ‰å™ªå£°çš„æ•°æ®è¾“å…¥ç¼–ç å™¨ï¼Œè®©æ¨¡å‹æ¢å¤å‡ºæ²¡æœ‰å™ªå£°çš„ï¼Œæºåˆçš„æ•°æ®ã€‚
å½¢å¼åŒ–çš„è®²ï¼Œå¯¹äºæ•°æ® $x$ï¼Œæˆ‘ä»¬æ·»åŠ æœä»é«˜æ–¯åˆ†å¸ƒçš„å™ªå£° $\epsilon \sim \mathcal N(x\mid 0, \sigma^2I)$ï¼Œæœ‰è¢«æ±¡æŸ“çš„æ•°æ®ï¼š
$$
\tilde{x} = x + \epsilon
$$é‚£ä¹ˆï¼ŒæŸå¤±å¯ä»¥å†™ä½œï¼š
$$
J_{DATA}(\theta) = \mathbb{E}\left(\left\|
\text{Decoder}(\text{Encoder} (x + \epsilon)) - x
\right\|^2\right)
$$1.2. Score Matching
æˆ‘ä»¬ä¹‹å‰åœ¨ Score Matching ä¸­è®¨è®ºè¿‡ Score Matching çš„åŸºæœ¬åŸç†ã€‚è¿™é‡Œç®€å•å›é¡¾ä¸€ä¸‹ã€‚Score Matching æœ€æ ¸å¿ƒçš„åˆ›æ–°æ˜¯å­¦ä¹ åˆ†å¸ƒçš„ Score Functionï¼Œè€Œä¸æ˜¯ç›´æ¥å­¦ä¹ åˆ†å¸ƒæœ¬èº«ã€‚å­¦ä¹  Score Function æœ€æ ¸å¿ƒçš„ä¼˜åŠ¿æ˜¯ï¼Œæˆ‘ä»¬å¯¹ Score Function çš„å½¢å¼æ²¡æœ‰ä»»ä½•è¦æ±‚ï¼Œå¯ä»¥ç”¨ä»»æ„ä¸€ä¸ªç¥ç»ç½‘ç»œæ‹Ÿåˆï¼Œä»æœ¬è´¨ä¸Šè§£å†³äº†å½’ä¸€åŒ–ç³»æ•°çš„é—®é¢˜ã€‚å¸Œæœ›å­¦ä¹ åˆ°åˆ†å¸ƒçš„ Score Function æœ€ç›´æ¥çš„æ–¹å¼ï¼Œå³ä½¿ç›´æ¥ä½¿ç”¨ Fisher Divergenceã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://wangjv0812.cn/posts/"},{"@type":"ListItem","position":2,"name":"Denoising Score Matching","item":"https://wangjv0812.cn/2025/10/denoising-score-matching/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Denoising Score Matching","name":"Denoising Score Matching","description":"1. åŠ¨æœº ä»¥æ•°æ®ç”Ÿæˆä¸ºä»£è¡¨çš„è‡ªç›‘ç£å­¦ä¹ å¾€å¾€å¸Œæœ›è®¾è®¡å‡ºä¸€ç§ç‹¬ç‰¹ä¸”æœ‰æ•ˆçš„æœºåˆ¶ï¼Œé€šè¿‡ç½‘ç»œç»“æ„å’Œè®­ç»ƒæ–¹æ³•çš„è®¾è®¡ï¼Œè¿«ä½¿æ¨¡å‹æ‰¾åˆ°ä»£è¡¨ä¸€ä¸ªæ•°æ®æœ€æ ¸å¿ƒå’Œå…³é”®çš„ä¿¡æ¯æˆ–è€…è¯´ç‰¹å¾ï¼Œæˆ–è€…å¸Œæœ›è®©æ¨¡å‹è‡ªå·±æ€»ç»“å‡ºæ•°æ®çš„å†…åœ¨ç»“æ„ã€‚æˆ–è€…ç”¨ä¸€ä¸ªæ›´æ¦‚ç‡çš„è¡¨è¾¾ï¼Œå°±åƒæ˜¯ä¹‹å‰æˆ‘ä»¬åœ¨ NCE ä¸­å¯¹äºæ•°æ®æµå½¢ è®¨è®ºè¿‡çš„ã€‚æ•°æ®æ˜¯ä¸€ä¸ªéšè—åœ¨é«˜ç»´ç©ºé—´ä¸­çš„ä½ç»´æµå½¢ï¼Œè€Œæ¦‚ç‡åˆ†å¸ƒæ°å¥½ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„æè¿°æµå½¢çš„æ•°å­¦å·¥å…·ã€‚\næˆ‘ä»¬å‡è®¾çœŸå®æ•°æ®æœ‰æ¦‚ç‡åˆ†å¸ƒ $p(x)$ï¼Œè€Œæˆ‘ä»¬å¸Œæœ›å¯»æ‰¾ä¸€ä¸ªæ”¶åˆ°å‚æ•° $\\theta$ æ§åˆ¶çš„æ¦‚ç‡åˆ†å¸ƒ $q(x\\mid \\theta)$ï¼Œå°½å¯èƒ½çš„æ¥è¿‘çœŸå®åˆ†å¸ƒã€‚ç”Ÿæˆæ¨¡å‹å­¦ä¹ äº‹å®ä¸Šå¸Œæœ›è§£å†³ä¸¤ä¸ªå®è´¨æ€§çš„é—®é¢˜ï¼š\næˆ‘ä»¬ä¸çŸ¥é“çœŸå®åˆ†å¸ƒ $p(x)$ï¼Œåªæœ‰å¯¹äº $p(x)$ çš„ä¸€ç³»åˆ—é‡‡æ · $\\{x_1, x_2, \\cdots x_n\\}$ï¼ˆå°±æ˜¯æˆ‘ä»¬çš„æ•°æ®é›†ï¼‰ï¼Œå¦‚ä½•åˆ©ç”¨è¿™äº›é‡‡æ ·å°½å¯èƒ½å¥½çš„æ‰¾åˆ°ä¸€ç»„å‚æ•° $\\theta$ï¼Œä½¿å¾— $q(x\\mid \\theta)$ å°½å¯èƒ½æ¥è¿‘ $p(x)$ã€‚ å¯¹äºä¸€ä¸ªå®Œæˆå­¦ä¹ çš„åˆ†å¸ƒ $p(x\\mid \\theta)$ï¼Œå¦‚ä½•å¯¹å…¶é‡‡æ ·ï¼Œè·å¾—ä¸€ç»„æ–°çš„æ•°æ®ã€‚è¿›ä¸€æ­¥å°†ï¼Œå¦‚ä½•è®©é‡‡æ ·æ»¡è¶³ä¸€å®šçš„æ¡ä»¶ã€‚ è¿™ä¸¤ä¸ªé—®é¢˜çœ‹è¯´æ¥å®¹æ˜“ï¼Œä½†åšèµ·æ¥å´ä½•å…¶éš¾ã€‚ä»æ¬¡å¼•å‡ºäº†å·¨é‡çš„é—®é¢˜ï¼Œä¾‹å¦‚å¦‚ä½•è§„é¿åˆ†å¸ƒçš„å½’ä¸€åŒ–ç³»æ•°ã€å¦‚ä½•é¿å…å­¦ä¹ ä¸€ä¸ªæ’ç­‰æ˜ å°„ï¼ˆä¾‹å¦‚ AutoEncoderï¼‰ã€å¦‚ä½•é¿å…åªå­¦åˆ°ä¸€ä¸ªå¾ˆçª„çš„åˆ†å¸ƒï¼ˆSMï¼‰ç­‰ç­‰ã€‚å½’ä¸€åŒ–ç³»æ•°æˆ‘ä»¬ä¹‹å‰åœ¨ Score Matching ä¸­è®¨è®ºè¿‡ã€‚ä¸ºäº† DSM å™è¿°çš„è¿è´¯æ€§ï¼Œæˆ‘ä»¬ä¸å¦¨å…ˆä» Autoencoder çš„ç¼ºé™·å’Œæ”¹è¿›èŠèµ·ã€‚\n1.1. Denoising AutoEncoder AutoEncoder æ˜¯ä¸€ä¸ªéå¸¸ç›´è§‰çš„æ— ç›‘ç£å­¦ä¹ æ–¹æ³•ã€‚å®ƒåŸºäºä¸€ä¸ªå¾ˆç›´è§‰çš„è®¤è¯†ï¼šæ— ç›‘ç£å­¦ä¹ å¸Œæœ›å­¦ä¹ ä¸€æ¡åˆ†å¸ƒåœ¨é«˜ç»´ç©ºé—´ä¸­çš„ä½ç»´æµå½¢ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç»´åº¦æ°å¥½ä¸ºä½ç»´æµå½¢ç‹¬ç«‹ç»´åº¦çš„ç“¶é¢ˆå±‚æ¥å¼ºè¿«æ¨¡å‹å­¦ä¹ ä¸€ä¸ªæœ‰æ•ˆçš„æ•°æ®å‹ç¼©å’Œæ¢å¤ï¼Œæ˜¯å¦æ°å¥½å¯ä»¥æå–å‡ºæ•°æ®æœ€æ ¹æœ¬çš„å†…åœ¨ç»“æ„ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¾ç„¶æœ‰å¾ˆå¤šç¼ºé™·ï¼Œä¾‹å¦‚æ¨¡å‹å­¦ä¹ åˆ°çš„ latent space ä¸å…·æœ‰è¿ç»­æ€§ï¼Œæ— æ³•ç›´æ¥æ’å€¼ï¼ˆè¿™ä¸ªé—®é¢˜è¢« VAE è§£å†³äº†ï¼‰ï¼Œæ¨¡å‹å¾ˆå®¹æ˜“å­¦åˆ°ä¸€ä¸ªæ’ç­‰æ˜ å°„ç­‰ç­‰ã€‚\nä¸ºäº†è§£å†³æ’ç­‰æ˜ å°„è¿™ä¸ªé—®é¢˜ï¼ŒDAE çš„æ€è·¯æ˜¯ï¼šå¦‚æœç®€å•çš„è¦æ±‚æ¨¡å‹è‡ªå·±é€šè¿‡ ç¼–ç -è§£ç  çš„æ–¹å¼ç ´åé‡å»ºæ•°æ®æ— æ³•ä¿è¯æ¨¡å‹å­¦åˆ°å¯é çš„ç‰¹å¾ï¼Œé‚£ä¹ˆä½•ä¸æˆ‘æ¥ç ´åå‘¢ï¼Ÿæˆ‘ä»¬ç›´æ¥ç»™æ•°æ®æ·»åŠ å™ªå£°ï¼Œå°†å¸¦æœ‰å™ªå£°çš„æ•°æ®è¾“å…¥ç¼–ç å™¨ï¼Œè®©æ¨¡å‹æ¢å¤å‡ºæ²¡æœ‰å™ªå£°çš„ï¼Œæºåˆçš„æ•°æ®ã€‚\nå½¢å¼åŒ–çš„è®²ï¼Œå¯¹äºæ•°æ® $x$ï¼Œæˆ‘ä»¬æ·»åŠ æœä»é«˜æ–¯åˆ†å¸ƒçš„å™ªå£° $\\epsilon \\sim \\mathcal N(x\\mid 0, \\sigma^2I)$ï¼Œæœ‰è¢«æ±¡æŸ“çš„æ•°æ®ï¼š\n$$ \\tilde{x} = x + \\epsilon $$é‚£ä¹ˆï¼ŒæŸå¤±å¯ä»¥å†™ä½œï¼š\n$$ J_{DATA}(\\theta) = \\mathbb{E}\\left(\\left\\| \\text{Decoder}(\\text{Encoder} (x + \\epsilon)) - x \\right\\|^2\\right) $$1.2. Score Matching æˆ‘ä»¬ä¹‹å‰åœ¨ Score Matching ä¸­è®¨è®ºè¿‡ Score Matching çš„åŸºæœ¬åŸç†ã€‚è¿™é‡Œç®€å•å›é¡¾ä¸€ä¸‹ã€‚Score Matching æœ€æ ¸å¿ƒçš„åˆ›æ–°æ˜¯å­¦ä¹ åˆ†å¸ƒçš„ Score Functionï¼Œè€Œä¸æ˜¯ç›´æ¥å­¦ä¹ åˆ†å¸ƒæœ¬èº«ã€‚å­¦ä¹  Score Function æœ€æ ¸å¿ƒçš„ä¼˜åŠ¿æ˜¯ï¼Œæˆ‘ä»¬å¯¹ Score Function çš„å½¢å¼æ²¡æœ‰ä»»ä½•è¦æ±‚ï¼Œå¯ä»¥ç”¨ä»»æ„ä¸€ä¸ªç¥ç»ç½‘ç»œæ‹Ÿåˆï¼Œä»æœ¬è´¨ä¸Šè§£å†³äº†å½’ä¸€åŒ–ç³»æ•°çš„é—®é¢˜ã€‚å¸Œæœ›å­¦ä¹ åˆ°åˆ†å¸ƒçš„ Score Function æœ€ç›´æ¥çš„æ–¹å¼ï¼Œå³ä½¿ç›´æ¥ä½¿ç”¨ Fisher Divergenceã€‚\n","keywords":["ç¥ç»ç½‘ç»œ","ç”Ÿæˆæ¨¡å‹","Denoising Score Matching","diffusion","æ— ç›‘ç£å­¦ä¹ "],"articleBody":"1. åŠ¨æœº ä»¥æ•°æ®ç”Ÿæˆä¸ºä»£è¡¨çš„è‡ªç›‘ç£å­¦ä¹ å¾€å¾€å¸Œæœ›è®¾è®¡å‡ºä¸€ç§ç‹¬ç‰¹ä¸”æœ‰æ•ˆçš„æœºåˆ¶ï¼Œé€šè¿‡ç½‘ç»œç»“æ„å’Œè®­ç»ƒæ–¹æ³•çš„è®¾è®¡ï¼Œè¿«ä½¿æ¨¡å‹æ‰¾åˆ°ä»£è¡¨ä¸€ä¸ªæ•°æ®æœ€æ ¸å¿ƒå’Œå…³é”®çš„ä¿¡æ¯æˆ–è€…è¯´ç‰¹å¾ï¼Œæˆ–è€…å¸Œæœ›è®©æ¨¡å‹è‡ªå·±æ€»ç»“å‡ºæ•°æ®çš„å†…åœ¨ç»“æ„ã€‚æˆ–è€…ç”¨ä¸€ä¸ªæ›´æ¦‚ç‡çš„è¡¨è¾¾ï¼Œå°±åƒæ˜¯ä¹‹å‰æˆ‘ä»¬åœ¨ NCE ä¸­å¯¹äºæ•°æ®æµå½¢ è®¨è®ºè¿‡çš„ã€‚æ•°æ®æ˜¯ä¸€ä¸ªéšè—åœ¨é«˜ç»´ç©ºé—´ä¸­çš„ä½ç»´æµå½¢ï¼Œè€Œæ¦‚ç‡åˆ†å¸ƒæ°å¥½ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„æè¿°æµå½¢çš„æ•°å­¦å·¥å…·ã€‚\næˆ‘ä»¬å‡è®¾çœŸå®æ•°æ®æœ‰æ¦‚ç‡åˆ†å¸ƒ $p(x)$ï¼Œè€Œæˆ‘ä»¬å¸Œæœ›å¯»æ‰¾ä¸€ä¸ªæ”¶åˆ°å‚æ•° $\\theta$ æ§åˆ¶çš„æ¦‚ç‡åˆ†å¸ƒ $q(x\\mid \\theta)$ï¼Œå°½å¯èƒ½çš„æ¥è¿‘çœŸå®åˆ†å¸ƒã€‚ç”Ÿæˆæ¨¡å‹å­¦ä¹ äº‹å®ä¸Šå¸Œæœ›è§£å†³ä¸¤ä¸ªå®è´¨æ€§çš„é—®é¢˜ï¼š\næˆ‘ä»¬ä¸çŸ¥é“çœŸå®åˆ†å¸ƒ $p(x)$ï¼Œåªæœ‰å¯¹äº $p(x)$ çš„ä¸€ç³»åˆ—é‡‡æ · $\\{x_1, x_2, \\cdots x_n\\}$ï¼ˆå°±æ˜¯æˆ‘ä»¬çš„æ•°æ®é›†ï¼‰ï¼Œå¦‚ä½•åˆ©ç”¨è¿™äº›é‡‡æ ·å°½å¯èƒ½å¥½çš„æ‰¾åˆ°ä¸€ç»„å‚æ•° $\\theta$ï¼Œä½¿å¾— $q(x\\mid \\theta)$ å°½å¯èƒ½æ¥è¿‘ $p(x)$ã€‚ å¯¹äºä¸€ä¸ªå®Œæˆå­¦ä¹ çš„åˆ†å¸ƒ $p(x\\mid \\theta)$ï¼Œå¦‚ä½•å¯¹å…¶é‡‡æ ·ï¼Œè·å¾—ä¸€ç»„æ–°çš„æ•°æ®ã€‚è¿›ä¸€æ­¥å°†ï¼Œå¦‚ä½•è®©é‡‡æ ·æ»¡è¶³ä¸€å®šçš„æ¡ä»¶ã€‚ è¿™ä¸¤ä¸ªé—®é¢˜çœ‹è¯´æ¥å®¹æ˜“ï¼Œä½†åšèµ·æ¥å´ä½•å…¶éš¾ã€‚ä»æ¬¡å¼•å‡ºäº†å·¨é‡çš„é—®é¢˜ï¼Œä¾‹å¦‚å¦‚ä½•è§„é¿åˆ†å¸ƒçš„å½’ä¸€åŒ–ç³»æ•°ã€å¦‚ä½•é¿å…å­¦ä¹ ä¸€ä¸ªæ’ç­‰æ˜ å°„ï¼ˆä¾‹å¦‚ AutoEncoderï¼‰ã€å¦‚ä½•é¿å…åªå­¦åˆ°ä¸€ä¸ªå¾ˆçª„çš„åˆ†å¸ƒï¼ˆSMï¼‰ç­‰ç­‰ã€‚å½’ä¸€åŒ–ç³»æ•°æˆ‘ä»¬ä¹‹å‰åœ¨ Score Matching ä¸­è®¨è®ºè¿‡ã€‚ä¸ºäº† DSM å™è¿°çš„è¿è´¯æ€§ï¼Œæˆ‘ä»¬ä¸å¦¨å…ˆä» Autoencoder çš„ç¼ºé™·å’Œæ”¹è¿›èŠèµ·ã€‚\n1.1. Denoising AutoEncoder AutoEncoder æ˜¯ä¸€ä¸ªéå¸¸ç›´è§‰çš„æ— ç›‘ç£å­¦ä¹ æ–¹æ³•ã€‚å®ƒåŸºäºä¸€ä¸ªå¾ˆç›´è§‰çš„è®¤è¯†ï¼šæ— ç›‘ç£å­¦ä¹ å¸Œæœ›å­¦ä¹ ä¸€æ¡åˆ†å¸ƒåœ¨é«˜ç»´ç©ºé—´ä¸­çš„ä½ç»´æµå½¢ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç»´åº¦æ°å¥½ä¸ºä½ç»´æµå½¢ç‹¬ç«‹ç»´åº¦çš„ç“¶é¢ˆå±‚æ¥å¼ºè¿«æ¨¡å‹å­¦ä¹ ä¸€ä¸ªæœ‰æ•ˆçš„æ•°æ®å‹ç¼©å’Œæ¢å¤ï¼Œæ˜¯å¦æ°å¥½å¯ä»¥æå–å‡ºæ•°æ®æœ€æ ¹æœ¬çš„å†…åœ¨ç»“æ„ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¾ç„¶æœ‰å¾ˆå¤šç¼ºé™·ï¼Œä¾‹å¦‚æ¨¡å‹å­¦ä¹ åˆ°çš„ latent space ä¸å…·æœ‰è¿ç»­æ€§ï¼Œæ— æ³•ç›´æ¥æ’å€¼ï¼ˆè¿™ä¸ªé—®é¢˜è¢« VAE è§£å†³äº†ï¼‰ï¼Œæ¨¡å‹å¾ˆå®¹æ˜“å­¦åˆ°ä¸€ä¸ªæ’ç­‰æ˜ å°„ç­‰ç­‰ã€‚\nä¸ºäº†è§£å†³æ’ç­‰æ˜ å°„è¿™ä¸ªé—®é¢˜ï¼ŒDAE çš„æ€è·¯æ˜¯ï¼šå¦‚æœç®€å•çš„è¦æ±‚æ¨¡å‹è‡ªå·±é€šè¿‡ ç¼–ç -è§£ç  çš„æ–¹å¼ç ´åé‡å»ºæ•°æ®æ— æ³•ä¿è¯æ¨¡å‹å­¦åˆ°å¯é çš„ç‰¹å¾ï¼Œé‚£ä¹ˆä½•ä¸æˆ‘æ¥ç ´åå‘¢ï¼Ÿæˆ‘ä»¬ç›´æ¥ç»™æ•°æ®æ·»åŠ å™ªå£°ï¼Œå°†å¸¦æœ‰å™ªå£°çš„æ•°æ®è¾“å…¥ç¼–ç å™¨ï¼Œè®©æ¨¡å‹æ¢å¤å‡ºæ²¡æœ‰å™ªå£°çš„ï¼Œæºåˆçš„æ•°æ®ã€‚\nå½¢å¼åŒ–çš„è®²ï¼Œå¯¹äºæ•°æ® $x$ï¼Œæˆ‘ä»¬æ·»åŠ æœä»é«˜æ–¯åˆ†å¸ƒçš„å™ªå£° $\\epsilon \\sim \\mathcal N(x\\mid 0, \\sigma^2I)$ï¼Œæœ‰è¢«æ±¡æŸ“çš„æ•°æ®ï¼š\n$$ \\tilde{x} = x + \\epsilon $$é‚£ä¹ˆï¼ŒæŸå¤±å¯ä»¥å†™ä½œï¼š\n$$ J_{DATA}(\\theta) = \\mathbb{E}\\left(\\left\\| \\text{Decoder}(\\text{Encoder} (x + \\epsilon)) - x \\right\\|^2\\right) $$1.2. Score Matching æˆ‘ä»¬ä¹‹å‰åœ¨ Score Matching ä¸­è®¨è®ºè¿‡ Score Matching çš„åŸºæœ¬åŸç†ã€‚è¿™é‡Œç®€å•å›é¡¾ä¸€ä¸‹ã€‚Score Matching æœ€æ ¸å¿ƒçš„åˆ›æ–°æ˜¯å­¦ä¹ åˆ†å¸ƒçš„ Score Functionï¼Œè€Œä¸æ˜¯ç›´æ¥å­¦ä¹ åˆ†å¸ƒæœ¬èº«ã€‚å­¦ä¹  Score Function æœ€æ ¸å¿ƒçš„ä¼˜åŠ¿æ˜¯ï¼Œæˆ‘ä»¬å¯¹ Score Function çš„å½¢å¼æ²¡æœ‰ä»»ä½•è¦æ±‚ï¼Œå¯ä»¥ç”¨ä»»æ„ä¸€ä¸ªç¥ç»ç½‘ç»œæ‹Ÿåˆï¼Œä»æœ¬è´¨ä¸Šè§£å†³äº†å½’ä¸€åŒ–ç³»æ•°çš„é—®é¢˜ã€‚å¸Œæœ›å­¦ä¹ åˆ°åˆ†å¸ƒçš„ Score Function æœ€ç›´æ¥çš„æ–¹å¼ï¼Œå³ä½¿ç›´æ¥ä½¿ç”¨ Fisher Divergenceã€‚\n$$ J_{\\text{ESM}}(\\theta) = \\frac{1}{2} \\mathbb{E}_{x\\sim p(x)}\\left(\\left\\| \\nabla_x \\log p(x) - \\nabla_x \\log q(x\\mid \\theta) \\right\\|^2\\right) $$ä½†æ˜¯é—®é¢˜åœ¨äºï¼Œæˆ‘ä»¬ä¸çŸ¥é“çœŸå®åˆ†å¸ƒçš„è§£æå½¢å¼ï¼Œæœ‰çš„åªæ˜¯å¯¹çœŸå®åˆ†å¸ƒçš„é‡‡æ ·ï¼Œæ²¡æ³•è®¡ç®— Fisher Divergenceã€‚Divergenceã€‚HyvÃ¤rinen ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¯æ˜äº†åœ¨æ¸©å’Œçš„æ¡ä»¶ä¸‹ï¼ŒFisher Divergence å¯ä»¥ç­‰ä»·è½¬æ¢ä¸ºï¼š\n$$ J_{\\text{ISM}}(\\theta) = \\mathbb{E}_{x\\sim p(x)}\\left(\\Delta_x \\log q(x\\mid \\theta) + \\frac{1}{2}\\left\\| \\nabla_x \\log q(x\\mid \\theta) \\right\\|^2\\right) $$åœ¨å¯¹çœŸå®åˆ†å¸ƒ $p(x)$ æœ‰é™çš„é‡‡æ · $\\{x_1, x_2, \\cdots x_n\\}$ï¼Œä¸Šé¢çš„çš„æœŸæœ›å¯ä»¥é€šè¿‡æœ‰é™é‡‡æ ·çš„å‡å€¼æ¥è¿‘ä¼¼ï¼š\n$$ J_{ISM}(\\theta) \\approx \\frac{1}{n} \\sum_{i=1}^n \\left(\\Delta_x \\log q(x_i\\mid \\theta) + \\frac{1}{2}\\left\\| \\nabla_x \\log q(x_i\\mid \\theta) \\right\\|^2\\right) $$å°† Score Function è®°ä½œ $\\psi(x, \\theta) = \\nabla_x \\log q(x\\mid \\theta)$ï¼Œä¸Šé¢çš„å½¢å¼å¯ä»¥å†™ä½œï¼š\n$$ J_{ISM}(\\theta) \\approx \\frac{1}{n} \\sum_{t=1}^n \\left( \\sum_{i=0}^d \\frac{\\partial \\psi(x^t, \\theta)}{\\partial x_i} + \\frac{1}{2}\\left\\| \\psi(x^t, \\theta) \\right\\|^2\\right) $$åœ¨è®¡ç®—ä¸Šï¼Œ$\\frac{\\partial \\psi(x^t, \\theta)}{\\partial x_i}$ å³ä¸å…·å¤‡æ•°å€¼ç¨³å®šæ€§ï¼Œä¹Ÿä¸å…·å¤‡è®¡ç®—æ•ˆç‡ã€‚ä¸ºäº†è§£å†³ç¨³å®šé—®é¢˜ï¼ŒLeCun æå‡ºåœ¨ ISM çš„åŸºç¡€ä¸Šæ·»åŠ ä¸€ä¸ªå…³äºè¿™ä¸€é¡¹çš„æ­£åˆ™åŒ–é¡¹ï¼š\n$$ J_{ISMreq}(\\theta) = J_{ISM}(\\theta) + \\lambda \\sum_{i=1}^d \\left(\\frac{\\partial \\psi(x, \\theta)}{\\partial x_i}\\right)^2 $$æ˜¾ç„¶ï¼Œæ·»åŠ æ­£åˆ™åŒ–åï¼Œå¯ä»¥æœ‰æ•ˆçš„è®© score function åœ¨å‡ ä½•ä¸Šæ›´åŠ  â€œå¹³ç¼“â€ï¼Œé¿å…å­¦ä¹ åˆ°å¾ˆæç«¯å’Œå´å²–çš„ score functionï¼Œä»è€Œæå‡æ•°å€¼ç¨³å®šæ€§ã€‚\n2. DSM å’Œ DAE ä¹‹é—´çš„è”ç³» 2.1. DSMï¼ˆDenoising Score Matchingï¼‰ å¯¹äºé€šè¿‡ä¸€ç³»åˆ—é‡‡æ ·æè¿°çš„æ•°æ® $\\{x_1, x_2, \\cdots, x_n\\}$ï¼Œæˆ‘ä»¬ä¸å¦¨ç”¨ Parzen Windows Density Estimation æ¥å¯¹æ•°æ®åˆ†å¸ƒè¿›è¡Œå¹³æ»‘ï¼Œç»™æ•°æ®ä¸€ä¸ªä¾¿äºåˆ†æçš„è§£æå½¢å¼ã€‚å…³äº Parzen Density Estimator çš„å†…å®¹å¯ä»¥å‚è€ƒ Appendix Aã€‚\nä¸å¦¨é€‰æ‹©å—å¸¦å®½å‚æ•° $\\sigma$ æ§åˆ¶çš„é«˜æ–¯å‡½æ•°ä½œä¸ºæ ¸å‡½æ•°ï¼š\n$$ q_\\sigma(\\tilde{x} \\mid x) = \\frac{1}{(\\sigma \\sqrt{2\\pi})^d} \\exp\\left(-\\frac{\\|\\tilde{x} - x\\|^2}{2\\sigma^2}\\right) $$ç»è¿‡ Parzen Density Estimator é‡å»ºçš„æ•°æ®åˆ†å¸ƒä¸ºï¼š\n$$ q_\\sigma(\\tilde{x}) = \\frac{1}{n} \\sum_{i=1}^n q_\\sigma(\\tilde{x} \\mid x_i) $$é‚£ä¹ˆï¼ŒParzen Density Estimation é‡å»ºåè¿›è¡Œçš„æ˜¾å¼åˆ†æ•°åŒ¹é…ç›®æ ‡å‡½æ•°ä¸ºï¼š\n$$ J_{ESM_{\\sigma}}(\\theta) = \\mathbb{E}_{q_{\\sigma}(\\tilde{x})}\\left[ \\frac{1}{2} \\left\\| \\psi(\\tilde{x}; \\theta) - \\frac{\\partial \\log q_{\\sigma}(\\tilde{x})}{\\partial \\tilde{x}} \\right\\|^2 \\right] $$é˜…è¯» Appendix A å¯ä»¥å‘ç°ï¼ŒParzen Density Estimation äº‹å®ä¸Šæ˜¯å¯¹æ•°æ®æ·»åŠ äº†é«˜æ–¯å™ªå£°ã€‚å¯¹äºä¸Šé¢çš„å½¢å¼ï¼Œæˆ‘ä»¬ä¸å¦¨å±•å¼€ï¼Œçœ‹çœ‹é«˜æ–¯å™ªå£°å¯¹æ•°æ®çš„æ±¡æŸ“å¯¹ Score Function å­¦ä¹ äº§ç”Ÿäº†ä»€ä¹ˆå½±å“ï¼Ÿ\n2.2. DSM Loss ç­‰ä»·æ€§è¯æ˜ å¯¹äº $J_{ESM_{\\sigma}}(\\theta)$ï¼Œä¸å¦¨å°†äºŒèŒƒæ•°çš„å½¢å¼å±•å¼€ï¼š\n$$ \\begin{aligned} J_{ESM_{\\sigma}}(\\theta) \u0026= \\mathbb{E}_{q_{\\sigma}(\\tilde{x})}\\left[ \\frac{1}{2} \\left\\| \\psi(\\tilde{x}; \\theta) - \\frac{\\partial \\log q_{\\sigma}(\\tilde{x})}{\\partial \\tilde{x}} \\right\\|^2 \\right] \\\\ \u0026= \\mathbb{E}_{q_{\\sigma}(\\tilde{x})}\\left[ \\frac{1}{2} \\left( \\left\\| \\psi(\\tilde{x}; \\theta) \\right\\|^2 - 2\\left \\langle \\psi(\\tilde{x}; \\theta), \\frac{\\partial \\log q_{\\sigma}(\\tilde{x})}{\\partial \\tilde{x}} \\right \\rangle + \\left\\| \\frac{\\partial \\log q_{\\sigma}(\\tilde{x})}{\\partial \\tilde{x}} \\right\\|^2 \\right) \\right] \\\\ \u0026= \\frac 1 2 \\mathbb{E}_{q_{\\sigma}(\\tilde{x})}\\left[ \\left\\| \\psi(\\tilde{x}; \\theta) \\right\\|^2\\right] - \\mathbb{E}_{q_{\\sigma}(\\tilde{x})}\\left[ \\left\\langle \\psi(\\tilde{x}; \\theta), \\frac{\\partial \\log q_{\\sigma}(\\tilde{x})}{\\partial \\tilde{x}} \\right \\rangle\\right] + \\frac 1 2 \\mathbb{E}_{q_{\\sigma}(\\tilde{x})}\\left[\\left\\| \\frac{\\partial \\log q_{\\sigma}(\\tilde{x})}{\\partial \\tilde{x}} \\right\\|^2 \\right] \\end{aligned} $$æ˜¾ç„¶ï¼Œå…¶ä¸­ $\\frac 1 2 \\mathbb{E}_{q_{\\sigma}(\\tilde{x})}\\left[\\left\\| \\frac{\\partial \\log q_{\\sigma}(\\tilde{x})}{\\partial \\tilde{x}} \\right\\|^2 \\right]$ ä¸å¾…ä¼˜åŒ–å‚æ•° $\\theta$ æ— å…³ï¼Œå¯ä»¥å¿½ç•¥ã€‚ç¬¬ä¸€é¡¹åªåŒ…å«æ¨¡å‹ï¼Œå¯ä»¥ç›´æ¥ä¿ç•™ã€‚å…³é”®åœ¨äºç¬¬äºŒé¡¹ï¼Œä¸å¦¨å°†å…¶æ ‡æ³¨ä¸º $S(\\theta)$ã€‚\n$$ \\begin{aligned} S(\\theta) \u0026= \\mathbb{E}_{q_{\\sigma}(\\tilde{x})}\\left[ \\left\\langle \\psi(\\tilde{x}; \\theta), \\frac{\\partial \\log q_{\\sigma}(\\tilde{x})}{\\partial \\tilde{x}} \\right \\rangle\\right]\\\\ \u0026= \\int q_{\\sigma}(\\tilde{x}) \\left\\langle \\psi(\\tilde{x}; \\theta), \\frac{\\partial \\log q_{\\sigma}(\\tilde{x})}{\\partial \\tilde{x}} \\right \\rangle d\\tilde{x}\\\\ \\end{aligned} $$ç”±æ±‚å¯¼æ³•åˆ™ $\\frac{\\partial }{\\partial \\tilde x} \\log q_\\sigma(\\tilde x) = \\frac{1}{q_\\sigma(\\tilde x)} \\frac{\\partial}{\\partial \\tilde x}q_\\sigma(\\tilde x)$ å¯çŸ¥ï¼š\n$$ \\begin{aligned} S(\\theta) \u0026= \\int q_{\\sigma}(\\tilde{x}) \\left\\langle \\psi(\\tilde{x}; \\theta), \\frac{\\partial \\log q_{\\sigma}(\\tilde{x})}{\\partial \\tilde{x}} \\right \\rangle d\\tilde{x}\\\\ \u0026= \\int \\left\\langle \\psi(\\tilde{x}; \\theta), \\frac{\\partial}{\\partial \\tilde x}q_\\sigma(\\tilde x) \\right \\rangle d\\tilde{x}\\\\ \\end{aligned} $$å°† Parzen Density Estimation çš„è¾¹ç¼˜åˆ†å¸ƒå½¢å¼å¸¦å…¥ï¼Œå¹¶æ ¹æ®è±å¸ƒå°¼èŒ¨å®šç†äº¤æ¢é¡ºåºï¼š\n$$ \\begin{aligned} S(\\theta) \u0026= \\int_{\\tilde x} \\left\\langle \\psi(\\tilde{x}; \\theta), \\frac{\\partial}{\\partial \\tilde x}q_\\sigma(\\tilde x) \\right \\rangle d\\tilde{x}\\\\ \u0026= \\int_{\\tilde x} \\left\\langle \\psi(\\tilde{x}; \\theta), \\frac{\\partial}{\\partial \\tilde x}\\int_x p(\\tilde x \\mid x) q(x) dx \\right \\rangle d\\tilde{x}\\\\ \u0026= \\int_{\\tilde x} \\left\\langle \\psi(\\tilde{x}; \\theta), \\int_x q(x) \\frac{\\partial}{\\partial \\tilde x} p(\\tilde x \\mid x) dx \\right \\rangle d\\tilde{x}\\\\ \\end{aligned} $$ä¸å¦¨å±•å¼€å†…ç§¯ç¬¦å·ï¼Œæœ‰ï¼š\n$$ \\begin{aligned} S(\\theta) \u0026= \\int_{\\tilde x} \\left\\langle \\psi(\\tilde{x}; \\theta), \\int_x q(x) \\frac{\\partial}{\\partial \\tilde x} p(\\tilde x \\mid x) dx \\right \\rangle d\\tilde{x}\\\\ \u0026= \\int_{\\tilde x} \\sum_{i=1}^d \\psi^{\\top}_i(\\tilde{x}; \\theta) \\int_x q(x) \\frac{\\partial}{\\partial \\tilde x} p(\\tilde x \\mid x) dx \\bigg |_i d\\tilde x\\\\ \u0026= \\int_{\\tilde x} \\sum_{i=1}^d \\int_x \\psi^{\\top}_i(\\tilde{x}; \\theta) q(x) \\frac{\\partial}{\\partial \\tilde x} p(\\tilde x \\mid x) dx \\bigg |_i d\\tilde x\\\\ \u0026= \\int_{\\tilde x} \\int_x \\sum_{i=1}^d \\psi^{\\top}_i(\\tilde{x}; \\theta) q(x) \\frac{\\partial}{\\partial \\tilde x} p(\\tilde x \\mid x) dx \\bigg |_i d\\tilde x\\\\ \u0026= \\int_{\\tilde x} \\int_x \\left\\langle \\psi(\\tilde{x}; \\theta), q(x) \\frac{\\partial}{\\partial \\tilde x} p(\\tilde x \\mid x) \\right \\rangle dx \\ d\\tilde x\\\\ \u0026= \\int_{\\tilde x} \\int_x q(x) p(\\tilde x \\mid x) \\left\\langle \\psi(\\tilde{x}; \\theta), \\frac{\\partial}{\\partial \\tilde x} \\log p(\\tilde x \\mid x) \\right \\rangle dx \\ d\\tilde x\\\\ \u0026= \\mathbb{E}_{q(x, \\tilde x)} \\left[\\left\\langle \\psi(\\tilde{x}; \\theta), \\frac{\\partial}{\\partial \\tilde x} \\log p(\\tilde x \\mid x)\\right \\rangle\\right] \\end{aligned} $$æ•´åˆå½¢å¼ï¼Œæœ‰ï¼š\n$$ J_{ESM_{\\sigma}}(\\theta) = \\frac 1 2 \\mathbb{E}_{q_{\\sigma}(\\tilde{x})}\\left[ \\left\\| \\psi(\\tilde{x}; \\theta) \\right\\|^2\\right] - \\mathbb{E}_{q(x, \\tilde x)} \\left[\\left\\langle \\psi(\\tilde{x}; \\theta), \\frac{\\partial}{\\partial \\tilde x} \\log p(\\tilde x \\mid x)\\right \\rangle\\right] + C $$åªéœ€æ·»åŠ ä¸€ä¸ªä¸å¾…ä¼˜åŒ–å‚æ•°æ— å…³çš„é‡ï¼š\n$$ C = \\mathbb{E}_{q(x, \\tilde x)} \\left[\\left\\| \\frac{\\partial}{\\partial \\tilde x} \\log p(\\tilde x \\mid x)\\right \\|^2\\right] $$æœ‰ï¼š\n$$ \\begin{aligned} J_{ESM_{\\sigma}}(\\theta) \u0026= \\frac 1 2 \\mathbb{E}_{q_{\\sigma}(\\tilde{x})}\\left[ \\left\\| \\psi(\\tilde{x}; \\theta) \\right\\|^2\\right] - \\mathbb{E}_{q(x, \\tilde x)} \\left[\\left\\langle \\psi(\\tilde{x}; \\theta), \\frac{\\partial}{\\partial \\tilde x} \\log p(\\tilde x \\mid x)\\right \\rangle\\right] + \\mathbb{E}_{q(x, \\tilde x)} \\left[\\left\\| \\frac{\\partial}{\\partial \\tilde x} \\log p(\\tilde x \\mid x)\\right \\|^2\\right]+ C \\\\ \u0026= \\mathbb{E}_{q(x, \\tilde x)} \\left[ \\frac 1 2 \\left\\| \\psi(\\tilde{x}; \\theta) \\right\\|^2 - \\left\\langle \\psi(\\tilde{x}; \\theta), \\frac{\\partial}{\\partial \\tilde x} \\log p(\\tilde x \\mid x)\\right \\rangle + \\left\\| \\frac{\\partial}{\\partial \\tilde x} \\log p(\\tilde x \\mid x)\\right \\|^2\\right] + C\\\\ \u0026= \\mathbb{E}_{q_{\\sigma}(x, \\tilde{x})}\\left[ \\frac{1}{2} \\left\\| \\psi(\\tilde{x}; \\theta) - \\frac{\\partial \\log q_{\\sigma}(\\tilde{x}|x)}{\\partial \\tilde{x}} \\right\\|^2 \\right]\\\\ \u0026= J_{DSMq}(\\theta) \\end{aligned} $$å…¶ä¸­ï¼Œ$\\psi(\\tilde{x}; \\theta)$ æ˜¯æˆ‘ä»¬éœ€è¦å­¦ä¹ çš„ Score Functionã€‚æœ‰è¶£çš„äº‹ï¼Œå±•å¼€ $\\frac{\\partial \\log q_{\\sigma}(\\tilde{x}|x)}{\\partial \\tilde{x}}$ ä¸éš¾å‘ç°ï¼š\n$$ \\begin{aligned} \\frac{\\partial \\log q_{\\sigma}(\\tilde{x}|x)}{\\partial \\tilde{x}} \u0026= \\frac 1 {\\sigma^2} (x - \\tilde{x})\\\\ \\end{aligned} $$Score Function å®é™…ä¸Šè·Ÿè¸ªçš„æ˜¯æˆ‘ä»¬æ·»åŠ å™ªå£°çš„åæ–¹å‘ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬æ˜¯åœ¨ â€œé™å™ªâ€ã€‚ä»è¿™é‡Œå·²ç»å¯ä»¥çœ‹åˆ°ä¸€äº› Diffusion çš„å½±å­äº†ã€‚\n2.3. DSM å’Œ DAE ä¹‹é—´çš„å…³ç³» ä¸å¦¨å…ˆç®€å•å›é¡¾ä¸€ä¸‹ï¼Œæ­¤å¤„å¯¹äºè¢«å™ªå£°æ±¡æŸ“äº†çš„æ•°æ®å¯¹ $\\{\\tilde x, x\\}$ï¼ŒDAE çš„ Loss Funciton å¯ä»¥å†™ä½œ:\n$$ J_{DAE}(\\theta) = \\mathbb{E}_{q(x), q_\\sigma(\\tilde{x}|x)}\\left[ \\left\\| r(\\tilde{x}, \\theta) - x \\right\\|^2 \\right] $$å…¶ä¸­ $r(\\tilde{x}, \\theta)$ æ˜¯ DAE çš„é‡å»ºå‡½æ•°ã€‚æ ¹æ®ä¸Šä¸€èŠ‚ä¸­çš„è¯æ˜ Score Function å¯ä»¥å®šä¹‰ä¸ºï¼š\n$$ \\psi(x, \\theta) = \\frac {r(\\tilde x, \\theta) - \\tilde{x}}{\\sigma^2} $$å°†è¿™ä¸ªå½¢å¼å¸¦å…¥ $J_{DSM}$ ä¸­ï¼Œä¸éš¾å‘ç°ï¼š\n$$ \\begin{aligned} J_{DSM}(\\theta) \u0026= \\mathbb{E}_{q(x), q_\\sigma(\\tilde{x}|x)}\\left[ \\frac{1}{2} \\left\\| \\psi(\\tilde{x}; \\theta) - \\frac{x - \\tilde{x}}{\\sigma^2} \\right\\|^2 \\right]\\\\ \u0026= \\mathbb{E}_{q(x), q_\\sigma(\\tilde{x}|x)}\\left[ \\frac{1}{2\\sigma^4} \\left\\| r(\\tilde x, \\theta) - x \\right\\|^2 \\right]\\\\ \u0026= \\frac{1}{2\\sigma^4} J_{DAE}(\\theta) \\end{aligned} $$è¿™ä¸ DAE çš„ Loss Function åªå·®ä¸€ä¸ªå¸¸æ•°å€æ•°ã€‚\n3. Discussion Score Matching åœ¨ Denoising Score Matching ä¹‹å‰ï¼Œå¯ä»¥è¯´æ˜¯ä¸€ä¸ª â€œå± é¾™æœ¯â€ã€‚ç¡®å®ï¼ŒScore Matching å¾ˆå¥½çš„è§£å†³äº†å½’ä¸€åŒ–é—®é¢˜ã€‚ä½†æ˜¯ä¾ç„¶æœ‰å¾ˆå¤šç¼ºé™·ï¼š\nScore Matching çš„ Loss Function éœ€è¦è®¡ç®—äºŒé˜¶å¯¼æ•°ï¼Œå¯¹äºé«˜ç»´æ•°æ®è®¡ç®—é‡å·¨å¤§ï¼Œä¸”æ•°å€¼ä¸Šä¸ç¨³å®šã€‚ Score Matching åªå¯¹æ•°æ®é‡‡æ ·ç‚¹é™„è¿‘çš„ä¿¡æ¯æ¢¯åº¦å»ºæ¨¡ï¼Œå¯¼è‡´ Langevin Annealing çš„è¿‡ç¨‹ä¸­å¾ˆå®¹æ˜“é™·å…¥å±€éƒ¨æœ€ä¼˜ã€‚ Denoising Score Matching å¾ˆå¥½çš„è§£å†³äº†è¿™äº›é—®é¢˜ã€‚é¦–å…ˆï¼ŒDSM é€šè¿‡æ·»åŠ å™ªå£°çš„æ–¹å¼ï¼Œäº‹å®ä¸Šå»ºç«‹äº†ä¸€æ¡ä»å™ªå£°åˆ°æ•°æ®çš„é€šè·¯ï¼Œæˆ‘ä»¬çš„æ¨¡å‹äº‹å®ä¸Šè§è¿‡ä»å™ªå£°é‡å»ºæ•°æ®çš„æ¯ä¸€æ­¥æ“ä½œï¼Œè®©æ¨¡å‹çš„é‡‡æ ·æ›´åŠ é²æ£’ã€‚æ›´å¤§çš„å¥½å¤„æ˜¯ï¼Œåœ¨å®é™…æ“ä½œä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„ Loss æ˜¯ï¼š\n$$ \\begin{aligned} J_{DSMq}(\\theta) \u0026= \\mathbb{E}_{q_{\\sigma}(x, \\tilde{x})}\\left[ \\frac{1}{2} \\left\\| \\psi(\\tilde{x}; \\theta) - \\frac{\\partial \\log q_{\\sigma}(\\tilde{x}|x)}{\\partial \\tilde{x}} \\right\\|^2 \\right]\\\\ \u0026= \\mathbb{E}_{q_{\\sigma}(x, \\tilde{x})}\\left[ \\frac{1}{2} \\left\\| \\psi(\\tilde{x}; \\theta) - \\frac{1}{\\sigma^2} (x - \\tilde{x}) \\right\\|^2 \\right] \\end{aligned} $$å‡è®¾å¯¹äºæ•°æ® $x$ï¼Œæˆ‘ä»¬æ·»åŠ äº†å™ªå£° $\\epsilon(\\tilde x)$ï¼Œé‚£ä¹ˆå¯¹äºé€šè¿‡ç¥ç»ç½‘ç»œæè¿°çš„ Score Function $\\psi(\\tilde x; \\theta)$ï¼Œæˆ‘ä»¬åªéœ€è¦æœ€å°åŒ–ï¼š\n$$ \\boxed{ J_{DSMq}(\\theta) = \\mathbb{E}_{q_{\\sigma}(x, \\tilde{x})}\\left[ \\frac{1}{2} \\left\\| \\psi(\\tilde{x}; \\theta) - \\frac{\\epsilon(\\tilde x)}{\\sigma^2} \\right\\|^2 \\right] } $$äº‹å®ä¸Šå°†ä¸€ä¸ªå¤æ‚çš„æ— ç›‘ç£å­¦ä¹ é—®é¢˜ï¼Œè½¬åŒ–ä¸ºä¸€ä¸ªæœ‰ç›‘ç£å­¦ä¹ é—®é¢˜ï¼Œå¹¶ç›´æ¥ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ ESM ä½œä¸º Loss Functionã€‚ä¸è®ºæ˜¯ä»£ç è¿˜æ˜¯è®­ç»ƒéš¾åº¦ï¼Œéƒ½ç®€å•äº†éå¸¸å¤šã€‚åœ¨å®è·µä¸­ï¼Œä½¿ç”¨ Pytorchï¼Œå®ç°éå¸¸ç®€å•ï¼š\ndef denoising_score_matching_loss(self, x, sigma=0.01): batch_size = x.shape[0] # æ·»åŠ å™ªå£° noise = torch.randn_like(x) * sigma x_noisy = x + noise x_noisy.requires_grad_(True) # è®¡ç®— score score = self.score_network(x_noisy) # Target: -noise / sigma^2 (çœŸå®çš„å»å™ªæ–¹å‘) target = -noise / (sigma ** 2) # ä½¿ç”¨åŠ æƒçš„ MSE Lossï¼Œé¿å…å°å™ªå£°æ—¶ loss çˆ†ç‚¸ weight = sigma ** 2 # æƒé‡ä¸ sigma^2 æˆæ­£æ¯”ï¼Œå¹³è¡¡ä¸åŒå™ªå£°æ°´å¹³çš„æŸå¤± loss = weight * F.mse_loss(score, target) return loss å¹¶ä¸”ï¼Œä» DSMï¼Œå·²ç»å¯ä»¥çœ‹åˆ° Diffusion çš„é›å½¢äº†ã€‚è¿™ç¯‡æ–‡ç« ä¹Ÿå¼€å¯äº†åä¸–æ‰©æ•£æ¨¡å‹å¤§å‘å±•çš„å¤§é—¨ã€‚\nAppendix A. Parzen Density Estimator å¯¹äºä¸€ä¸ªç†æƒ³ä½†æ˜¯æœªçŸ¥çš„åˆ†å¸ƒ $p(x)$ï¼Œæˆ‘ä»¬å¯¹é½è®¤è¯†åªæœ‰ä¸€ç³»åˆ—é‡‡æ ·ç‚¹ $\\{x_1, x_2, \\cdots ,x_n\\}$ã€‚ä¸€ä¸ªç®€å•çš„ç”šè‡³æœ‰äº›æš´åŠ›çš„é‡å»ºå…¶å¯†åº¦çš„æ–¹æ³•æ˜¯ï¼šç»™æ¯ä¸ªæ•°æ®ç‚¹ä¸Šå›ºå®šä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºé‡å»ºæ ¸ï¼Œå¸¸é€‰é«˜æ–¯åˆ†å¸ƒï¼‰,ä¹‹åå°†æ‰€æœ‰çš„åˆ†å¸ƒåŠ èµ·æ¥ç»Ÿä¸€å½’ä¸€åŒ–ã€‚å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªå¹³æ»‘çš„ã€è¿ç»­çš„æ¦‚ç‡åˆ†å¸ƒã€‚Parzen Density Estimation å¯ä»¥çœ‹ä½œå¯¹ç›´æ–¹å›¾å‘çš„ä¸€ç§ç›´è§‰çš„æ”¹è¿›ã€‚å½“æˆ‘ä»¬é€‰æ‹©å¦‚ä¸‹çš„é«˜æ–¯é‡å»ºæ ¸ï¼š\n$$ p(\\tilde x \\mid x) = \\mathcal N(\\tilde x \\mid x, \\sigma^2 I) $$é‚£ä¹ˆ Parzen Density Estimation é‡å»ºçš„æ¦‚ç‡åˆ†å¸ƒä¸ºï¼š\n$$ p(\\tilde{x}) = \\frac{1}{n} \\sum_{i=1}^n p(\\tilde x \\mid x_i) = \\frac{1}{n} \\sum_{i=1}^n \\mathcal N(\\tilde x \\mid x_i, \\sigma^2 I) $$å…¶ä¸­ï¼Œé«˜æ–¯åˆ†å¸ƒçš„åæ–¹å·® $\\sigma$ æ§åˆ¶äº†é‡å»ºåˆ†å¸ƒçš„å¹³æ»‘ç¨‹åº¦ã€‚$\\sigma$ è¶Šå¤§ï¼Œé‡å»ºåˆ†å¸ƒè¶Šå¹³æ»‘ï¼Œ$\\sigma$ è¶Šå°ï¼Œé‡å»ºåˆ†å¸ƒè¶Šæ¥è¿‘åŸå§‹æ•°æ®çš„ç¦»æ•£é‡‡æ ·ã€‚è¿™é‡Œç§°ä¹‹ä¸º â€œå¸¦å®½â€ã€‚\näº‹å®ä¸Šå¯ä»¥é€šè¿‡ä¸€ä¸ªæ›´å½¢å¼è¯çš„æ–¹å¼æ¥å®šåŠ› Parzen Density Estimationã€‚å¯¹äºä¸€ç³»åˆ—æ•°æ® $\\{x_1, x_2, \\cdots ,x_n\\}$ï¼Œæˆ‘ä»¬å¯ä»¥å»ºç«‹èµ·å…¶ç»éªŒåˆ†å¸ƒï¼š\n$$ q(x) = \\frac{1}{n}\\sum_{i=1}^n \\delta(x - x_i) $$å¯¹äºé‡å»ºæ ¸ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶å†™æˆæ¡ä»¶çš„å½¢å¼ï¼š\n$$ p(\\tilde x \\mid x) = \\mathcal N(\\tilde x \\mid x, \\sigma^2 I) $$Parzen Density Estimation å¯ä»¥ç”¨è¾¹ç¼˜åˆ†å¸ƒé‡å†™ï¼š\n$$ \\begin{aligned} p(\\tilde x) \u0026= \\int p(\\tilde x \\mid x) q(x) dx\\\\ \u0026= \\int \\sum_{i=1}^n \\delta(x - x_i) \\mathcal N(\\tilde x \\mid x, \\sigma^2 I) dx\\\\ \u0026= \\sum_{i=1}^n \\int \\delta(x - x_i) \\mathcal N(\\tilde x \\mid x, \\sigma^2 I) dx\\\\ \u0026= \\frac{1}{n} \\sum_{i=1}^n \\mathcal N(\\tilde x \\mid x_i, \\sigma^2 I) \\end{aligned} $$è¿™ä¸ªå½¢å¼ä¸ç›´æ¥çš„ Parzen Density Estimation æ˜¯ç­‰ä»·çš„ã€‚è¿™ä¸ªç†è§£åœ¨ DAE ä¸­è‡³å…³é‡è¦ã€‚\nReference [A connection between score matching and denoising autoencoders](@article{vincent2011connection, title={}, author={Vincent, Pascal}, journal={Neural computation}, volume={23}, number={7}, pages={1661â€“1674}, year={2011}, publisher={MIT Press} })\n","wordCount":"1263","inLanguage":"en","image":"https://wangjv0812.cn/","datePublished":"2025-10-13T20:40:25+08:00","dateModified":"2025-10-13T20:40:25+08:00","author":{"@type":"Person","name":"WangJV"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://wangjv0812.cn/2025/10/denoising-score-matching/"},"publisher":{"@type":"Organization","name":"WangJV Blog","logo":{"@type":"ImageObject","url":"https://wangjv0812.cn/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://wangjv0812.cn/ accesskey=h title="WangJV Blog (Alt + H)">WangJV Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://wangjv0812.cn/ title=Home><span>Home</span></a></li><li><a href=https://wangjv0812.cn/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://wangjv0812.cn/resources/ title=Resources><span>Resources</span></a></li><li><a href=https://wangjv0812.cn/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://wangjv0812.cn/search/ title="ğŸ” Search (Alt + /)" accesskey=/><span>ğŸ” Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://wangjv0812.cn/>Home</a>&nbsp;Â»&nbsp;<a href=https://wangjv0812.cn/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Denoising Score Matching</h1><div class=post-meta><span title='2025-10-13 20:40:25 +0800 +0800'>October 13, 2025</span>&nbsp;Â·&nbsp;6 min&nbsp;Â·&nbsp;1263 words&nbsp;Â·&nbsp;WangJV&nbsp;|&nbsp;<a href=https://github.com/WangJV0812/WangJV-Blog-Source/tree/master/content/posts/DenoisingScoreMatching/index.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#1-åŠ¨æœº>1. åŠ¨æœº</a><ul><li><a href=#11-denoising-autoencoder>1.1. Denoising AutoEncoder</a></li><li><a href=#12-score-matching>1.2. Score Matching</a></li></ul></li><li><a href=#2-dsm-å’Œ-dae-ä¹‹é—´çš„è”ç³»>2. DSM å’Œ DAE ä¹‹é—´çš„è”ç³»</a><ul><li><a href=#21-dsmdenoising-score-matching>2.1. DSMï¼ˆDenoising Score Matchingï¼‰</a></li><li><a href=#22-dsm-loss-ç­‰ä»·æ€§è¯æ˜>2.2. DSM Loss ç­‰ä»·æ€§è¯æ˜</a></li><li><a href=#23-dsm-å’Œ-dae-ä¹‹é—´çš„å…³ç³»>2.3. DSM å’Œ DAE ä¹‹é—´çš„å…³ç³»</a></li></ul></li><li><a href=#3-discussion>3. Discussion</a></li><li><a href=#appendix>Appendix</a><ul><li><a href=#a-parzen-density-estimator>A. Parzen Density Estimator</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></nav></div></details></div><div class=post-content><h2 id=1-åŠ¨æœº>1. åŠ¨æœº<a hidden class=anchor aria-hidden=true href=#1-åŠ¨æœº>#</a></h2><p>ä»¥æ•°æ®ç”Ÿæˆä¸ºä»£è¡¨çš„è‡ªç›‘ç£å­¦ä¹ å¾€å¾€å¸Œæœ›è®¾è®¡å‡ºä¸€ç§ç‹¬ç‰¹ä¸”æœ‰æ•ˆçš„æœºåˆ¶ï¼Œé€šè¿‡ç½‘ç»œç»“æ„å’Œè®­ç»ƒæ–¹æ³•çš„è®¾è®¡ï¼Œè¿«ä½¿æ¨¡å‹æ‰¾åˆ°ä»£è¡¨ä¸€ä¸ªæ•°æ®æœ€æ ¸å¿ƒå’Œå…³é”®çš„ä¿¡æ¯æˆ–è€…è¯´ç‰¹å¾ï¼Œæˆ–è€…å¸Œæœ›è®©æ¨¡å‹è‡ªå·±æ€»ç»“å‡ºæ•°æ®çš„å†…åœ¨ç»“æ„ã€‚æˆ–è€…ç”¨ä¸€ä¸ªæ›´æ¦‚ç‡çš„è¡¨è¾¾ï¼Œå°±åƒæ˜¯ä¹‹å‰æˆ‘ä»¬åœ¨ <a href=https://wangjv0812.cn/2025/08/noise-contrastive-estimation/>NCE ä¸­å¯¹äºæ•°æ®æµå½¢</a> è®¨è®ºè¿‡çš„ã€‚æ•°æ®æ˜¯ä¸€ä¸ªéšè—åœ¨é«˜ç»´ç©ºé—´ä¸­çš„ä½ç»´æµå½¢ï¼Œè€Œæ¦‚ç‡åˆ†å¸ƒæ°å¥½ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„æè¿°æµå½¢çš„æ•°å­¦å·¥å…·ã€‚</p><p>æˆ‘ä»¬å‡è®¾çœŸå®æ•°æ®æœ‰æ¦‚ç‡åˆ†å¸ƒ $p(x)$ï¼Œè€Œæˆ‘ä»¬å¸Œæœ›å¯»æ‰¾ä¸€ä¸ªæ”¶åˆ°å‚æ•° $\theta$ æ§åˆ¶çš„æ¦‚ç‡åˆ†å¸ƒ $q(x\mid \theta)$ï¼Œå°½å¯èƒ½çš„æ¥è¿‘çœŸå®åˆ†å¸ƒã€‚ç”Ÿæˆæ¨¡å‹å­¦ä¹ äº‹å®ä¸Šå¸Œæœ›è§£å†³ä¸¤ä¸ªå®è´¨æ€§çš„é—®é¢˜ï¼š</p><ol><li>æˆ‘ä»¬ä¸çŸ¥é“çœŸå®åˆ†å¸ƒ $p(x)$ï¼Œåªæœ‰å¯¹äº $p(x)$ çš„ä¸€ç³»åˆ—é‡‡æ · $\{x_1, x_2, \cdots x_n\}$ï¼ˆå°±æ˜¯æˆ‘ä»¬çš„æ•°æ®é›†ï¼‰ï¼Œå¦‚ä½•åˆ©ç”¨è¿™äº›é‡‡æ ·å°½å¯èƒ½å¥½çš„æ‰¾åˆ°ä¸€ç»„å‚æ•° $\theta$ï¼Œä½¿å¾— $q(x\mid \theta)$ å°½å¯èƒ½æ¥è¿‘ $p(x)$ã€‚</li><li>å¯¹äºä¸€ä¸ªå®Œæˆå­¦ä¹ çš„åˆ†å¸ƒ $p(x\mid \theta)$ï¼Œå¦‚ä½•å¯¹å…¶é‡‡æ ·ï¼Œè·å¾—ä¸€ç»„æ–°çš„æ•°æ®ã€‚è¿›ä¸€æ­¥å°†ï¼Œå¦‚ä½•è®©é‡‡æ ·æ»¡è¶³ä¸€å®šçš„æ¡ä»¶ã€‚</li></ol><p>è¿™ä¸¤ä¸ªé—®é¢˜çœ‹è¯´æ¥å®¹æ˜“ï¼Œä½†åšèµ·æ¥å´ä½•å…¶éš¾ã€‚ä»æ¬¡å¼•å‡ºäº†å·¨é‡çš„é—®é¢˜ï¼Œä¾‹å¦‚å¦‚ä½•è§„é¿åˆ†å¸ƒçš„å½’ä¸€åŒ–ç³»æ•°ã€å¦‚ä½•é¿å…å­¦ä¹ ä¸€ä¸ªæ’ç­‰æ˜ å°„ï¼ˆä¾‹å¦‚ AutoEncoderï¼‰ã€å¦‚ä½•é¿å…åªå­¦åˆ°ä¸€ä¸ªå¾ˆçª„çš„åˆ†å¸ƒï¼ˆSMï¼‰ç­‰ç­‰ã€‚å½’ä¸€åŒ–ç³»æ•°æˆ‘ä»¬ä¹‹å‰åœ¨ <a href=https://wangjv0812.cn/2025/08/scorematching/>Score Matching</a> ä¸­è®¨è®ºè¿‡ã€‚ä¸ºäº† DSM å™è¿°çš„è¿è´¯æ€§ï¼Œæˆ‘ä»¬ä¸å¦¨å…ˆä» Autoencoder çš„ç¼ºé™·å’Œæ”¹è¿›èŠèµ·ã€‚</p><h3 id=11-denoising-autoencoder>1.1. Denoising AutoEncoder<a hidden class=anchor aria-hidden=true href=#11-denoising-autoencoder>#</a></h3><p>AutoEncoder æ˜¯ä¸€ä¸ªéå¸¸ç›´è§‰çš„æ— ç›‘ç£å­¦ä¹ æ–¹æ³•ã€‚å®ƒåŸºäºä¸€ä¸ªå¾ˆç›´è§‰çš„è®¤è¯†ï¼šæ— ç›‘ç£å­¦ä¹ å¸Œæœ›å­¦ä¹ ä¸€æ¡åˆ†å¸ƒåœ¨é«˜ç»´ç©ºé—´ä¸­çš„ä½ç»´æµå½¢ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç»´åº¦æ°å¥½ä¸ºä½ç»´æµå½¢ç‹¬ç«‹ç»´åº¦çš„ç“¶é¢ˆå±‚æ¥å¼ºè¿«æ¨¡å‹å­¦ä¹ ä¸€ä¸ªæœ‰æ•ˆçš„æ•°æ®å‹ç¼©å’Œæ¢å¤ï¼Œæ˜¯å¦æ°å¥½å¯ä»¥æå–å‡ºæ•°æ®æœ€æ ¹æœ¬çš„å†…åœ¨ç»“æ„ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¾ç„¶æœ‰å¾ˆå¤šç¼ºé™·ï¼Œä¾‹å¦‚æ¨¡å‹å­¦ä¹ åˆ°çš„ latent space ä¸å…·æœ‰è¿ç»­æ€§ï¼Œæ— æ³•ç›´æ¥æ’å€¼ï¼ˆè¿™ä¸ªé—®é¢˜è¢« VAE è§£å†³äº†ï¼‰ï¼Œæ¨¡å‹å¾ˆå®¹æ˜“å­¦åˆ°ä¸€ä¸ªæ’ç­‰æ˜ å°„ç­‰ç­‰ã€‚</p><p>ä¸ºäº†è§£å†³æ’ç­‰æ˜ å°„è¿™ä¸ªé—®é¢˜ï¼ŒDAE çš„æ€è·¯æ˜¯ï¼šå¦‚æœç®€å•çš„è¦æ±‚æ¨¡å‹è‡ªå·±é€šè¿‡ ç¼–ç -è§£ç  çš„æ–¹å¼ç ´åé‡å»ºæ•°æ®æ— æ³•ä¿è¯æ¨¡å‹å­¦åˆ°å¯é çš„ç‰¹å¾ï¼Œé‚£ä¹ˆä½•ä¸æˆ‘æ¥ç ´åå‘¢ï¼Ÿæˆ‘ä»¬ç›´æ¥ç»™æ•°æ®æ·»åŠ å™ªå£°ï¼Œå°†å¸¦æœ‰å™ªå£°çš„æ•°æ®è¾“å…¥ç¼–ç å™¨ï¼Œè®©æ¨¡å‹æ¢å¤å‡ºæ²¡æœ‰å™ªå£°çš„ï¼Œæºåˆçš„æ•°æ®ã€‚</p><p>å½¢å¼åŒ–çš„è®²ï¼Œå¯¹äºæ•°æ® $x$ï¼Œæˆ‘ä»¬æ·»åŠ æœä»é«˜æ–¯åˆ†å¸ƒçš„å™ªå£° $\epsilon \sim \mathcal N(x\mid 0, \sigma^2I)$ï¼Œæœ‰è¢«æ±¡æŸ“çš„æ•°æ®ï¼š</p>$$
\tilde{x} = x + \epsilon
$$<p>é‚£ä¹ˆï¼ŒæŸå¤±å¯ä»¥å†™ä½œï¼š</p>$$
J_{DATA}(\theta) = \mathbb{E}\left(\left\|
\text{Decoder}(\text{Encoder} (x + \epsilon)) - x
\right\|^2\right)
$$<h3 id=12-score-matching>1.2. Score Matching<a hidden class=anchor aria-hidden=true href=#12-score-matching>#</a></h3><p>æˆ‘ä»¬ä¹‹å‰åœ¨ <a href=https://wangjv0812.cn/2025/08/scorematching/>Score Matching</a> ä¸­è®¨è®ºè¿‡ Score Matching çš„åŸºæœ¬åŸç†ã€‚è¿™é‡Œç®€å•å›é¡¾ä¸€ä¸‹ã€‚Score Matching æœ€æ ¸å¿ƒçš„åˆ›æ–°æ˜¯å­¦ä¹ åˆ†å¸ƒçš„ Score Functionï¼Œè€Œä¸æ˜¯ç›´æ¥å­¦ä¹ åˆ†å¸ƒæœ¬èº«ã€‚å­¦ä¹  Score Function æœ€æ ¸å¿ƒçš„ä¼˜åŠ¿æ˜¯ï¼Œæˆ‘ä»¬å¯¹ Score Function çš„å½¢å¼æ²¡æœ‰ä»»ä½•è¦æ±‚ï¼Œå¯ä»¥ç”¨ä»»æ„ä¸€ä¸ªç¥ç»ç½‘ç»œæ‹Ÿåˆï¼Œä»æœ¬è´¨ä¸Šè§£å†³äº†å½’ä¸€åŒ–ç³»æ•°çš„é—®é¢˜ã€‚å¸Œæœ›å­¦ä¹ åˆ°åˆ†å¸ƒçš„ Score Function æœ€ç›´æ¥çš„æ–¹å¼ï¼Œå³ä½¿ç›´æ¥ä½¿ç”¨ <a href=https://wangjv0812.cn/2025/09/fisher-information-and-fisher-divergence/>Fisher Divergence</a>ã€‚</p>$$
J_{\text{ESM}}(\theta) = \frac{1}{2} \mathbb{E}_{x\sim p(x)}\left(\left\|
\nabla_x \log p(x) - \nabla_x \log q(x\mid \theta)
\right\|^2\right)
$$<p>ä½†æ˜¯é—®é¢˜åœ¨äºï¼Œæˆ‘ä»¬ä¸çŸ¥é“çœŸå®åˆ†å¸ƒçš„è§£æå½¢å¼ï¼Œæœ‰çš„åªæ˜¯å¯¹çœŸå®åˆ†å¸ƒçš„é‡‡æ ·ï¼Œæ²¡æ³•è®¡ç®— Fisher Divergenceã€‚Divergenceã€‚HyvÃ¤rinen ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¯æ˜äº†åœ¨æ¸©å’Œçš„æ¡ä»¶ä¸‹ï¼ŒFisher Divergence å¯ä»¥ç­‰ä»·è½¬æ¢ä¸ºï¼š</p>$$
J_{\text{ISM}}(\theta) = \mathbb{E}_{x\sim p(x)}\left(\Delta_x \log q(x\mid \theta) + \frac{1}{2}\left\|
\nabla_x \log q(x\mid \theta)
\right\|^2\right)
$$<p>åœ¨å¯¹çœŸå®åˆ†å¸ƒ $p(x)$ æœ‰é™çš„é‡‡æ · $\{x_1, x_2, \cdots x_n\}$ï¼Œä¸Šé¢çš„çš„æœŸæœ›å¯ä»¥é€šè¿‡æœ‰é™é‡‡æ ·çš„å‡å€¼æ¥è¿‘ä¼¼ï¼š</p>$$
J_{ISM}(\theta) \approx \frac{1}{n} \sum_{i=1}^n \left(\Delta_x \log q(x_i\mid \theta) + \frac{1}{2}\left\|
\nabla_x \log q(x_i\mid \theta)
\right\|^2\right)
$$<p>å°† Score Function è®°ä½œ $\psi(x, \theta) = \nabla_x \log q(x\mid \theta)$ï¼Œä¸Šé¢çš„å½¢å¼å¯ä»¥å†™ä½œï¼š</p>$$
J_{ISM}(\theta) \approx \frac{1}{n} \sum_{t=1}^n \left(
\sum_{i=0}^d \frac{\partial \psi(x^t, \theta)}{\partial x_i} + \frac{1}{2}\left\|
\psi(x^t, \theta)
\right\|^2\right)
$$<p>åœ¨è®¡ç®—ä¸Šï¼Œ$\frac{\partial \psi(x^t, \theta)}{\partial x_i}$ å³ä¸å…·å¤‡æ•°å€¼ç¨³å®šæ€§ï¼Œä¹Ÿä¸å…·å¤‡è®¡ç®—æ•ˆç‡ã€‚ä¸ºäº†è§£å†³ç¨³å®šé—®é¢˜ï¼ŒLeCun æå‡ºåœ¨ ISM çš„åŸºç¡€ä¸Šæ·»åŠ ä¸€ä¸ªå…³äºè¿™ä¸€é¡¹çš„æ­£åˆ™åŒ–é¡¹ï¼š</p>$$
J_{ISMreq}(\theta) = J_{ISM}(\theta) + \lambda \sum_{i=1}^d \left(\frac{\partial \psi(x, \theta)}{\partial x_i}\right)^2
$$<p>æ˜¾ç„¶ï¼Œæ·»åŠ æ­£åˆ™åŒ–åï¼Œå¯ä»¥æœ‰æ•ˆçš„è®© score function åœ¨å‡ ä½•ä¸Šæ›´åŠ  â€œå¹³ç¼“â€ï¼Œé¿å…å­¦ä¹ åˆ°å¾ˆæç«¯å’Œå´å²–çš„ score functionï¼Œä»è€Œæå‡æ•°å€¼ç¨³å®šæ€§ã€‚</p><h2 id=2-dsm-å’Œ-dae-ä¹‹é—´çš„è”ç³»>2. DSM å’Œ DAE ä¹‹é—´çš„è”ç³»<a hidden class=anchor aria-hidden=true href=#2-dsm-å’Œ-dae-ä¹‹é—´çš„è”ç³»>#</a></h2><h3 id=21-dsmdenoising-score-matching>2.1. DSMï¼ˆDenoising Score Matchingï¼‰<a hidden class=anchor aria-hidden=true href=#21-dsmdenoising-score-matching>#</a></h3><p>å¯¹äºé€šè¿‡ä¸€ç³»åˆ—é‡‡æ ·æè¿°çš„æ•°æ® $\{x_1, x_2, \cdots, x_n\}$ï¼Œæˆ‘ä»¬ä¸å¦¨ç”¨ Parzen Windows Density Estimation æ¥å¯¹æ•°æ®åˆ†å¸ƒè¿›è¡Œå¹³æ»‘ï¼Œç»™æ•°æ®ä¸€ä¸ªä¾¿äºåˆ†æçš„è§£æå½¢å¼ã€‚å…³äº Parzen Density Estimator çš„å†…å®¹å¯ä»¥å‚è€ƒ <a href=#a-parzen-density-estimator>Appendix A</a>ã€‚</p><p>ä¸å¦¨é€‰æ‹©å—å¸¦å®½å‚æ•° $\sigma$ æ§åˆ¶çš„é«˜æ–¯å‡½æ•°ä½œä¸ºæ ¸å‡½æ•°ï¼š</p>$$
q_\sigma(\tilde{x} \mid x) = \frac{1}{(\sigma \sqrt{2\pi})^d} \exp\left(-\frac{\|\tilde{x} - x\|^2}{2\sigma^2}\right)
$$<p>ç»è¿‡ Parzen Density Estimator é‡å»ºçš„æ•°æ®åˆ†å¸ƒä¸ºï¼š</p>$$
q_\sigma(\tilde{x}) = \frac{1}{n} \sum_{i=1}^n q_\sigma(\tilde{x} \mid x_i)
$$<p>é‚£ä¹ˆï¼ŒParzen Density Estimation é‡å»ºåè¿›è¡Œçš„æ˜¾å¼åˆ†æ•°åŒ¹é…ç›®æ ‡å‡½æ•°ä¸ºï¼š</p>$$
J_{ESM_{\sigma}}(\theta) = \mathbb{E}_{q_{\sigma}(\tilde{x})}\left[ \frac{1}{2} \left\| \psi(\tilde{x}; \theta) - \frac{\partial \log q_{\sigma}(\tilde{x})}{\partial \tilde{x}} \right\|^2 \right]
$$<p>é˜…è¯» <a href=#a-parzen-density-estimator>Appendix A</a> å¯ä»¥å‘ç°ï¼ŒParzen Density Estimation äº‹å®ä¸Šæ˜¯å¯¹æ•°æ®æ·»åŠ äº†é«˜æ–¯å™ªå£°ã€‚å¯¹äºä¸Šé¢çš„å½¢å¼ï¼Œæˆ‘ä»¬ä¸å¦¨å±•å¼€ï¼Œçœ‹çœ‹é«˜æ–¯å™ªå£°å¯¹æ•°æ®çš„æ±¡æŸ“å¯¹ Score Function å­¦ä¹ äº§ç”Ÿäº†ä»€ä¹ˆå½±å“ï¼Ÿ</p><h3 id=22-dsm-loss-ç­‰ä»·æ€§è¯æ˜>2.2. DSM Loss ç­‰ä»·æ€§è¯æ˜<a hidden class=anchor aria-hidden=true href=#22-dsm-loss-ç­‰ä»·æ€§è¯æ˜>#</a></h3><p>å¯¹äº $J_{ESM_{\sigma}}(\theta)$ï¼Œä¸å¦¨å°†äºŒèŒƒæ•°çš„å½¢å¼å±•å¼€ï¼š</p>$$
\begin{aligned}
J_{ESM_{\sigma}}(\theta)
&= \mathbb{E}_{q_{\sigma}(\tilde{x})}\left[ \frac{1}{2} \left\| \psi(\tilde{x}; \theta) - \frac{\partial \log q_{\sigma}(\tilde{x})}{\partial \tilde{x}} \right\|^2 \right] \\
&= \mathbb{E}_{q_{\sigma}(\tilde{x})}\left[ \frac{1}{2} \left( \left\| \psi(\tilde{x}; \theta) \right\|^2 - 2\left \langle \psi(\tilde{x}; \theta), \frac{\partial \log q_{\sigma}(\tilde{x})}{\partial \tilde{x}} \right \rangle + \left\| \frac{\partial \log q_{\sigma}(\tilde{x})}{\partial \tilde{x}} \right\|^2 \right) \right] \\
&= \frac 1 2 \mathbb{E}_{q_{\sigma}(\tilde{x})}\left[ \left\| \psi(\tilde{x}; \theta) \right\|^2\right] - \mathbb{E}_{q_{\sigma}(\tilde{x})}\left[ \left\langle \psi(\tilde{x}; \theta), \frac{\partial \log q_{\sigma}(\tilde{x})}{\partial \tilde{x}} \right \rangle\right] + \frac 1 2 \mathbb{E}_{q_{\sigma}(\tilde{x})}\left[\left\| \frac{\partial \log q_{\sigma}(\tilde{x})}{\partial \tilde{x}} \right\|^2 \right]
\end{aligned}
$$<p>æ˜¾ç„¶ï¼Œå…¶ä¸­ $\frac 1 2 \mathbb{E}_{q_{\sigma}(\tilde{x})}\left[\left\| \frac{\partial \log q_{\sigma}(\tilde{x})}{\partial \tilde{x}} \right\|^2 \right]$ ä¸å¾…ä¼˜åŒ–å‚æ•° $\theta$ æ— å…³ï¼Œå¯ä»¥å¿½ç•¥ã€‚ç¬¬ä¸€é¡¹åªåŒ…å«æ¨¡å‹ï¼Œå¯ä»¥ç›´æ¥ä¿ç•™ã€‚å…³é”®åœ¨äºç¬¬äºŒé¡¹ï¼Œä¸å¦¨å°†å…¶æ ‡æ³¨ä¸º $S(\theta)$ã€‚</p>$$
\begin{aligned}
S(\theta)
&= \mathbb{E}_{q_{\sigma}(\tilde{x})}\left[ \left\langle \psi(\tilde{x}; \theta), \frac{\partial \log q_{\sigma}(\tilde{x})}{\partial \tilde{x}} \right \rangle\right]\\
&= \int q_{\sigma}(\tilde{x}) \left\langle \psi(\tilde{x}; \theta), \frac{\partial \log q_{\sigma}(\tilde{x})}{\partial \tilde{x}} \right \rangle d\tilde{x}\\
\end{aligned}
$$<p>ç”±æ±‚å¯¼æ³•åˆ™ $\frac{\partial }{\partial \tilde x} \log q_\sigma(\tilde x) = \frac{1}{q_\sigma(\tilde x)} \frac{\partial}{\partial \tilde x}q_\sigma(\tilde x)$ å¯çŸ¥ï¼š</p>$$
\begin{aligned}
S(\theta)
&= \int q_{\sigma}(\tilde{x}) \left\langle \psi(\tilde{x}; \theta), \frac{\partial \log q_{\sigma}(\tilde{x})}{\partial \tilde{x}} \right \rangle d\tilde{x}\\
&= \int \left\langle \psi(\tilde{x}; \theta), \frac{\partial}{\partial \tilde x}q_\sigma(\tilde x) \right \rangle d\tilde{x}\\
\end{aligned}
$$<p>å°† Parzen Density Estimation çš„è¾¹ç¼˜åˆ†å¸ƒå½¢å¼å¸¦å…¥ï¼Œå¹¶æ ¹æ®è±å¸ƒå°¼èŒ¨å®šç†äº¤æ¢é¡ºåºï¼š</p>$$
\begin{aligned}
S(\theta)
&= \int_{\tilde x} \left\langle \psi(\tilde{x}; \theta), \frac{\partial}{\partial \tilde x}q_\sigma(\tilde x) \right \rangle d\tilde{x}\\
&= \int_{\tilde x} \left\langle \psi(\tilde{x}; \theta), \frac{\partial}{\partial \tilde x}\int_x p(\tilde x \mid x) q(x) dx \right \rangle d\tilde{x}\\
&= \int_{\tilde x} \left\langle \psi(\tilde{x}; \theta), \int_x q(x) \frac{\partial}{\partial \tilde x} p(\tilde x \mid x) dx \right \rangle d\tilde{x}\\
\end{aligned}
$$<p>ä¸å¦¨å±•å¼€å†…ç§¯ç¬¦å·ï¼Œæœ‰ï¼š</p>$$
\begin{aligned}
S(\theta)
&= \int_{\tilde x} \left\langle \psi(\tilde{x}; \theta), \int_x q(x) \frac{\partial}{\partial \tilde x} p(\tilde x \mid x) dx \right \rangle d\tilde{x}\\
&= \int_{\tilde x} \sum_{i=1}^d \psi^{\top}_i(\tilde{x}; \theta) \int_x q(x) \frac{\partial}{\partial \tilde x} p(\tilde x \mid x) dx \bigg |_i d\tilde x\\
&= \int_{\tilde x} \sum_{i=1}^d \int_x \psi^{\top}_i(\tilde{x}; \theta) q(x) \frac{\partial}{\partial \tilde x} p(\tilde x \mid x) dx \bigg |_i d\tilde x\\
&= \int_{\tilde x} \int_x \sum_{i=1}^d \psi^{\top}_i(\tilde{x}; \theta) q(x) \frac{\partial}{\partial \tilde x} p(\tilde x \mid x) dx \bigg |_i d\tilde x\\
&= \int_{\tilde x} \int_x \left\langle \psi(\tilde{x}; \theta), q(x) \frac{\partial}{\partial \tilde x} p(\tilde x \mid x) \right \rangle dx \ d\tilde x\\
&= \int_{\tilde x} \int_x q(x) p(\tilde x \mid x) \left\langle \psi(\tilde{x}; \theta), \frac{\partial}{\partial \tilde x} \log p(\tilde x \mid x) \right \rangle dx \ d\tilde x\\
&= \mathbb{E}_{q(x, \tilde x)} \left[\left\langle \psi(\tilde{x}; \theta), \frac{\partial}{\partial \tilde x} \log p(\tilde x \mid x)\right \rangle\right]
\end{aligned}
$$<p>æ•´åˆå½¢å¼ï¼Œæœ‰ï¼š</p>$$
J_{ESM_{\sigma}}(\theta) = \frac 1 2 \mathbb{E}_{q_{\sigma}(\tilde{x})}\left[ \left\| \psi(\tilde{x}; \theta) \right\|^2\right] - \mathbb{E}_{q(x, \tilde x)} \left[\left\langle \psi(\tilde{x}; \theta), \frac{\partial}{\partial \tilde x} \log p(\tilde x \mid x)\right \rangle\right] + C
$$<p>åªéœ€æ·»åŠ ä¸€ä¸ªä¸å¾…ä¼˜åŒ–å‚æ•°æ— å…³çš„é‡ï¼š</p>$$
C = \mathbb{E}_{q(x, \tilde x)} \left[\left\| \frac{\partial}{\partial \tilde x} \log p(\tilde x \mid x)\right \|^2\right]
$$<p>æœ‰ï¼š</p>$$
\begin{aligned}
J_{ESM_{\sigma}}(\theta)
&= \frac 1 2 \mathbb{E}_{q_{\sigma}(\tilde{x})}\left[ \left\| \psi(\tilde{x}; \theta) \right\|^2\right] - \mathbb{E}_{q(x, \tilde x)} \left[\left\langle \psi(\tilde{x}; \theta), \frac{\partial}{\partial \tilde x} \log p(\tilde x \mid x)\right \rangle\right] + \mathbb{E}_{q(x, \tilde x)} \left[\left\| \frac{\partial}{\partial \tilde x} \log p(\tilde x \mid x)\right \|^2\right]+ C \\
&= \mathbb{E}_{q(x, \tilde x)} \left[ \frac 1 2 \left\| \psi(\tilde{x}; \theta) \right\|^2 - \left\langle \psi(\tilde{x}; \theta), \frac{\partial}{\partial \tilde x} \log p(\tilde x \mid x)\right \rangle + \left\| \frac{\partial}{\partial \tilde x} \log p(\tilde x \mid x)\right \|^2\right] + C\\
&= \mathbb{E}_{q_{\sigma}(x, \tilde{x})}\left[ \frac{1}{2} \left\| \psi(\tilde{x}; \theta) - \frac{\partial \log q_{\sigma}(\tilde{x}|x)}{\partial \tilde{x}} \right\|^2 \right]\\
&= J_{DSMq}(\theta)
\end{aligned}
$$<p>å…¶ä¸­ï¼Œ$\psi(\tilde{x}; \theta)$ æ˜¯æˆ‘ä»¬éœ€è¦å­¦ä¹ çš„ Score Functionã€‚æœ‰è¶£çš„äº‹ï¼Œå±•å¼€ $\frac{\partial \log q_{\sigma}(\tilde{x}|x)}{\partial \tilde{x}}$ ä¸éš¾å‘ç°ï¼š</p>$$
\begin{aligned}
\frac{\partial \log q_{\sigma}(\tilde{x}|x)}{\partial \tilde{x}}
&= \frac 1 {\sigma^2} (x - \tilde{x})\\
\end{aligned}
$$<p>Score Function å®é™…ä¸Šè·Ÿè¸ªçš„æ˜¯æˆ‘ä»¬æ·»åŠ å™ªå£°çš„åæ–¹å‘ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬æ˜¯åœ¨ â€œé™å™ªâ€ã€‚ä»è¿™é‡Œå·²ç»å¯ä»¥çœ‹åˆ°ä¸€äº› Diffusion çš„å½±å­äº†ã€‚</p><h3 id=23-dsm-å’Œ-dae-ä¹‹é—´çš„å…³ç³»>2.3. DSM å’Œ DAE ä¹‹é—´çš„å…³ç³»<a hidden class=anchor aria-hidden=true href=#23-dsm-å’Œ-dae-ä¹‹é—´çš„å…³ç³»>#</a></h3><p>ä¸å¦¨å…ˆç®€å•å›é¡¾ä¸€ä¸‹ï¼Œæ­¤å¤„å¯¹äºè¢«å™ªå£°æ±¡æŸ“äº†çš„æ•°æ®å¯¹ $\{\tilde x, x\}$ï¼ŒDAE çš„ Loss Funciton å¯ä»¥å†™ä½œ:</p>$$
J_{DAE}(\theta) = \mathbb{E}_{q(x), q_\sigma(\tilde{x}|x)}\left[ \left\| r(\tilde{x}, \theta) - x \right\|^2 \right]
$$<p>å…¶ä¸­ $r(\tilde{x}, \theta)$ æ˜¯ DAE çš„é‡å»ºå‡½æ•°ã€‚æ ¹æ®<a href=#22-dsm-loss-%E7%AD%89%E4%BB%B7%E6%80%A7%E8%AF%81%E6%98%8E>ä¸Šä¸€èŠ‚ä¸­çš„è¯æ˜</a> Score Function å¯ä»¥å®šä¹‰ä¸ºï¼š</p>$$
\psi(x, \theta) = \frac {r(\tilde x, \theta) - \tilde{x}}{\sigma^2}
$$<p>å°†è¿™ä¸ªå½¢å¼å¸¦å…¥ $J_{DSM}$ ä¸­ï¼Œä¸éš¾å‘ç°ï¼š</p>$$
\begin{aligned}
J_{DSM}(\theta)
&= \mathbb{E}_{q(x), q_\sigma(\tilde{x}|x)}\left[ \frac{1}{2} \left\| \psi(\tilde{x}; \theta) - \frac{x - \tilde{x}}{\sigma^2} \right\|^2 \right]\\
&= \mathbb{E}_{q(x), q_\sigma(\tilde{x}|x)}\left[ \frac{1}{2\sigma^4} \left\| r(\tilde x, \theta) - x \right\|^2 \right]\\
&= \frac{1}{2\sigma^4} J_{DAE}(\theta)
\end{aligned}
$$<p>è¿™ä¸ DAE çš„ Loss Function åªå·®ä¸€ä¸ªå¸¸æ•°å€æ•°ã€‚</p><h2 id=3-discussion>3. Discussion<a hidden class=anchor aria-hidden=true href=#3-discussion>#</a></h2><p>Score Matching åœ¨ Denoising Score Matching ä¹‹å‰ï¼Œå¯ä»¥è¯´æ˜¯ä¸€ä¸ª â€œå± é¾™æœ¯â€ã€‚ç¡®å®ï¼ŒScore Matching å¾ˆå¥½çš„è§£å†³äº†å½’ä¸€åŒ–é—®é¢˜ã€‚ä½†æ˜¯ä¾ç„¶æœ‰å¾ˆå¤šç¼ºé™·ï¼š</p><ol><li>Score Matching çš„ Loss Function éœ€è¦è®¡ç®—äºŒé˜¶å¯¼æ•°ï¼Œå¯¹äºé«˜ç»´æ•°æ®è®¡ç®—é‡å·¨å¤§ï¼Œä¸”æ•°å€¼ä¸Šä¸ç¨³å®šã€‚</li><li>Score Matching åªå¯¹æ•°æ®é‡‡æ ·ç‚¹é™„è¿‘çš„ä¿¡æ¯æ¢¯åº¦å»ºæ¨¡ï¼Œå¯¼è‡´ Langevin Annealing çš„è¿‡ç¨‹ä¸­å¾ˆå®¹æ˜“é™·å…¥å±€éƒ¨æœ€ä¼˜ã€‚</li></ol><p>Denoising Score Matching å¾ˆå¥½çš„è§£å†³äº†è¿™äº›é—®é¢˜ã€‚é¦–å…ˆï¼ŒDSM é€šè¿‡æ·»åŠ å™ªå£°çš„æ–¹å¼ï¼Œäº‹å®ä¸Šå»ºç«‹äº†ä¸€æ¡ä»å™ªå£°åˆ°æ•°æ®çš„é€šè·¯ï¼Œæˆ‘ä»¬çš„æ¨¡å‹äº‹å®ä¸Šè§è¿‡ä»å™ªå£°é‡å»ºæ•°æ®çš„æ¯ä¸€æ­¥æ“ä½œï¼Œè®©æ¨¡å‹çš„é‡‡æ ·æ›´åŠ é²æ£’ã€‚æ›´å¤§çš„å¥½å¤„æ˜¯ï¼Œåœ¨å®é™…æ“ä½œä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„ Loss æ˜¯ï¼š</p>$$
\begin{aligned}
J_{DSMq}(\theta)
&= \mathbb{E}_{q_{\sigma}(x, \tilde{x})}\left[ \frac{1}{2} \left\| \psi(\tilde{x}; \theta) - \frac{\partial \log q_{\sigma}(\tilde{x}|x)}{\partial \tilde{x}} \right\|^2 \right]\\
&= \mathbb{E}_{q_{\sigma}(x, \tilde{x})}\left[ \frac{1}{2} \left\| \psi(\tilde{x}; \theta) - \frac{1}{\sigma^2} (x - \tilde{x}) \right\|^2 \right]
\end{aligned}
$$<p>å‡è®¾å¯¹äºæ•°æ® $x$ï¼Œæˆ‘ä»¬æ·»åŠ äº†å™ªå£° $\epsilon(\tilde x)$ï¼Œé‚£ä¹ˆå¯¹äºé€šè¿‡ç¥ç»ç½‘ç»œæè¿°çš„ Score Function $\psi(\tilde x; \theta)$ï¼Œæˆ‘ä»¬åªéœ€è¦æœ€å°åŒ–ï¼š</p>$$
\boxed{
J_{DSMq}(\theta) = \mathbb{E}_{q_{\sigma}(x, \tilde{x})}\left[ \frac{1}{2} \left\| \psi(\tilde{x}; \theta) - \frac{\epsilon(\tilde x)}{\sigma^2} \right\|^2 \right]
}
$$<p>äº‹å®ä¸Šå°†ä¸€ä¸ªå¤æ‚çš„æ— ç›‘ç£å­¦ä¹ é—®é¢˜ï¼Œè½¬åŒ–ä¸ºä¸€ä¸ªæœ‰ç›‘ç£å­¦ä¹ é—®é¢˜ï¼Œå¹¶ç›´æ¥ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ ESM ä½œä¸º Loss Functionã€‚ä¸è®ºæ˜¯ä»£ç è¿˜æ˜¯è®­ç»ƒéš¾åº¦ï¼Œéƒ½ç®€å•äº†éå¸¸å¤šã€‚åœ¨å®è·µä¸­ï¼Œä½¿ç”¨ Pytorchï¼Œå®ç°éå¸¸ç®€å•ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>denoising_score_matching_loss</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>sigma</span><span class=o>=</span><span class=mf>0.01</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>batch_size</span> <span class=o>=</span> <span class=n>x</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># æ·»åŠ å™ªå£°</span>
</span></span><span class=line><span class=cl>    <span class=n>noise</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>randn_like</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>*</span> <span class=n>sigma</span>
</span></span><span class=line><span class=cl>    <span class=n>x_noisy</span> <span class=o>=</span> <span class=n>x</span> <span class=o>+</span> <span class=n>noise</span>
</span></span><span class=line><span class=cl>    <span class=n>x_noisy</span><span class=o>.</span><span class=n>requires_grad_</span><span class=p>(</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># è®¡ç®— score</span>
</span></span><span class=line><span class=cl>    <span class=n>score</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>score_network</span><span class=p>(</span><span class=n>x_noisy</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Target: -noise / sigma^2 (çœŸå®çš„å»å™ªæ–¹å‘)</span>
</span></span><span class=line><span class=cl>    <span class=n>target</span> <span class=o>=</span> <span class=o>-</span><span class=n>noise</span> <span class=o>/</span> <span class=p>(</span><span class=n>sigma</span> <span class=o>**</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># ä½¿ç”¨åŠ æƒçš„ MSE Lossï¼Œé¿å…å°å™ªå£°æ—¶ loss çˆ†ç‚¸</span>
</span></span><span class=line><span class=cl>    <span class=n>weight</span> <span class=o>=</span> <span class=n>sigma</span> <span class=o>**</span> <span class=mi>2</span>  <span class=c1># æƒé‡ä¸ sigma^2 æˆæ­£æ¯”ï¼Œå¹³è¡¡ä¸åŒå™ªå£°æ°´å¹³çš„æŸå¤±</span>
</span></span><span class=line><span class=cl>    <span class=n>loss</span> <span class=o>=</span> <span class=n>weight</span> <span class=o>*</span> <span class=n>F</span><span class=o>.</span><span class=n>mse_loss</span><span class=p>(</span><span class=n>score</span><span class=p>,</span> <span class=n>target</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>loss</span>
</span></span></code></pre></div><p>å¹¶ä¸”ï¼Œä» DSMï¼Œå·²ç»å¯ä»¥çœ‹åˆ° Diffusion çš„é›å½¢äº†ã€‚è¿™ç¯‡æ–‡ç« ä¹Ÿå¼€å¯äº†åä¸–æ‰©æ•£æ¨¡å‹å¤§å‘å±•çš„å¤§é—¨ã€‚</p><h2 id=appendix>Appendix<a hidden class=anchor aria-hidden=true href=#appendix>#</a></h2><h3 id=a-parzen-density-estimator>A. Parzen Density Estimator<a hidden class=anchor aria-hidden=true href=#a-parzen-density-estimator>#</a></h3><p>å¯¹äºä¸€ä¸ªç†æƒ³ä½†æ˜¯æœªçŸ¥çš„åˆ†å¸ƒ $p(x)$ï¼Œæˆ‘ä»¬å¯¹é½è®¤è¯†åªæœ‰ä¸€ç³»åˆ—é‡‡æ ·ç‚¹ $\{x_1, x_2, \cdots ,x_n\}$ã€‚ä¸€ä¸ªç®€å•çš„ç”šè‡³æœ‰äº›æš´åŠ›çš„é‡å»ºå…¶å¯†åº¦çš„æ–¹æ³•æ˜¯ï¼šç»™æ¯ä¸ªæ•°æ®ç‚¹ä¸Šå›ºå®šä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºé‡å»ºæ ¸ï¼Œå¸¸é€‰é«˜æ–¯åˆ†å¸ƒï¼‰,ä¹‹åå°†æ‰€æœ‰çš„åˆ†å¸ƒåŠ èµ·æ¥ç»Ÿä¸€å½’ä¸€åŒ–ã€‚å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªå¹³æ»‘çš„ã€è¿ç»­çš„æ¦‚ç‡åˆ†å¸ƒã€‚Parzen Density Estimation å¯ä»¥çœ‹ä½œå¯¹ç›´æ–¹å›¾å‘çš„ä¸€ç§ç›´è§‰çš„æ”¹è¿›ã€‚å½“æˆ‘ä»¬é€‰æ‹©å¦‚ä¸‹çš„é«˜æ–¯é‡å»ºæ ¸ï¼š</p>$$
p(\tilde x \mid x) = \mathcal N(\tilde x \mid x, \sigma^2 I)
$$<p>é‚£ä¹ˆ Parzen Density Estimation é‡å»ºçš„æ¦‚ç‡åˆ†å¸ƒä¸ºï¼š</p>$$
p(\tilde{x}) = \frac{1}{n} \sum_{i=1}^n p(\tilde x \mid x_i) = \frac{1}{n} \sum_{i=1}^n \mathcal N(\tilde x \mid x_i, \sigma^2 I)
$$<p>å…¶ä¸­ï¼Œé«˜æ–¯åˆ†å¸ƒçš„åæ–¹å·® $\sigma$ æ§åˆ¶äº†é‡å»ºåˆ†å¸ƒçš„å¹³æ»‘ç¨‹åº¦ã€‚$\sigma$ è¶Šå¤§ï¼Œé‡å»ºåˆ†å¸ƒè¶Šå¹³æ»‘ï¼Œ$\sigma$ è¶Šå°ï¼Œé‡å»ºåˆ†å¸ƒè¶Šæ¥è¿‘åŸå§‹æ•°æ®çš„ç¦»æ•£é‡‡æ ·ã€‚è¿™é‡Œç§°ä¹‹ä¸º â€œå¸¦å®½â€ã€‚</p><p>äº‹å®ä¸Šå¯ä»¥é€šè¿‡ä¸€ä¸ªæ›´å½¢å¼è¯çš„æ–¹å¼æ¥å®šåŠ› Parzen Density Estimationã€‚å¯¹äºä¸€ç³»åˆ—æ•°æ® $\{x_1, x_2, \cdots ,x_n\}$ï¼Œæˆ‘ä»¬å¯ä»¥å»ºç«‹èµ·å…¶ç»éªŒåˆ†å¸ƒï¼š</p>$$
q(x) = \frac{1}{n}\sum_{i=1}^n \delta(x - x_i)
$$<p>å¯¹äºé‡å»ºæ ¸ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶å†™æˆæ¡ä»¶çš„å½¢å¼ï¼š</p>$$
p(\tilde x \mid x) = \mathcal N(\tilde x \mid x, \sigma^2 I)
$$<p>Parzen Density Estimation å¯ä»¥ç”¨è¾¹ç¼˜åˆ†å¸ƒé‡å†™ï¼š</p>$$
\begin{aligned}
p(\tilde x)
&= \int p(\tilde x \mid x) q(x) dx\\
&= \int \sum_{i=1}^n \delta(x - x_i) \mathcal N(\tilde x \mid x, \sigma^2 I) dx\\
&= \sum_{i=1}^n \int \delta(x - x_i) \mathcal N(\tilde x \mid x, \sigma^2 I) dx\\
&= \frac{1}{n} \sum_{i=1}^n \mathcal N(\tilde x \mid x_i, \sigma^2 I)
\end{aligned}
$$<p>è¿™ä¸ªå½¢å¼ä¸ç›´æ¥çš„ Parzen Density Estimation æ˜¯ç­‰ä»·çš„ã€‚è¿™ä¸ªç†è§£åœ¨ DAE ä¸­è‡³å…³é‡è¦ã€‚</p><h2 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h2><p>[A connection between score matching and denoising autoencoders](@article{vincent2011connection,
title={},
author={Vincent, Pascal},
journal={Neural computation},
volume={23},
number={7},
pages={1661&ndash;1674},
year={2011},
publisher={MIT Press}
})</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://wangjv0812.cn/tags/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/>ç¥ç»ç½‘ç»œ</a></li><li><a href=https://wangjv0812.cn/tags/%E7%94%9F%E6%88%90%E6%A8%A1%E5%9E%8B/>ç”Ÿæˆæ¨¡å‹</a></li><li><a href=https://wangjv0812.cn/tags/denoising-score-matching/>Denoising Score Matching</a></li><li><a href=https://wangjv0812.cn/tags/diffusion/>Diffusion</a></li><li><a href=https://wangjv0812.cn/tags/%E6%97%A0%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0/>æ— ç›‘ç£å­¦ä¹ </a></li></ul><nav class=paginav><a class=next href=https://wangjv0812.cn/2025/09/fisher-information-and-fisher-divergence/><span class=title>Next Â»</span><br><span>Fisher Information and Fisher Divergence</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://wangjv0812.cn/>WangJV Blog</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>